G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var a=this._map,b=G.DomUtil,d=this._container=b.create("div","g-layer");this._bg=b.create("div","g-tile-container g-zoom-animated",this._container);this._front=b.create("div","g-tile-container g-zoom-animated",this._container);a._layersFrame.appendChild(this._container);b.setZIndex(d,this._zIndex)},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_update:function(){var a=this._map;
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),d=this._calcVisTileInfos(!0);a.getSize();var c=a.getCenter(),f=this.options,e=f.zoomReses[b],k=f.tileSize,h=a.getDrawSize(),n=h[0],h=h[1],e=[c[0]-n*e/2,c[1]-h*e/2,c[0]+n*e/2,c[1]+h*e/2],a=a.options.maxExtent,m,p,l;this._redrawExtent=e;var e=G.ExtentUtil.intersect(e,a),r;for(r in this._tiles)p=this._tiles[r],a=p._info,m=a[0],n=a[1],l=a[2],h=f.zoomReses[l],l!==b&&(this._stopLoadingTile(p),(!f.keepResample||1>f.opacity)&&this._removeTile(r)),
p=f.originX+m*k*h,m=f.originX+(m+1)*k*h,l=f.originY-(n+1)*k*h,n=f.originY-n*k*h,(n=G.ExtentUtil.overlaps([p,l,m,n],e))||this._tileInfoExist(a,d)||this._removeTile(r);this._placeLoadedTiles(this._bg);this._placeLoadedTiles(this._front);b=this._calcTileIndex(c[0],c[1],b);this._sortTileInfos(d,b[0],b[1]);this._addTiles(d)}},_draw:function(){var a=G.DomUtil;this._map._isLoaded()&&(a.show(this._bg),a.show(this._front),a.setZIndex(this._container,this._zIndex),this._placeLoadedTiles(this._bg),this._placeLoadedTiles(this._front))},
_erase:function(){var a=G.DomUtil;a.hide(this._bg);a.hide(this._front)},_onZoomEnd:function(){var a=this._front,b=this._bg,d=G.DomUtil,c=d.Transition,d=d.Transform;a.parentNode.appendChild(a);a.style[d]="";a.style[c]="";b.style[d]="";b.style[c]="";this._zooming=!1},_clearBgBuffer:function(){var a=this._map;a&&!a._zooming&&(this._bg.innerHTML="")},_prepareBgBuffer:function(){var a=this._front,b=this._bg;this._stopLoadingTiles(b);this._front=b;this._bg=a},_placeLoadedTiles:function(a){var b=this.options.zoomReses.length,
d=this._calcNearestZoom(!0);a=a.getElementsByTagName("img");for(var c,f,e,k,h,n=0,m=a.length;n<m;n++)(c=a[n])&&c.complete&&(f=c._info,e=parseInt(f[0]),k=parseInt(f[1]),f=parseInt(f[2]),h=f==d?b+1:f,this._placeTile(c,e,k,f,h))},_addTiles:function(a){if(0!==a.length){this._numLoad=a.length;this._numLoadError=this._numLoadSuccess=0;for(var b=this.options,d=b.zoomReses.length,c,f,e,k,h,n=this.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,m=0,p=a.length;m<p;m++){c=a[m];f=c[0];e=c[1];k=c[2];h=this._getTileName(f,
e,k);(c=this._tiles[h])?c.src==n?+new Date-c._responseTime>b.tileLiveMs&&this._loadTile(c,f,e,k):this._numLoadSuccess++:(c=this._getIdleTile(),this._tiles[h]=c,this._loadTile(c,f,e,k));if(c.parentNode!==this._front&&(this._front.appendChild(c),c._wraps))for(var l in c._wraps)(h=c._wraps[l])&&h.parentNode!==this._front&&this._front.appendChild(h);this._placeTile(c,f,e,k,d)}this._checkAllHandled()}},_onNewWrapTile:function(a,b){var d=a._wraps[b];d&&d.parentNode!==this._front&&this._front.appendChild(d)}});
G.Layer.Graphic=G.Layer.Graphic.extend({_initContainer:function(){var a=this._map,b=G.DomUtil,d=this._container=b.create("div","g-layer");this._vml=b.createVML("group","",d);a._layersFrame.appendChild(d);b.setZIndex(d,this._zIndex)},_update:function(){this.isVisible()?this._draw():this._erase()},_draw:function(){var a=this._map,b=G.DomUtil,d=a.getDrawSize(),c=d[0],d=d[1],f=this._vml;b.setZIndex(this._container,this._zIndex);b.show(f);f.style.width=c;f.style.height=d;f.coordsize=[c,d].join(" ");var a=
a.getRedrawExtent(),e;for(e in this._graphics)b=this._graphics[e],c=b.bbox,b._layer&&G.ExtentUtil.overlaps(c,a)?b._draw():b._erase()},_erase:function(){G.DomUtil.hide(this._vml)},_onClear:function(){var a=this._vml;a&&(a.innerHTML="")}});
G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._lts={};this._gx=this._gy=10},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),d=a.getCenter();this._clearGrids();a=a._zoomAnim;a&&a._playing||(a=this._calcVisTileInfos(),b=this._calcTileIndex(d[0],d[1],b),this._sortTileInfos(a,b[0],b[1]),this._setLts(a))}},_setLts:function(a){if(a.length){for(var b=[],d,c,f,e,k,h=0,n=a.length;h<n;h++)d=a[h],f=d[0],e=d[1],k=d[2],d=this._getTileName(f,e,k),b.push(d),d in this._lts?(c=this._lts[d],c.loading||c.data||c.ri||this._loadLtI(f,e,k)):this._loadLtI(f,e,k),this._placeLt(d);this._dirtyTileKeys=
this._dirtyTileKeys||[];for(d in this._lts)-1<b.indexOf(d)||(this._stopLoadingLt(d),this._dirtyTileKeys.push(d))}},_checkDirtyTiles:function(){var a=this._dirtyTileKeys,b;if(a&&0<a.length)for(var d=0,c=a.length;d<c;d++)b=a[d],this._removeLt(b);this._dirtyTileKeys=[]},_placeLt:function(a){if((a=this._lts[a])&&a._info&&a.data){var b=a.data.l,d,c,f,e,k,h,n,m,p,l,r,q;for(d in b)for(r in c=b[d],f=Number(c[0]),e=Number(c[1]),c=c[6],f=[f,e],e="imgs"+d,l=a[e],l)e=l[r],k=e[0],h=e[1],n=e[2],m=e[3],p=e[4],q=
e[5],q||(e[5]=q=new G.Graphic.Point(f,null,{shape:"image",size:[h,n],offset:[m,p],image:k,imageGravity:!!c}),q.addTo(this))}},_removeLt:function(a){var b=this._lts[a];if(b&&b._info&&b.data){this._stopLoadingLt(a);var d=b.data.l,c,f,e;for(c in d)for(e in d="imgs"+c,f=b[d],f)d=f[e],(g=d[5])&&g.remove();delete this._lts[a]}},_loadLtI:function(a,b,d){var c=this,f=c._getTileName(a,b,d),e=c._lts[f]=c._lts[f]||{};e._info=[a,b,d];""!==e.data&&(e.loading=!0,a=c._getTileUrl(a,b,d,{d:"i",i:G.Browser.retina?
"@2x":""}),b={},c.options.crossOrigin&&(b.crossOrigin=c.options.crossOrigin),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",header:b,success:function(a,b){e.data=b;c._processLt(f)},error:function(a){404==a.status&&(e.data="")},complete:function(){delete e.ri;e.loading=!1}},c.options.crossOrigin&&(b.responseType="JSON"),a=G.Util.ajax(a,b),e.ri=a)},_processLt:function(a){var b=this._lts[a],d=b.data;if(d){var c=d.l,f=d.b,e=d.i,d=d.bb,k=this.options.icons||"",h,n,m,p,l,r,q,t,w;for(h in c){if(f&&
h in f)for(q=f[h],t=0,w=q.length;t<w;t++)r=q[t],c=r[0],n=r[1],m=r[2],p=r[3],l=r[4],r=r[5],0!=r&&d&&(l=d.slice(l,l+r),l="data:image/png;base64,"+l,r="b"+t,b["imgs"+h]=b["imgs"+h]||{},b["imgs"+h][r]=[l,c,n,m,p]);if(e&&h in e)for(q=e[h],t=0,w=q.length;t<w;t++)l=q[t],c=l[0],n=l[1],m=l[2],p=l[3],l=l[4],l=k+l,r="i"+t,b["imgs"+h]=b["imgs"+h]||{},b["imgs"+h][r]=[l,c,n,m,p]}this._checkDirtyTiles();this._placeLt(a)}},_stopLoadingLt:function(a){a=this._lts[a];var b=G.Util.ajaxCancel;a&&(b(a.ri),a.loading=!1)},
_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(a,b,d,c){for(var f=a;f<=d;f++)for(var e=b;e<=c;e++)if(a=f+","+e,this._g[a])return!0;return!1},_markGrids:function(a,b,d,c){for(var f=a;f<=d;f++)for(var e=b;e<=c;e++)a=f+","+e,this._g[a]=!0}});
G.Layer.VectorCache=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{cluster:[]},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._vts={};this._visVtKeys=[];this._vIds={}},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
a._isLoaded()&&(a=this._calcVisTileInfos(),this._addVts(a))},_addVts:function(a){if(0!==a.length){var b,d,c=[],f,e,k,h;b=0;for(d=a.length;b<d;b++)f=a[b],e=f[0],k=f[1],h=f[2],f=this._getTileName(e,k,h),c.push(f),f in this._vts?(e=this._vts[f],e.data&&this._processVt(f)):this._loadVt(e,k,h);b=0;for(d=this._visVtKeys.length;b<d;b++)f=this._visVtKeys[b],0>c.indexOf(f)&&this._removeVt(f);this._visVtKeys=c}},_removeVt:function(a){this._vts[a]&&this._stopLoadingVt(a)},_loadVt:function(a,b,d){var c=this,
f=c._getTileName(a,b,d),e=c._vts[f]=c._vts[f]||{};e._info=[a,b,d];""!==e.data&&(e.loading=!0,a=c._getTileUrl(a,b,d,{d:"f"}),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",success:function(a,b){e.data=b;c._processVt(f)},error:function(a){404==a.status&&(e.data="")},complete:function(){delete e.req;e.loading=!1}},a=G.Util.ajax(a,b),e.req=a)},_processVt:function(a){for(var b=this._map,d=this._vts[a].data,c=d.v,d=d.s,f,e,k,h,n,m=G.Util.colorHex,p=0,l=c.length;p<l;p++)f=c[p],e=f.id,
k=f.g,h=f.gt,f=f.st,f=d[f],(n=this._vIds[e])?n._updateGeom(k):"pt"===h?n=new G.Graphic.Point(k):"pl"===h?n=new G.Graphic.Polyline(k):"pg"===h&&(n=new G.Graphic.Polygon(k)),n&&(k=n.options,"pt"!==h&&"pl"===h&&(h=f.line_color,k.lineWidth=f.line_width,k.lineColor=m(h[0],h[1],h[2])),n&&(n.addTo(this),n._vtKeys=n._vtKeys||{},n._vtKeys[a]=!0,this._vIds[e]=n));b._requestRedraw()},_stopLoadingVt:function(a){a=this._vts[a];var b=G.Util.ajaxCancel;a&&(b(a.req),a.loading=!1)}});
G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1E3},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={}},onSuccess:function(a){"tile"==this.options.mode?this.fireEvent("loadTileSuccess",{extent:a}):this.fireEvent("loadAllSuccess")},onError:function(a){"tile"==this.options.mode?this.fireEvent("loadTileError",{extent:a}):this.fireEvent("loadAllError")},onComplete:function(a){if("tile"==
this.options.mode){var b=a.join(",");delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{extent:a})}else this.fireEvent("loadAllComplete")},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);a._isLoaded()&&("tile"==this.options.mode?(this.count()>this.options.vacuumCount&&this._vacuum(),a=this._calcVisTileInfos(),this._addFts(a)):this._loadAll())},_addFts:function(a){if(0!==a.length){var b,d,c,f,e,k=this._loadingKeys,h={};b=0;for(d=a.length;b<d;b++)f=a[b],c=
f[0],e=f[1],f=f[2],e=this._calcTileExtent(c,e,f),c=e.join(","),h[c]=e;for(c in k)h[c]||(a=k[c],G.Util.ajaxCancel(a),delete k[c]);for(c in h)e=h[c],this._loadFt(e)}},_loadFt:function(a){var b=a.join(","),d=this._reqFunc;b in this._loadingKeys||!d||(d=d.call(this,a),this._loadingKeys[b]=d,this.fireEvent("loadTileStart",{extent:a}))},_loadAll:function(){var a=this._reqFunc;"all"in this._loadingKeys||!a||(a=a.call(this),this._loadingKeys.all=a,this.fireEvent("loadAllStart"))}});
G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1E3},init:function(a,b){var d=this;G.Layer.FeatureService.prototype.init.call(d,function(b){var f=a+"/query",e=d.options,k={ak:e.apiKey,where:e.where,outFields:e.outFields,limit:e.limit};b&&(k.geometry=JSON.stringify(b));k={responseType:"http"===f.slice(0,4).toLowerCase()?"JSONP":"JSON",data:k,success:function(a,f){var k=f.data,p=k.geometryType;if(k=k.features){var l;l=k.length-1;for(var r=Math.max(0,
l-e.limit),q,t,w,s=[],u;l>=r;l--)for(u in q=k[l],t=q.id,w=q.geom,q=q.attrs||{},"Point"==p?s.push(new G.Graphic.Point(w,q)):"Polyline"==p?s.push(new G.Graphic.Polyline(w,q)):"Polygon"==p?s.push(new G.Graphic.Polygon(w,q)):"MultiPoint"==p?s.push(new G.Graphic.MultiPoint(w,q)):"MultiPolyline"==p?s.push(new G.Graphic.MultiPolyline(w,q)):"MultiPolygon"==p&&s.push(new G.Graphic.MultiPolygon(w,q)),s)if(q=s[u])w=t+"_"+u,d.get(w)||q.addTo(d,w)}d.onSuccess(b)},error:function(){d.onError(b)},complete:function(){d.onComplete(b)}};
G.Util.ajax(f,k)},b)}});
G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a},onSuccess:function(a){this.fireEvent("extentSuccess",{extent:a})},onError:function(a){this.fireEvent("extentError",{extent:a})},onComplete:function(a){this.fireEvent("extentComplete",{extent:a})},_update:function(){var a=this._map,b=this._loadRes=a._res,d=this._loadExtent=a.getExtent(),c=this._loadedStatus;
if(!c||b!=c[0]||!G.ExtentUtil.equals(d,c[1]))if(G.Layer.Graphic.prototype._update.call(this),a._isLoaded()){(a=this._req)&&G.Util.ajaxCancel(a);var f,b=this._graphics;for(f in b)a=b[f],a._dirty=!0;this._loadStep(1)}},_loadStep:function(a){var b=this,d=b.options,c=b._loadRes,f=b._loadExtent,e=d.tolerance*Math.pow(d.stepFactor,d.stepCount-a),k=b.url+"/filter",d={responseType:"JSON",data:{extent:JSON.stringify(f),excludeExtents:JSON.stringify([]),res:c,cellPixel:e,outFields:d.outFields},success:function(c,
d){b._processResult(a,d)},complete:function(){b._req=null}};b._req=G.Util.ajax(k,d)},_processResult:function(a,b){var d=this.options,c=this._loadRes,f=this._loadExtent,e=d.tolerance*Math.pow(d.stepFactor,d.stepCount-a),e=c*e,k=b.geometryType,h=b.features;if(h){var n,m,p,l,r,q;for(n=h.length-1;0<=n;n--)if(m=h[n],p=m.id,l=m.geom,m=m.attrs||{},"Point"==k)q=new G.Graphic.Point(l,m),this._updateGraphic(e,p,0,q);else if("Polyline"==k)q=new G.Graphic.Polyline(l,m),this._updateGraphic(e,p,0,q);else if("Polygon"==
k)q=new G.Graphic.Polygon(l,m),this._updateGraphic(e,p,0,q);else if("MultiPoint"==k)for(r in l.multi)q=l.multi[r],q=new G.Graphic.Point(q,m),this._updateGraphic(e,p,r,q);else if("MultiPolyline"==k)for(r in l.multi)q=l.multi[r],q=new G.Graphic.Polyline(q,m),this._updateGraphic(e,p,r,q);else if("MultiPolygon"==k)for(r in l.multi)q=l.multi[r],q=new G.Graphic.Polygon(q,m),this._updateGraphic(e,p,r,q);a<d.stepCount?this._loadStep(a+1):(this._clearDirty(),this._loadedStatus=[c,f],this.onSuccess(f),this.onComplete(f))}else this.onError(f),
this.onComplete(f)},_updateGraphic:function(a,b,d,c){b+=d?"_"+d:"";(d=this.get(b))?(a<d._res&&(d.updateGeom(c.geom,!0),d._res=a),d._dirty=!1):(c._res=a,c.addTo(this,b))},_clearDirty:function(){var a=this._graphics,b,d;for(d in a)b=a[d],b._dirty&&b.remove()}});
G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(a,b){this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={};this._loadedKeys={}},onSuccess:function(a,b){this._numLoadSuccess++;var d=parseInt(a[0]),c=parseInt(a[1]),f=parseInt(a[2]),d=this._getTileName(d,c,f);this._loadedKeys[d]=a;this.fireEvent("loadTileSuccess",{tileInfo:a,data:b})},onError:function(a){this._numLoadError++;this.fireEvent("loadTileError",{tileInfo:a})},onComplete:function(a){var b=
parseInt(a[0]),d=parseInt(a[1]),c=parseInt(a[2]),b=this._getTileName(b,d,c);delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{tileInfo:a});this._checkAllHandled()},_update:function(){if(this._map._isLoaded()){var a,b,d,c,f,e,k=this._calcVisTileInfos(),h={};a=0;for(b=k.length;a<b;a++)c=k[a],d=c[0],f=c[1],e=c[2],d=this._getTileName(d,f,e),h[d]=c;this._addTiles(h);for(d in this._loadedKeys)h[d]||(c=this._loadedKeys[d],delete this._loadedKeys[d],this.fireEvent("unusedTile",{tileInfo:c}));
this._onUpdated()}},_addTiles:function(a){var b,d,c=this._loadingKeys;for(b in c)a[b]||(d=c[b],G.Util.ajaxCancel(d),delete c[b]);this._numLoad=Object.keys(a).length;this._numLoadError=this._numLoadSuccess=0;for(b in a)d=a[b],this._loadTile(d);this._checkAllHandled()},_loadTile:function(a){var b=this._reqFunc,d=parseInt(a[0]),c=parseInt(a[1]),f=parseInt(a[2]),e=this._getTileName(d,c,f);e in this._loadingKeys||!b||(e in this._loadedKeys?this._numLoadSuccess++:(b=b.call(this,d,c,f),this._loadingKeys[e]=
b,this.fireEvent("loadTileStart",{tileInfo:a})))},_stopLoadingByKey:function(a){var b=this._loadingKeys,d=b[a];d&&(G.Util.ajaxCancel(d),delete b[a])},_checkAllHandled:function(){this._numLoad==this._numLoadSuccess+this._numLoadError&&this.fireEvent("allLoaded")},_onUpdated:function(){}});
G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._points={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this.options,d=this._layer._map;if(this.geom){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);a.getPosition(d._mapFrame);
var c=b.shape,f=b.size,e=f[0],f=f[1],k=b.offset,h=b.imageRotate;b.imageGravity&&(h+=d._rotate);"image"==c&&h&&(k=G.MathUtil.rotateVector(k,h));for(var n=this.geom[0],m=this.geom[1],p=d._calcWrapPointRange(this.geom)||[0,0],l=d.options.maxExtent,l=l[2]-l[0],r=p[0];r<=p[1];r++){var q=this._points[r];q||(q="rect"==c?this._points[r]=a.createVML("rect","g-vml"):"image"==c?this._points[r]=a.createVML("image","g-vml"):"text"==c?this._points[r]=a.createVML("text","g-vml"):this._points[r]=a.createVML("oval",
"g-vml"),q._graphic=this,this._dom.appendChild(q));var t=d.toScreen([n+r*l,m]),w=t[0]+k[0],t=t[1]+k[1],s=q.style;if("circle"==c)s.left=w-e/2,s.top=t-e/2,s.width=s.height=e;else if("rect"==c)s.left=w-e/2,s.top=t-f/2,s.width=e,s.height=f;else if("image"==c){s.left=w;s.top=t;s.width=e;s.height=f;if(h){s.rotation=h;var u=[e/2,f/2],v=G.MathUtil.rotateVector(u,h);s.left=w-(u[0]-v[0]);s.top=t-(u[1]-v[1])}w=G.Browser.getImageSrc(b.image);q.src=w}else if("text"==c){u=b.text;this._textMeasureWidth&&this._textMeasure==
u||(v=a.create("div","",document.body),v.style.position="absolute",v.style.visibility="hidden",v.style.width=v.style.height="auto",v.style.fontFamily=b.textFont,v.style.fontStyle="italic"==b.textStyle?"italic":"normal",v.style.fontWeight="bold"==b.textStyle?"bold":"normal",v.style.fontSize=e+"px",v.innerHTML=u,this._textMeasureWidth=v.clientWidth+4,v.parentNode.removeChild(v),this._textMeasure=u);var u=e,v=this._textMeasureWidth,x=b.textAlign;s.left=w+("left"==x?0:"right"==x?-v:-v/2);s.top=t-u/2;
s.width=v;s.height=u;s.fontFamily=b.textFont;s.fontStyle="italic"==b.textStyle?"italic":"normal";s.fontWeight="bold"==b.textStyle?"bold":"normal";s.fontSize=e+"px";s.color=b.fillColor;s.filter="alpha(opacity="+100*b.fillOpacity+")";q.innerHTML=b.text}}this._updateStyles()}},_updateStyles:function(){var a=G.DomUtil,b=this.options,d;for(d in this._points){var c=this._points[d];if((b.outline||this._mouseOver||this._editing)&&"text"!=b.shape){var f=[];for(d=0;d<b.outlineDashArray.length;d++)f[d]=parseInt(b.outlineDashArray[d]/
b.outlineWidth);a.strokeVML(c,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:f.join(" "),weight:this._mouseOver?b.outlineWidth+b.lineHighlightWiden:b.outlineWidth,opacity:b.outlineOpacity})}else a.strokeVML(c,{opacity:0});b.fill?(f=G.Browser.getImageSrc(b.fillImage),a.fillVML(c,{color:b.fillColor,opacity:b.fillOpacity,color2:b.fillColor,src:f,focusposition:"50%, 50%",type:b.fillImage?"tile":b.gradual?"gradientradial":"solid"})):a.fillVML(c,{opacity:0})}},
_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;
this._updateStyles();this._isVertex?b.addClass(a._layersFrame,"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;this._updateStyles();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polylines={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var d=this._layer._vml;this._dom&&(d&&!this._dom.parentNode)&&d.appendChild(this._dom);for(var d=Math.round,
c=a.getPosition(b._mapFrame),f=this.geom,e=f.length,k=this.bbox,k=b._calcWrapPointRange([(k[0]+k[2])/2,(k[1]+k[3])/2])||[0,0],h=b.options.maxExtent,h=h[2]-h[0],n=k[0];n<=k[1];n++){var m=this._polylines[n];m||(m=this._polylines[n]=a.createVML("shape","g-vml"),m._path=a.createVML("path","g-vml",m),m._graphic=this,this._dom.appendChild(m));for(var p="",l,r,q=0;q<e;q++)l=b.toScreen([f[q][0]+n*h,f[q][1]]),r=l[0]-c[0],l=l[1]-c[1],p+=0===q?" M ":"",p+=1===q?" L ":" ",p+=d(r)+","+d(l);p+=" E";m._path.v=p;
m.filled="f";m.style.width=m.style.height=1;m.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.lineDashArray.length;c++)d[c]=parseInt(b.lineDashArray[c]/b.lineWidth);for(c in this._polylines)a.strokeVML(this._polylines[c],{color:this._editing?b.lineHighlightColor:b.lineColor,dashstyle:d.join(" "),endcap:b.lineCap?b.lineCap.replace("butt","flat"):"",joinstyle:b.lineJoin,weight:this._mouseOver?b.lineWidth+b.lineHighlightWiden:b.lineWidth,
opacity:b.lineOpacity})},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;
this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polygons={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var d=this._layer._vml;this._dom&&(d&&!this._dom.parentNode)&&d.appendChild(this._dom);for(var d=Math.round,
c=a.getPosition(b._mapFrame),f=this.geom,e=this.bbox,e=b._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=e[0];h<=e[1];h++){var n=this._polygons[h];n||(n=this._polygons[h]=a.createVML("shape","g-vml"),n._path=a.createVML("path","g-vml",n),n._graphic=this,this._dom.appendChild(n));for(var m="",p,l,r,q,t=0,w=f.length;t<w;t++){p=f[t];l="";for(var s=0,u=p.length;s<u;s++)r=b.toScreen([p[s][0]+h*k,p[s][1]]),q=r[0]-c[0],r=r[1]-c[1],l+=0===s?" M ":"",l+=1===s?
" L ":" ",l+=d(q)+","+d(r);l+=" X";m+=l}m+=" E";n._path.v=m;n.style.width=n.style.height=1;n.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.outlineDashArray.length;c++)d[c]=parseInt(b.outlineDashArray[c]/b.outlineWidth);for(c in this._polygons){var f=this._polygons[c];b.outline||this._mouseOver||this._editing?a.strokeVML(f,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:d.join(" "),endcap:b.outlineCap?
b.outlineCap.replace("butt","flat"):"",joinstyle:b.outlineJoin,weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(f,{opacity:0});if(b.fill){var e=G.Browser.getImageSrc(b.fillImage);a.fillVML(f,{color:b.fillColor,opacity:b.fillOpacity,src:e,type:b.fillImage?"tile":"solid"})}else a.fillVML(f,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();
G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.MultiPoint=G.Graphic.MultiPoint.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._pointss={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this.options,d=this._layer._map,c=this.geom;if(c&&c.m){var f=this._layer._vml;this._dom&&(f&&!this._dom.parentNode)&&f.appendChild(this._dom);
a.getPosition(d._mapFrame);var f=b.shape,e=b.size,k=e[0],e=e[1],h=b.offset,n=b.imageRotate;b.imageGravity&&(n+=d._rotate);"image"==f&&n&&(h=G.MathUtil.rotateVector(h,n));for(var c=c.m,m,p,l,r=this.bbox,r=d._calcWrapPointRange([(r[0]+r[2])/2,(r[1]+r[3])/2])||[0,0],q=d.options.maxExtent,q=q[2]-q[0],t=r[0];t<=r[1];t++)for(var w=this._pointss[t]=this._pointss[t]||[],s=0;s<c.length;s++){m=c[s];p=m[0];l=m[1];m=w[s];m||(m="rect"==f?this._pointss[t][s]=a.createVML("rect","g-vml"):"image"==f?this._pointss[t][s]=
a.createVML("image","g-vml"):"text"==f?this._pointss[t][s]=a.createVML("text","g-vml"):this._pointss[t][s]=a.createVML("oval","g-vml"),m._graphic=this,this._dom.appendChild(m));l=d.toScreen([p+t*q,l]);p=l[0]+h[0];l=l[1]+h[1];var u=m.style;if("circle"==f)u.left=p-k/2,u.top=l-k/2,u.width=u.height=k;else if("rect"==f)u.left=p-k/2,u.top=l-e/2,u.width=k,u.height=e;else if("image"==f){u.left=p;u.top=l;u.width=k;u.height=e;if(n){u.rotation=n;var v=[k/2,e/2],x=G.MathUtil.rotateVector(v,n);u.left=p-(v[0]-
x[0]);u.top=l-(v[1]-x[1])}p=G.Browser.getImageSrc(b.image);m.src=p}else if("text"==f){v=b.text;this._textMeasureWidth&&this._textMeasure==v||(x=a.create("div","",document.body),x.style.position="absolute",x.style.visibility="hidden",x.style.width=x.style.height="auto",x.style.fontFamily=b.textFont,x.style.fontStyle="italic"==b.textStyle?"italic":"normal",x.style.fontWeight="bold"==b.textStyle?"bold":"normal",x.style.fontSize=k+"px",x.innerHTML=v,this._textMeasureWidth=x.clientWidth+4,x.parentNode.removeChild(x),
this._textMeasure=v);var v=k,x=this._textMeasureWidth,y=b.textAlign;u.left=p+("left"==y?0:"right"==y?-x:-x/2);u.top=l-v/2;u.width=x;u.height=v;u.fontFamily=b.textFont;u.fontStyle="italic"==b.textStyle?"italic":"normal";u.fontWeight="bold"==b.textStyle?"bold":"normal";u.fontSize=k+"px";u.color=b.fillColor;u.filter="alpha(opacity="+100*b.fillOpacity+")";m.innerHTML=b.text}}this._updateStyles()}},_updateStyles:function(){var a=G.DomUtil,b=this.options,d;for(d in this._pointss){var c=this._pointss[d],
f;for(f in c){var e=c[f];if((b.outline||this._mouseOver||this._editing)&&"text"!=b.shape){var k=[],h;for(h=0;h<b.outlineDashArray.length;h++)k[h]=parseInt(b.outlineDashArray[h]/b.outlineWidth);a.strokeVML(e,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:k.join(" "),weight:this._mouseOver?b.outlineWidth+b.lineHighlightWiden:b.outlineWidth,opacity:b.outlineOpacity})}else a.strokeVML(e,{opacity:0});b.fill?(k=G.Browser.getImageSrc(b.fillImage),a.fillVML(e,{color:b.fillColor,
opacity:b.fillOpacity,color2:b.fillColor,src:k,focusposition:"50%, 50%",type:b.fillImage?"tile":b.gradual?"gradientradial":"solid"})):a.fillVML(e,{opacity:0})}}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,
this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;this._updateStyles();this._isVertex?b.addClass(a._layersFrame,"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;this._updateStyles();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.MultiPolyline=G.Graphic.MultiPolyline.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polyliness={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map,d=this.geom;if(d&&d.m){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);
for(var c=Math.round,f=a.getPosition(b._mapFrame),d=d.m,e=this.bbox,e=b._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=e[0];h<=e[1];h++){this._polyliness[h]=this._polyliness[h]||[];for(var n=0;n<d.length;n++){var m=this._polyliness[h][n];m||(m=this._polyliness[h][n]=a.createVML("shape","g-vml"),m._path=a.createVML("path","g-vml",m),m._graphic=this,this._dom.appendChild(m));for(var p="",l,r,q=d[n],t=0,w=q.length;t<w;t++)l=b.toScreen([q[t][0]+h*k,q[t][1]]),
r=l[0]-f[0],l=l[1]-f[1],p+=0===t?" M ":"",p+=1===t?" L ":" ",p+=c(r)+","+c(l);p+=" E";m._path.v=p;m.filled="f";m.style.width=m.style.height=1;m.coordsize="1 1"}}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.lineDashArray.length;c++)d[c]=parseInt(b.lineDashArray[c]/b.lineWidth);for(var f in this._polyliness){var c=this._polyliness[f],e;for(e in c)a.strokeVML(c[e],{color:this._editing?b.lineHighlightColor:b.lineColor,dashstyle:d.join(" "),endcap:b.lineCap?
b.lineCap.replace("butt","flat"):"",joinstyle:b.lineJoin,weight:this._mouseOver?b.lineWidth+b.lineHighlightWiden:b.lineWidth,opacity:b.lineOpacity})}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,
this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.MultiPolygon=G.Graphic.MultiPolygon.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polygonss={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map,d=this.geom;if(d&&d.m){var c=this._layer._vml;this._dom&&(c&&!this._dom.parentNode)&&c.appendChild(this._dom);for(var c=
Math.round,f=a.getPosition(b._mapFrame),d=d.m,e=this.bbox,e=b._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=e[0];h<=e[1];h++){this._polygonss[h]=this._polygonss[h]||[];for(var n=0;n<d.length;n++){var m=this._polygonss[h][n];m||(m=this._polygonss[h][n]=a.createVML("shape","g-vml"),m._path=a.createVML("path","g-vml",m),m._graphic=this,this._dom.appendChild(m));for(var p="",l,r,q,t,w=d[n],s=0,u=w.length;s<u;s++){l=w[s];r="";for(var v=0,x=l.length;v<x;v++)q=
b.toScreen([l[v][0]+h*k,l[v][1]]),t=q[0]-f[0],q=q[1]-f[1],r+=0===v?" M ":"",r+=1===v?" L ":" ",r+=c(t)+","+c(q);r+=" X";p+=r}p+=" E";m._path.v=p;m.style.width=m.style.height=1;m.coordsize="1 1"}}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.outlineDashArray.length;c++)d[c]=parseInt(b.outlineDashArray[c]/b.outlineWidth);for(var f in this._polygonss){var c=this._polygonss[f],e;for(e in c){var k=c[e];b.outline||this._mouseOver||this._editing?a.strokeVML(k,
{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:d.join(" "),endcap:b.outlineCap?b.outlineCap.replace("butt","flat"):"",joinstyle:b.outlineJoin,weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(k,{opacity:0});if(b.fill){var h=G.Browser.getImageSrc(b.fillImage);a.fillVML(k,{color:b.fillColor,opacity:b.fillOpacity,src:h,type:b.fillImage?"tile":"solid"})}else a.fillVML(k,{opacity:0})}}},_updateMask:function(){},
_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();
G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._circles={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;if(this.geom){var d=this._layer._vml;this._dom&&(d&&!this._dom.parentNode)&&d.appendChild(this._dom);for(var d=a.getPosition(b._mapFrame),
c=b._res,f=this.geom[0],e=this.geom[1],k=this.geom[2],h=b._calcWrapPointRange(this.geom)||[0,0],n=b.options.maxExtent,n=n[2]-n[0],m=h[0];m<=h[1];m++){var p=this._circles[m];p||(p=this._circles[m]=a.createVML("oval","g-vml"),p._graphic=this,this._dom.appendChild(p));var l=b.toScreen([f+m*n,e]),r=l[0]-d[0],l=l[1]-d[1],q=k/c,p=p.style;p.width=p.height=2*q;p.left=r-q;p.top=l-q}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.outlineDashArray.length;c++)d[c]=
parseInt(b.outlineDashArray[c]/b.outlineWidth);for(c in this._circles){var f=this._circles[c];b.outline||this._mouseOver||this._editing?a.strokeVML(f,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:d.join(" "),weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(f,{opacity:0});if(b.fill){var e=G.Browser.getImageSrc(b.fillImage);a.fillVML(f,{color:b.fillColor,opacity:b.fillOpacity,color2:b.fillColor,
src:e,focusposition:"50%, 50%",type:b.fillImage?"tile":b.gradual?"gradientradial":"solid"})}else a.fillVML(f,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,
this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var a=G.DomUtil;this._dom||(this._dom=a.createVML("group","g-vml-container"));this._polygons={};(a=this._layer._map)&&a._requestRedraw()},_onRemoved:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a);(a=this._layer._map)&&a._requestRedraw()},_draw:function(){var a=G.DomUtil,b=this._layer._map;this._updateGeomDraw(b._res);if(this._geomDraw){var d=this._layer._vml;this._dom&&(d&&!this._dom.parentNode)&&d.appendChild(this._dom);
for(var d=Math.round,c=a.getPosition(b._mapFrame),f=this._geomDraw,e=this.bbox,e=b._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],k=b.options.maxExtent,k=k[2]-k[0],h=e[0];h<=e[1];h++){var n=this._polygons[h];n||(n=this._polygons[h]=a.createVML("shape","g-vml"),n._path=a.createVML("path","g-vml",n),n._graphic=this,this._dom.appendChild(n));for(var m="",p,l,r,q,t=0,w=f.length;t<w;t++){p=f[t];l="";for(var s=0,u=p.length;s<u;s++)r=b.toScreen([p[s][0]+h*k,p[s][1]]),q=r[0]-c[0],r=r[1]-c[1],l+=
0===s?" M ":"",l+=1===s?" L ":" ",l+=d(q)+","+d(r);l+=" X";m+=l}m+=" E";n._path.v=m;n.style.width=n.style.height=1;n.coordsize="1 1"}this._updateStyles()}},_updateStyles:function(){for(var a=G.DomUtil,b=this.options,d=[],c=0;c<b.outlineDashArray.length;c++)d[c]=parseInt(b.outlineDashArray[c]/b.outlineWidth);for(c in this._polygons){var f=this._polygons[c];b.outline||this._mouseOver||this._editing?a.strokeVML(f,{color:this._editing?b.lineHighlightColor:b.outline?b.outlineColor:b.fillColor,dashstyle:d.join(" "),
endcap:b.outlineCap?b.outlineCap.replace("butt","flat"):"",joinstyle:b.outlineJoin,weight:(b.outline?b.outlineWidth:0)+(this._mouseOver?b.lineHighlightWiden:0),opacity:b.outlineOpacity}):a.strokeVML(f,{opacity:0});if(b.fill){var e=G.Browser.getImageSrc(b.fillImage);a.fillVML(f,{color:b.fillColor,opacity:b.fillOpacity,src:e,type:b.fillImage?"tile":"solid"})}else a.fillVML(f,{opacity:0})}},_updateMask:function(){},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,d,c;for(d in b.DOWN)c=b.DOWN[d],a.removeListener(c,this._onVertexDragStart,this),a.removeListener(b.MOVE[c],this._onVertexDrag,this),a.removeListener(b.UP[c],this._onVertexDragEnd,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();
G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});G.Graphic.Group=G.Graphic.Group.extend({_updateStyles:function(){var a=this._graphics,b,d,c;if(a&&a.length)for(b=0,d=a.length;b<d;b++)c=a[b],c._updateStyles&&c._updateStyles()},_onMouseOver:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;this._updateStyles();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Map=G.Map.extend({_initAddition:function(){this._mode="vml"}});
