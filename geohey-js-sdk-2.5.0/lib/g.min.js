var G={name:"JS SDK",version:"2.5.0",owner:"GeoHey.com"};window.G=G;var cons=window.console;cons&&cons.log&&(cons.log("%c","font-size:30px; padding:15px 120px;line-height:60px;background:url('http://static.geohey.com/img/logo-all.png') no-repeat;"),cons.log(G.name,G.version,"\u00a9",G.owner));
(function(){function a(a,b,c){if(a in f)b&&b();else{var n=e[a]||(e[a]=[]);b&&n.push(b);var m=document.createElement("script");m.type="text/javascript";m.src=a;b=function(){if(!(m.readyState&&"loaded"!=m.readyState&&"complete"!=m.readyState||m.success)){m.success=!0;f[a]=!0;var b=e[a];if(b){for(var c=b.length-1;0<=c;--c)b[c]();delete e[a]}}};"onload"in m?m.onload=b:m.onreadystatechange=b;m.onerror=function(a){c&&c(a)};d.appendChild(m);return m}}var b=document.getElementsByTagName("script"),b=b[b.length-
1].src,c=b.lastIndexOf("/");G.debug=0<b.toLowerCase().lastIndexOf(".min.js")?!1:!0;G.dir=0>c?"":b.substring(0,c+1);var d=document.getElementsByTagName("head")[0],e={},f={};G.loadModule=function(b,c,d){a(G.dir+"g-"+b+(G.debug?"":".min")+".js",c,d)};G.loadModules=function(a,b,c){var d=0,e=!1,f,q;for(f in a)q=a[f],G.loadModule(q,function(){d++;e||d===a.length&&b&&b()},function(){e=!0;c&&c()})}})();
G.Util={isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isString:function(a){return"[object String]"===Object.prototype.toString.call(a)},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},merge:function(a){var b=Array.prototype.slice.call(arguments,1),c,d,e,f;d=0;for(e=b.length;d<e;d++)for(c in f=b[d]||{},f)f.hasOwnProperty(c)&&(a[c]=f[c]);return a},
bind:function(a,b){var c=2<arguments.length?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},_stampId:0,stamp:function(a){a._g_id_=a._g_id_||this._stampId++;return a._g_id_},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},renderString:function(a,b){return a?a.replace(/\{ *([\w]+) *\}/gi,function(a,d){var e=b[d];return void 0===e?"":e}):""},_requestAnimFrameFunc:function(){for(var a=["webkit","moz","o","ms"],b=window.requestAnimationFrame,
c=0,d=a.length;c<d&&!b;c++)b=window[a[c]+"RequestAnimationFrame"];return b}(),requestAnimFrame:function(a,b,c,d){a=this.bind(a,c);if(c=this._requestAnimFrameFunc)return c.call(window,a,d);if(b)a();else return window.setTimeout(a,16)},_cancelAnimFrameFunc:function(){for(var a=["webkit","moz","o","ms"],b=window.cancelAnimationFrame,c=0,d=a.length;c<d&&!b;c++)b=window[a[c]+"CancelAnimationFrame"]||window[a[c]+"CancelRequestAnimationFrame"];return b}(),cancelAnimFrame:function(a){var b=this._cancelAnimFrameFunc;
b?b.call(window,a):window.clearTimeout(a)},setCanvasLineDash:function(a,b){a&&b&&0<b.length&&(a.setLineDash?a.setLineDash(b):void 0!==a.webkitLineDash?a.webkitLineDash=b:void 0!==a.mozDash&&(a.mozDash=b))},ajax:function(a,b){if(a){var c=b||{},d=c.context||this,e=function(a,b,c){if(void 0===b||void 0===c)return a;a+=a.match(/\?/)?"&":"?";return a+(b+"="+c)},f=function(a){w&&w.call(d,a)},h="POST"===(c.type||"GET").toUpperCase()?"POST":"GET",k=c.contentType,l=c.headers||{},n=c.data||{},m=(c.responseType||
"DATA").toUpperCase(),p=c.jsonp||"_g_jsonp_"+this._ajaxSeq++,q=c.jsonpCallback||"callback",r=c.success,x=c.error,w=c.complete,v,s,h="JSONP"===m?"GET":h;if("GET"===h){for(v in n)a=e(a,v,n[v]);n=null}else{c="";for(v in n)c=e(c,v,n[v]);"?"===c[0]&&(c=c.slice(1));n=c;k=k||"application/x-www-form-urlencoded; charset=UTF-8"}if("JSONP"===m)return a=e(a,q,p),s=document.createElement("script"),s.src=a,s._g_jsonp_=p,window[p]=function(a){s._g_jsonp_value_=a;window[p]=null;s.parentNode&&s.parentNode.removeChild(s)},
e=function(){s._g_abort_||(s.readyState&&"loaded"!=s.readyState&&"complete"!=s.readyState||s.success)||(s.success=!0,r&&r.call(d,s,s._g_jsonp_value_),f(s))},"onload"in s?s.onload=e:s.onreadystatechange=e,s.onerror=function(){x&&x.call(d,s);f(s)},document.getElementsByTagName("head")[0].appendChild(s),s;var u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(u){u.onload=function(){if(4==u.readyState){if(200==u.status||304==u.status){var a;a="TEXT"===m?u.responseText:
"XML"===m?u.responseXML:"JSON"===m?eval("("+u.responseText+")"):u.response;r&&r.call(d,u,a)}else x&&x.call(d,u);f(u)}};u.onerror=function(){x&&x.call(d,u);f(u)};u.open(h,a,!0);k&&u.setRequestHeader("Content-Type",k);for(v in l)u.setRequestHeader(v,l[v]);u.send(n);return u}}},ajaxCancel:function(a){a&&(a.onload=a.onerror=null,a.abort?a.abort():(a._g_abort_=!0,a.parentNode&&a.parentNode.removeChild(a)))},colorHex:function(a,b,c){function d(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"#"+
d(a)+d(b)+d(c)},colorRgb:function(a){function b(a,b,e){a=parseInt(a.substring(b,e),16);return 2===e-b?a:256-(16-a)*(16-a)}return 5>a.length?[b(a,1,2),b(a,2,3),b(a,3,4)]:[b(a,1,3),b(a,3,5),b(a,5,7)]},_ajaxSeq:0};
G.MathUtil={DEGREE_PER_RADIAN:57.29577951308232,calcHypotenuse:function(a,b){return Math.pow(a*a+b*b,0.5)},calcTheta:function(a,b){if(!a&&!b)return 0;var c=this.calcHypotenuse(a,b);return Math.acos(a/c)*(0<b?1:-1)},rotateVector:function(a,b){var c=a[0],d=a[1],e=this.calcHypotenuse(c,d),c=this.calcTheta(c,d)+b/this.DEGREE_PER_RADIAN;return[e*Math.cos(c),e*Math.sin(c)]},scaleVector:function(a,b){return this.scaleArray(a,b)},scaleArray:function(a,b){if(a){var c=[],d;for(d in a)c[d]=a[d]*b;return c}},
limitRange:function(a,b,c){return Math.min(Math.max(a,b||a),c||a)},calcDistance:function(a,b){return Math.pow((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]),0.5)}};G.Class=function(){};
G.Class.extend=function(a){var b=function(){this.init&&this.init.apply(this,arguments)},c=G.Util.merge,d=function(){};d.prototype=this.prototype;d=new d;d.constructor=b;b.prototype=d;var e,f;for(e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);var h={},k;if(a.mixins){e=0;for(f=a.mixins.length;e<f;e++)k=a.mixins[e],c(d,k),k.options&&c(h,k.options);delete a.mixins}a.statics&&(c(b,a.statics),delete a.statics);(e=this.prototype.options)&&c(h,e);c(h,a.options);a.options=h;c(d,a);b.__super__=
this.prototype;return b};
G.Browser={getDpi:function(){var a;if(!this._dpi)if(document.body)a=document.createElement("div"),a.style.cssText="width:1in;height:1in;position:absolute;visibility:hidden",document.body.appendChild(a),this._dpi=[parseInt(a.offsetWidth)||96,parseInt(a.offsetHeight)||96],a.parentNode.removeChild(a);else return[96,96];return this._dpi},getPxRatio:function(){this._pxRatio||(this._pxRatio=[1,1],screen.deviceXDPI&&screen.logicalXDPI&&(this._pxRatio=[screen.deviceXDPI/screen.logicalXDPI,screen.deviceYDPI/
screen.logicalYDPI]));return this._pxRatio},getCanvasRatio:function(){if(!this._canvasRatio){var a=G.DomUtil.create("canvas","").getContext("2d"),a=(window.devicePixelRatio||1)/(a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1),b=Math.max(screen.width,screen.height);2<a&&1500<b*a&&(a=2);this._canvasRatio=[a,a]}return this._canvasRatio},getImageSrc:function(a){return G.Util.renderString(a,this.retina?{i:"@2x"}:
{i:""})}};
(function(){var a=window,b=document,c=a.navigator,d=c.userAgent.toLowerCase(),e=b.documentElement,f="undefined"!==typeof a.orientation,h=-1<d.search("iphone"),k=-1<d.search("android"),l=-1<d.search("android [23]"),n="ActiveXObject"in window,m=n&&!b.addEventListener,p=-1<d.search("webkit"),q=-1<d.search("chrome"),r=-1<d.search("safari/")&&!q,x=-1<d.search("gecko/")&&!p&&!n,w=!!b.createElementNS&&!!b.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,v=!!b.createElement("canvas").getContext,s;
if((b=b.createElement("canvas"))&&b.getContext)for(var u=["webgl","experimental-webgl"],y=0,z=u.length;y<z&&!s;y++)s=b.getContext(u[y]);s=!!s;var d=l||k&&-1<d.search("chrome/30.0.0.0"),b=n&&"transition"in e.style,u="WebKitCSSMatrix"in a&&"m11"in new a.WebKitCSSMatrix&&!l,y="MozPerspective"in e.style,e="OTransition"in e.style,z=b||u||y||e,C=!!a.G_OFF_CSS3D,A=c.msPointerEnabled&&c.msMaxTouchPoints&&!a.PointerEvent,c=a.PointerEvent&&c.pointerEnabled&&c.maxTouchPoints||A||"ontouchstart"in a||a.DocumentTouch&&
document instanceof a.DocumentTouch,a=1.5<=a.devicePixelRatio||a.matchMedia&&a.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),                      (-moz-min-device-pixel-ratio: 1.5),                      (min-device-pixel-ratio: 1.5),                      (min-resolution: 1.5dppx)").matches;G.Util.merge(G.Browser,{mobile:f,iphone:h,android:k,androidlt3:l,ie:n,ielt9:m,webkit:p,safari:r,chrome:q,gecko:x,svg:w,vml:m,canvas:v,webgl:s,avoidCanvas:d,ie3d:b,webkit3d:u,gecko3d:y,opera3d:e,support3d:z,
avoid3d:C,touch:c,retina:a})})();Array.indexOf||(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return b;return-1});
G.RTree=G.Class.extend({init:function(a){this._tolerance=1E-6;this._fan=a||8;this._fanHalf=Math.floor(this._fan/2);this._t={mbr:[],nodes:[]}},insert:function(a,b){if(a&&b){var c={mbr:this._getMbrByExtent(a),obj:b};return this._insertTo(c,this._t)}},remove:function(a,b){if(a&&b){var c=this._getMbrByExtent(a);return this._removeFrom(c,b,this._t)}},clear:function(){this._t.mbr=[];this._t.nodes=[]},search:function(a){a=this._getMbrByExtent(a);return this._searchSubtree(a,!1,this._t)},count:function(){return this._countNode(this._t)},
all:function(){return this._allInNode(this._t)},_getMbrByExtent:function(a){var b=a[0],c=a[1];return[b,c,a[2]-b,a[3]-c]},_countNode:function(a){var b=0;if("nodes"in a)for(var c=a.nodes.length-1;0<=c;c--)b+=this._countNode(a.nodes[c]);else"obj"in a&&b++;return b},_allInNode:function(a){var b=[];if("nodes"in a)for(var c=a.nodes.length-1;0<=c;c--)b=b.concat(this._allInNode(a.nodes[c]));else"obj"in a&&b.push(a.obj);return b},_insertTo:function(a,b){if(0===b.nodes.length)b.nodes.push(a),b.mbr=this._resizeMbrWithNodes(b.mbr,
b.nodes);else{var c=this._chooseSubtree(a,b),d=a,e;do{if(e&&"nodes"in e&&0===e.nodes.length){var f=e;e=c.pop();for(var h=0,k=e.nodes.length;h<k;h++)if(e.nodes[h]===f||0===e.nodes[h].nodes.length){e.nodes.splice(h,1);break}}else e=c.pop();if(d&&("obj"in d||"nodes"in d||G.Util.isArray(d))){if(G.Util.isArray(d)){f=0;for(h=d.length;f<h;f++)this._expandMbr(e.mbr,d[f].mbr);e.nodes=e.nodes.concat(d)}else this._expandMbr(e.mbr,d.mbr),e.nodes.push(d);e.nodes.length<=this._fan?d=null:(d=this._split(e.nodes),
1>c.length&&(e.nodes.push(d[0]),c.push(e),d=d[1]))}}while(0<c.length)}},_removeFrom:function(a,b,c){var d=[],e=[],f=[];if(!a||!this._mbrOverlap(a,c.mbr))return f;a={mbr:this._cloneMbr(a),target:b};e.push(c.nodes.length);d.push(c);var h;do if(c=d.pop(),b=e.pop()-1,"target"in a)for(;0<=b;){h=c.nodes[b];if(this._mbrOverlap(a.mbr,h.mbr))if(a.target&&"obj"in h&&h.obj===a.target||!a.target&&("obj"in h||this._mbrContain(a.mbr,h.mbr))){"nodes"in h?(c.nodes.splice(b,1),f=this._searchSubtree(h.mbr,!0,h)):f=
c.nodes.splice(b,1);c.mbr=this._resizeMbrWithNodes(c.mbr,c.nodes);delete a.target;c.nodes.length<this._fanHalf&&(a.nodes=this._searchSubtree(c.mbr,!0,c));break}else"nodes"in h&&(e.push(b),d.push(c),c=h,b=h.nodes.length);b-=1}else if("nodes"in a){c.nodes.splice(b+1,1);0<c.nodes.length&&(c.mbr=this._resizeMbrWithNodes(c.mbr,c.nodes));for(b=a.nodes.length-1;0<=b;b--)this._insertTo(a.nodes[b],c);a.nodes.length=0;0===d.length&&1>=c.nodes.length?(a.nodes=this._searchSubtree(c.mbr,!0,c),c.nodes.length=0,
d.push(c),e.push(1)):0<d.length&&c.nodes.length<this._fanHalf?(a.nodes=this._searchSubtree(c.mbr,!0,c),c.nodes.length=0):delete a.nodes}else c.mbr=this._resizeMbrWithNodes(c.mbr,c.nodes);while(0<d.length);return f},_chooseSubtree:function(a,b){var c=-1,d=[];d.push(b);var e=b.nodes,f;do{-1!=c&&(d.push(e[c]),e=e[c].nodes,c=-1);for(var h=e.length-1;0<=h;h--){f=e[h];if(f.obj){c=-1;break}0>c&&(c=h)}}while(-1!=c);return d},_split:function(a){for(var b=this._linearPickSeeds(a);0<a.length;)this._pickNext(a,
b[0],b[1]);return b},_linearPickSeeds:function(a){for(var b=a.length-1,c=0,d=a.length-1,e=0,f,h=a.length-2;0<=h;h--)f=a[h],f.mbr[0]>a[c].mbr[0]?c=h:f.mbr[0]+f.mbr[2]<a[b].mbr[0]+a[b].mbr[2]&&(b=h),f.mbr[1]>a[e].mbr[1]?e=h:f.mbr[1]+f.mbr[3]<a[d].mbr[1]+a[d].mbr[3]&&(d=h);f=Math.abs(a[b].mbr[0]+a[b].mbr[2]-a[c].mbr[0]);h=Math.abs(a[d].mbr[1]+a[d].mbr[3]-a[e].mbr[1]);f>h?b>c?(b=a.splice(b,1)[0],c=a.splice(c,1)[0]):(c=a.splice(c,1)[0],b=a.splice(b,1)[0]):d>e?(b=a.splice(d,1)[0],c=a.splice(e,1)[0]):(c=
a.splice(e,1)[0],b=a.splice(d,1)[0]);return[{mbr:this._cloneMbr(b.mbr),nodes:[b]},{mbr:this._cloneMbr(c.mbr),nodes:[c]}]},_pickNext:function(a,b,c){for(var d,e,f,h=0,k=-1,l=b,n=a.length-1;0<=n;n--)f=a[n],d=this._cloneMbr(b.mbr),this._expandMbr(d,f.mbr),d=d[2]*d[3]-b.mbr[2]*b.mbr[3],e=this._cloneMbr(c.mbr),this._expandMbr(e,f.mbr),f=e[2]*e[3]-c.mbr[2]*c.mbr[3],e=Math.abs(d-f),e>h&&(h=e,k=n,l=d<f?b:c);h=a.splice(k,1)[0];b.nodes.length+a.length+1<=this._fanHalf?(b.nodes.push(h),this._expandMbr(b.mbr,
h.mbr)):c.nodes.length+a.length+1<=this._fanHalf?(c.nodes.push(h),this._expandMbr(c.mbr,h.mbr)):(l.nodes.push(h),this._expandMbr(l.mbr,h.mbr))},_searchSubtree:function(a,b,c){var d=[];if(!(this._mbrOverlap(a,c.mbr)&&"nodes"in c))return d;c=[c.nodes];for(var e,f;0<c.length;){e=c.pop();for(var h=e.length-1;0<=h;h--)f=e[h],this._mbrOverlap(a,f.mbr)&&("nodes"in f?c.push(f.nodes):"obj"in f&&(b?d.push(f):d.push(f.obj)))}return d},_mbrOverlap:function(a,b){var c=this._tolerance;if(a&&b&&!this._mbrNoValue(a)&&
!this._mbrNoValue(b))return a[0]<=b[0]+b[2]+c&&a[0]+a[2]+c>=b[0]&&a[1]<=b[1]+b[3]+c&&a[1]+a[3]+c>=b[1]},_mbrContain:function(a,b){if(a&&b&&!this._mbrNoValue(a)&&!this._mbrNoValue(b))return a[0]+a[2]+t>=b[0]+b[2]&&a[0]<=b[0]+t&&a[1]+a[3]+t>=b[1]+b[3]&&a[1]<=b[1]+t},_cloneMbr:function(a){if(a)return[a[0],a[1],a[2],a[3]]},_mbrNoValue:function(a){return!a||void 0===a[0]||void 0===a[1]||void 0===a[2]||void 0===a[3]},_expandMbr:function(a,b){if(!a||this._mbrNoValue(a))a=this._cloneMbr(b);else if(b&&!this._mbrNoValue(b)){var c=
Math.min(a[0],b[0]),d=Math.min(a[1],b[1]),e=Math.max(a[0]+a[2],b[0]+b[2])-c,f=Math.max(a[1]+a[3],b[1]+b[3])-d;a[0]=c;a[1]=d;a[2]=e;a[3]=f}return a},_resizeMbrWithNodes:function(a,b){if(!(1>b.length)){if(!a||this._mbrNoValue(a))a=this._cloneMbr(b[0].mbr);for(var c=b.length-1;0<c;c--)this._expandMbr(a,b[c].mbr);return a}}});
G.Browser.ielt9&&(G.RTree=G.RTree.extend({init:function(a){this._tolerance=1E-6;this._nodes={}},insert:function(a,b){if(a&&b){var c={ext:a,obj:b},d=G.Util.stamp(b);this._nodes[d]||(this._nodes[d]=c)}},remove:function(a,b){if(a&&b){var c=G.Util.stamp(b);this._nodes[c]&&delete this._nodes[c]}},clear:function(){this._nodes={}},search:function(a){var b=[],c,d;for(d in this._nodes)c=this._nodes[d],c=c.ext,this._overlaps(c,a,this._tolerance)&&b.push(this._nodes[d].obj);return b},count:function(){var a=
0,b;for(b in this._nodes)a++;return a},all:function(){var a=[],b;for(b in this._nodes)a.push(this._nodes[b].obj);return a},_overlaps:function(a,b,c){if(!a||!b)return!1;var d=a[1],e=a[2],f=a[3],h=b[0],k=b[1],l=b[3];c=c||0;return a[0]>b[2]+c||e<h-c||d>l+c||f<k-c?!1:!0}}));
G.Event={eventsKey:"_g_events_",virtualMouse:{DOWN:G.Browser.touch?["touchstart","mousedown"]:["mousedown"],MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"},UP:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"}},addListener:function(a,b,c){var d={action:b,context:c||this},e=this.eventsKey,e=this[e]=this[e]||{};e[a]=e[a]||[];e[a].push(d);this._onListenerAdded(a,b,c);return this},removeListener:function(a,b,c){var d=this[this.eventsKey],e;if(!d)return this;
if(b){if(d=d[a])for(e=d.length-1;0<=e;e--)d[e].action!==b||c&&d[e].context!==c||d.splice(e,1)}else delete d[a];this._onListenerRemoved(a,b,c);return this},clearListeners:function(){delete this[this.eventsKey];return this},hasListeners:function(a){var b=this[this.eventsKey];return b?a in b&&0<b[a].length:!1},_setListener:function(a,b,c,d,e){var f=this[this.eventsKey];if(f){a=f[a];for(var h=a.length-1;0<=h;h--)f=a[h],b&&f.action!==b||c&&f.context!==c||(f[d]=e)}return this},enableListener:function(a,
b,c){return this._setListener(a,b,c,"disabled",!1)},disableListener:function(a,b,c){return this._setListener(a,b,c,"disabled",!0)},fireEvent:function(a,b){if(!this.hasListeners(a))return this;var c=this[this.eventsKey],d=G.Util.merge({},b,{type:a,target:this,cancel:function(){d._cancel=!0;return d}});if(c)for(var c=c[a],e,f,h=c.length-1;0<=h;h--){e=c[h];if(d._cancel)break;e.disabled||(f=e.action)&&f.call(e.context||this,d)}return this},_onListenerAdded:function(a,b,c){},_onListenerRemoved:function(a,
b,c){}};G.Event.bind=G.Event.addListener;G.Event.unbind=G.Event.removeListener;G.Event.listen=G.Event.enableListener;G.Event.unlisten=G.Event.disableListener;G.Event.fire=G.Event.fireEvent;
G.DomUtil={SVG_NS:"http://www.w3.org/2000/svg",XLINK_NS:"http://www.w3.org/1999/xlink",create:function(a,b,c){a=document.createElement(a);a.className=b||"";c&&c.appendChild(a);return a},remove:function(a,b){b&&a&&b.removeChild(a)},createNS:function(a,b,c,d){if(!document.createElementNS)return this.create(b,c,d);a=document.createElementNS(a,b);a.className=c;d&&d.appendChild(a);return a},createSVG:function(a,b,c){return this.createNS(this.SVG_NS,a,b,c)},_svgImages:{},_svgImageSeq:1,svgImagePattern:function(a,
b,c,d){var e=b+"_"+c+"_"+d,e="svg_image_"+(e in this._svgImages?this._svgImages[e]:this._svgImages[e]=this._svgImageSeq++);a.querySelector("#"+e)||(a=this.createSVG("pattern","",a),a.setAttribute("id",e),a.setAttribute("patternUnits","userSpaceOnUse"),a.setAttribute("width",c),a.setAttribute("height",d),a=this.createSVG("image","",a),a.setAttributeNS(this.XLINK_NS,"href",b),a.setAttribute("width",c),a.setAttribute("height",d));return e},_svgGrads:{},_svgGradsSeq:1,svgGradient:function(a,b,c){var d=
b+"_"+c,d="svg_grad_"+(d in this._svgGrads?this._svgGrads[d]:this._svgGrads[d]=this._svgGradsSeq++),e;a.querySelector("#"+d)||(a=this.createSVG("radialGradient","",a),a.setAttribute("id",d),a.setAttribute("gradientUnits","objectBoundingBox"),a.setAttribute("cx","50%"),a.setAttribute("cy","50%"),a.setAttribute("r","50%"),e=this.createSVG("stop","",a),e.setAttribute("offset","0%"),e.setAttribute("stop-color",b),e.setAttribute("stop-opacity",1),a=this.createSVG("stop","",a),a.setAttribute("offset","50%"),
a.setAttribute("stop-color",b),a.setAttribute("stop-opacity",c));return d},createVML:function(a,b,c){this._vml_init||(document.namespaces.add("v","urn:schemas-microsoft-com:vml"),this._vml_init=!0);a=document.createElement("<v:"+a+">");a.className=b||"";c&&c.appendChild&&c.appendChild(a);return a},strokeVML:function(a,b){var c=a._stroke,d="color dashstyle endcap joinstyle weight opacity".split(" "),e,f;if(b)for(e in c||(c=a._stroke=this.createVML("stroke","g-vml",a)),d)f=d[e],f in b&&(c[f]=b[f]);
else c&&(a.removeChild(c),a._stroke=null)},fillVML:function(a,b){var c=a._fill,d="color color2 opacity src focusposition type".split(" "),e,f;if(b)for(e in c||(c=a._fill=this.createVML("fill","g-vml",a)),d)f=d[e],f in b&&(c[f]=b[f]);else c&&(a.removeChild(c),a._fill=null)},get:function(a){return G.Util.isString(a)?document.getElementById(a):a},getDomEventKey:function(a,b,c){return"_g_dom_event_"+a+"_"+G.Util.stamp(b)+(c?"_"+G.Util.stamp(c):"")},addListener:function(a,b,c,d){var e=G.DomUtil.getDomEventKey(b,
c,d),f=a[e];if(f)return this;f=function(b){return c.call(d||a,b)};"addEventListener"in a?a.addEventListener(b,f,!1):"attachEvent"in a&&a.attachEvent("on"+b,f);a[e]=f;return this},removeListener:function(a,b,c,d){c=G.DomUtil.getDomEventKey(b,c,d);d=a[c];if(!d)return this;"removeEventListener"in a?a.removeEventListener(b,d,!1):"detachEvent"in a&&a.detachEvent("on"+b,d);a[c]=null;return this},getMousePosition:function(a,b){var c=a.touches?0<a.touches.length?a.touches[0]:a.changedTouches[0]:a,d=document.documentElement,
e=document.body,f=c.pageX?c.pageX-e.scrollLeft-d.scrollLeft:c.clientX,c=c.pageY?c.pageY-e.scrollTop-d.scrollTop:c.clientY;b&&(d=b.getBoundingClientRect(),e=d.top-b.clientTop,f-=d.left-b.clientLeft,c-=e);return[f,c]},getWheelDelta:function(a){var b=0;a.wheelDelta&&(b=a.wheelDelta/120);a.detail&&(b=-a.detail/3);return b},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return this},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return this},
getStyle:function(a,b){var c=a.style[b];return"auto"===c?null:c},hasClass:function(a,b){return 0<a.className.length&&RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},addClass:function(a,b){this.hasClass(a,b)||(a.className&&(a.className+=" "),a.className+=b)},removeClass:function(a,b){a.className=G.Util.trim((" "+a.className+" ").replace(" "+b+" "," "))},getOffset:function(a){var b=0,c=0;do b+=a.offsetLeft||0,c+=a.offsetTop||0,b+=parseInt(this.getStyle(a,"borderLeftWidth"))||0,c+=parseInt(this.getStyle(a,
"borderTopWidth"))||0,a=a.offsetParent;while(a);return[b,c]},setSize:function(a,b,c){var d=a._size;d&&d[0]===b&&d[1]===c||(a._size=[b,c],b&&(a.style.width=b+"px"),c&&(a.style.height=c+"px"))},getSize:function(a){return a._size},setZIndex:function(a,b){a&&(a.style.zIndex=b||0)},setPosition:function(a,b,c,d){var e=a._pos;e&&e[0]===b&&e[1]===c||(d||(a._pos=[b,c]),G.DomUtil.updateTransform(a))},getPosition:function(a){return a._pos},getPositionNocache:function(a){var b=G.DomUtil.Transform,c;a=window.getComputedStyle?
window.getComputedStyle(a):a.currentStyle;b?(c=a[b].match(/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/))?(b=parseFloat(c[1]),a=parseFloat(c[2])):(b=parseFloat(a.left),a=parseFloat(a.top)):(b=parseFloat(a.left),a=parseFloat(a.top));return[b,a]},getSizeNocache:function(a){var b=window.getComputedStyle?window.getComputedStyle(a):a.currentStyle;a=parseFloat(b.width);b=parseFloat(b.height);return[a,b]},updateOpacity:function(a,b){if(a&&a._opacity!==b){var c=a.style;c[this.Opacity]=b;c.filter="alpha(opacity="+
100*b+")"}},markScaleTransform:function(a,b,c){a._scale=b&&c?[b,c]:null},markPosTransform:function(a,b,c){a._pos=[b,c]},markSizeTransform:function(a,b,c){a._size=[b,c]},markRotateTransform:function(a,b,c,d){a._rotate=[b,c,d]},updateTransform:function(a){var b=a._scale||[1,1],c=a._pos,d=a._size,e=a._rotate,f=this.Transform,h="";f?(c&&(h+=this.genTranslateStyle(c[0]||0,c[1]||0)),e&&((c=a._rotateSC)&&c[0]==e[0]&&c[1]==e[1]&&c[2]==e[2]?c=c[3]:(c=this.genRotateStyle(e[0],e[1],e[2]),a._rotateSC=[],a._rotateSC[0]=
e[0],a._rotateSC[1]=e[1],a._rotateSC[2]=e[2],a._rotateSC[3]=c),h+=c),a.style[f]=h):c&&(a.style.left=c[0]+"px",a.style.top=c[1]+"px");d&&(a.style.width=d[0]*b[0]+"px",a.style.height=d[1]*b[1]+"px")},genTranslateStyle:function(a,b){if(!a&&!b)return"";var c=G.Browser,d=Math.round;return c.support3d&&!c.avoid3d?" translate3d("+d(a)+"px,"+d(b)+"px, 0) ":" translate("+d(a)+"px,"+d(b)+"px) "},genScaleStyle:function(a,b,c,d,e){if(!a||1==a)return"";var f=1-a;return G.DomUtil.genTranslateStyle(b*f+(d||0),c*
f+(e||0))+" scale("+a+") "},genRotateStyle:function(a,b,c){if(!a)return"";var d="",e=G.MathUtil.rotateVector([b,c],a);b=b-e[0]||0;c=c-e[1]||0;if(b||c)d+=G.DomUtil.genTranslateStyle(b,c);return d+(" rotate("+a+"deg) ")},testStyle:function(a){var b=document.documentElement.style,c,d;c=0;for(d=a.length;c<d;c++)if(a[c]in b)return a[c]},hide:function(a,b,c){if(a){var d=this,e=a.style;if("hidden"!==e.visibility){a._oldOpacity=e[d.Opacity];var f=function(){e[d.Opacity]=0;e.filter="alpha(opacity=0)"};b?(a._g_hide_transition_end=
a._g_hide_transition_end||function(){d.removeListener(a,d.TransitionEnd,a._g_hide_transition_end);e.visibility="hidden";c&&c.call(a)},d.Transition?(d.addListener(a,d.TransitionEnd,a._g_hide_transition_end),e[d.Transition]=d.Opacity+" "+b+"s linear",f()):(e.visibility="hidden",f(),c&&c.call(a))):(e.visibility="hidden",f(),c&&c.call(a))}}},show:function(a,b,c){if(a){var d=this,e=a.style;if("hidden"===e.visibility){var f=function(){e.visibility="";var b=0<a._oldOpacity?a._oldOpacity:1;e[d.Opacity]=b;
e.filter="alpha(opacity="+100*b+")"};b?(a._g_show_transition_end=a._g_show_transition_end||function(){d.removeListener(a,d.TransitionEnd,a._g_show_transition_end);c&&c.call(a)},d.Transition?(d.addListener(a,d.TransitionEnd,a._g_show_transition_end),e[d.Transition]=d.Opacity+" "+b+"s linear",f()):(f(),c&&c.call(a))):(f(),c&&c.call(a))}}},getImgElement:function(a,b,c,d){var e=this._imgs=this._imgs||{},f=e[a];f||(f=e[a]=this.create("img"),d&&(f.crossOrigin=d),f.onload=function(){f._loaded=!0;b&&b()},
f.onerror=function(){f._loaded=!1;c&&c()},f.src=a);return f},disableTextSelection:function(){var a=this.UserSelect;this.addListener(window,"selectstart",this.preventDefault);if(a){var b=document.documentElement.style;this._userSelect=b[a];b[a]="none"}},enableTextSelection:function(){var a=this.UserSelect;this.removeListener(window,"selectstart",this.preventDefault);a&&(document.documentElement.style[a]=this._userSelect,delete this._userSelect)},disableImageDrag:function(){this.addListener(window,
"dragstart",this.preventDefault)},enableImageDrag:function(){this.removeListener(window,"dragstart",this.preventDefault)}};G.DomUtil.Opacity=G.DomUtil.testStyle(["opacity","webkitOpacity","MozOpacity"]);G.DomUtil.UserSelect=G.DomUtil.testStyle(["userSelect","webkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);G.DomUtil.Transform=G.DomUtil.testStyle(["transform","webkitTransform","OTransform","MozTransform","msTransform"]);
G.DomUtil.Transition=G.DomUtil.testStyle(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);G.DomUtil.TransitionEnd="webkitTransition"===G.DomUtil.Transition||"OTransition"===G.DomUtil.Transition?G.DomUtil.Transition+"End":"transitionend";
G.DomClickable=G.Class.extend({mixins:[G.Event],options:{doubleDuration:0.2},init:function(a,b){this._element=a;this.options=G.Util.merge({},this.options,b)},on:function(){var a=G.DomUtil,b=this.virtualMouse,c;if(!this._enabled){for(c in b.DOWN)a.addListener(this._element,b.DOWN[c],this._onDown,this);for(c in b.UP)a.addListener(this._element,b.UP[c],this._onUp,this);this._enabled=!0}return this},off:function(){var a=G.DomUtil,b=this.virtualMouse,c;if(this._enabled){for(c in b.DOWN)a.removeListener(this._element,
b.DOWN[c],this._onDown,this);for(c in b.UP)a.removeListener(this._element,b.UP[c],this._onUp,this);this._enabled=!1}this._dragged=!1;return this},_onDown:function(a){!a||a.touches&&1!==a.touches.length||(this._lastDown=a.touches?a.touches[0]:a,this._lastTime=+new Date)},_onUp:function(a){var b=G.DomUtil,c=Math.abs,d=+new Date,e=this._lastDown,f=this._lastTime;a=a.changedTouches?a.changedTouches[0]:a;!e||1E3<d-f||(d=b.getMousePosition(e),e=b.getMousePosition(a),b=c(d[0]-e[0]),c=c(d[1]-e[1]),3>b&&3>
c&&this._virtualClick(d));this._lastDown=null},_virtualClick:function(a){var b=+new Date,c=1E3*this.options.doubleDuration;this._lastClick?b-this._lastClickTime<c?this._realDoubleClick():(this._lastClick=a,this._realClick()):(this._lastClick=a,this._clickTimeout=setTimeout(G.Util.bind(this._realClick,this),c));this._lastClickTime=b},_realClick:function(){clearTimeout(this._clickTimeout);var a=this._lastClick;this._lastClick=null;this._lastClickTime=+new Date;this.fireEvent("click",{x:a[0],y:a[1]})},
_realDoubleClick:function(){clearTimeout(this._clickTimeout);var a=this._lastClick;this._lastClick=null;this._lastClickTime=+new Date;this.fireEvent("doubleclick",{x:a[0],y:a[1]})}});
G.DomDraggable=G.Class.extend({mixins:[G.Event],init:function(a,b,c){this._element=a;this._dragStartTarget=b||a;this._dragEdge=c||0},on:function(){var a=G.DomUtil,b=this.virtualMouse;if(!this._enabled){for(var c in b.DOWN)a.addListener(this._dragStartTarget,b.DOWN[c],this._onDown,this);this._enabled=!0}return this},off:function(){var a=G.DomUtil,b=this.virtualMouse;if(this._enabled){for(var c in b.DOWN)a.removeListener(this._dragStartTarget,b.DOWN[c],this._onDown,this);this._enabled=!1}this._dragged=
!1;return this},_onDown:function(a){if(!a.shiftKey&&(1===a.which||1===a.button||a.touches)){var b=G.DomUtil;if(!G.DomDraggable.forbidden&&!this._dragging){for(var c=(a||a.touches[0]).target;c;){if("g-popup"==c.className)return;c=c.parentElement}var d=a.touches?a.touches[0]:a,c=d.clientX,e=d.clientY,f=this._dragStartTarget,h=this._dragEdge,k=b.getPositionNocache(f),l=d.clientX-(k[0]||0),d=d.clientY-(k[1]||0),k=b.getSizeNocache(f),n=Number.MAX_VALUE,f=k[0]||n,k=k[1]||n;l<h||l>f-h||(d<h||d>k-h)||(b.stopPropagation(a),
b.preventDefault(a),b.disableImageDrag(),b.disableTextSelection(),this._dragged=!1,this._startClientX=c,this._startClientY=e,c=[0,0],this._startX=this._newX=c[0],this._startY=this._newY=c[1],c=this.virtualMouse,b.addListener(document,c.MOVE[a.type],this._onMove,this),b.addListener(document,c.UP[a.type],this._onUp,this))}}},_onMove:function(a){if(!(a.touches&&1<a.touches.length)){var b=G.Util,c=G.DomUtil,d=a.touches&&1===a.touches.length?a.touches[0]:a,e=d.clientX-this._startClientX,d=d.clientY-this._startClientY;
if(e||d){var f,h,k,l;this._dLimit&&4==this._dLimit.length&&(f=Math.min(this._dLimit[0],0),h=Math.max(this._dLimit[1],0),k=Math.max(this._dLimit[2],0),l=Math.min(this._dLimit[3],0),e=Math.min(Math.max(e,f),k),d=Math.min(Math.max(d,l),h));c.stopPropagation(a);c.preventDefault(a);this._dragged||(this._dragged=!0,this.fireEvent("dragStart"),c.addClass(document.body,"g-dragging"));this._newX=this._startX+e;this._newY=this._startY+d;this._dragging=!0;b.cancelAnimFrame(this._animRequest);this._animRequest=
b.requestAnimFrame(this._updatePosition,!0,this,this._dragStartTarget)}}},_updatePosition:function(){var a=G.DomUtil,b=this._element;a.markPosTransform(b,this._newX,this._newY);a.updateTransform(b);this.fireEvent("drag")},_onUp:function(){var a=G.DomUtil,b=this.virtualMouse;a.removeClass(document.body,"g-dragging");for(var c in b.MOVE)a.removeListener(document,b.MOVE[c],this._onMove,this),a.removeListener(document,b.UP[c],this._onUp,this);a.enableImageDrag();a.enableTextSelection();this._dragging&&
(this._dragging=!1,G.Util.cancelAnimFrame(this._animRequest),this.fireEvent("dragEnd"))}});
G.DomPinchable=G.Class.extend({mixins:[G.Event],init:function(a,b){this._element=a;this._pinchStartTarget=b||a},on:function(){var a=G.DomUtil,b=this.virtualMouse;if(!this._enabled){for(var c in b.DOWN)a.addListener(this._pinchStartTarget,b.DOWN[c],this._onDown,this);this._enabled=!0}return this},off:function(){var a=G.DomUtil,b=this.virtualMouse;if(this._enabled){for(var c in b.DOWN)a.removeListener(this._pinchStartTarget,b.DOWN[c],this._onDown,this);this._enabled=!1}return this},_onDown:function(a){if(a.touches&&
2===a.touches.length){var b=G.DomUtil;if(!G.DomPinchable.forbidden&&!this._pinching){b.stopPropagation(a);b.preventDefault(a);b.disableImageDrag();b.disableTextSelection();var c=this.virtualMouse;b.addListener(document,c.MOVE[a.type],this._onMove,this);b.addListener(document,c.UP[a.type],this._onUp,this);b.addClass(document.body,"g-pinching");this._pinching=!0;this.fireEvent("pinchStart",{originTouch1:a.touches[0],originTouch2:a.touches[1]})}}},_onMove:function(a){if(a.touches&&2===a.touches.length&&
this._pinching){var b=G.DomUtil;b.stopPropagation(a);b.preventDefault(a);this._touches=a.touches;G.Util.cancelAnimFrame(this._animRequest);this._animRequest=G.Util.requestAnimFrame(this._updatePosition,!0,this,this._pinchStartTarget)}},_updatePosition:function(){var a=this._touches;this.fireEvent("pinch",{originTouch1:a[0],originTouch2:a[1]})},_onUp:function(a){var b=G.DomUtil,c=this.virtualMouse,d;for(d in c.MOVE)b.removeListener(document,c.MOVE[d],this._onMove,this),b.removeListener(document,c.UP[d],
this._onUp,this);b.stopPropagation(a);b.preventDefault(a);b.enableImageDrag();b.enableTextSelection();c=a.touches[0];a=a.touches[1];this._pinching&&(G.Util.cancelAnimFrame(this._animRequest),this.fireEvent("pinchEnd",{originTouch1:c,originTouch2:a}));b.removeClass(document.body,"g-pinching");this._pinching=!1}});
G.GeomUtil={geomType:function(a){var b=G.Util;if(b.isArray(a))return this._singleGeomType(a);if((a=a.m)&&b.isArray(a[0]))return"Multi"+this._singleGeomType(a[0])},centroid:function(a){var b=this.geomType(a),c=0,d=0,e=0,f,h,k,l,n,m,p;if("Extent"==b)return[(a[0]+a[2])/2,(a[1]+a[3])/2];if("Point"==b||"Circle"==b)return[a[0],a[1]];if("Polyline"==b){f=0;for(h=a.length;f<h-1;f++)k=a[f],l=a[f+1],n=G.MathUtil.calcHypotenuse(k[0]-l[0],k[1]-l[1]),c+=(k[0]+l[0])/2*n,d+=(k[1]+l[1])/2*n,e+=n;return[c/e,d/e]}if("Polygon"==
b){f=0;for(h=a.length;f<h;f++)l=a[f],k=this._islandCentroid(l),l=this._islandArea(l)*(0==f?1:-1),c+=k[0]*l,d+=k[1]*l,e+=l;return[c/e,d/e]}if("MultiPoint"==b){b=0;for(m=a.m.length;b<m;b++)k=a.m[b],c+=k[0],d+=k[1],e+=1;return[c/e,d/e]}if("MultiPolyline"==b){b=0;for(m=a.m.length;b<m;b++)for(p=a.m[b],f=0,h=p.length;f<h-1;f++)k=p[f],l=p[f+1],n=G.MathUtil.calcHypotenuse(k[0]-l[0],k[1]-l[1]),c+=(k[0]+l[0])/2*n,d+=(k[1]+l[1])/2*n,e+=n;return[c/e,d/e]}if("MultiPolygon"==b){b=0;for(m=a.m.length;b<m;b++)for(p=
a.m[b],f=0,h=p.length;f<h;f++)l=p[f],k=this._islandCentroid(l),l=this._islandArea(l)*(0==f?1:-1),c+=k[0]*l,d+=k[1]*l,e+=l;return[c/e,d/e]}},labelPoint:function(a){var b=this.geomType(a),c=this.centroid(a),d,e,f=0,h=0;if("Extent"==b||"Point"==b||"Circle"==b)return c;if("Polyline"==b)return this._hitPolyline(c,a)?c:this._nearestOfPolyline(c,a);if("Polygon"==b)return this._hitPolygon(c,a)?c:this._nearestOfPolyline(c,1<a.length?a[1]:a[0]);if("MultiPoint"==b)return this._nearestOfPoints(c,a.m);if("MultiPolyline"==
b){b=0;for(d=a.m.length;b<d;b++)mGeom=a.m[b],e=this._polylineLength(mGeom),e>f&&(h=b,f=e);mGeom=a.m[h];return this._hitPolyline(c,mGeom)?c:this._nearestOfPolyline(c,mGeom)}if("MultiPolygon"==b){b=0;for(d=a.m.length;b<d;b++)mGeom=a.m[b],e=this._polygonArea(mGeom),e>f&&(h=b,f=e);mGeom=a.m[h];return this._hitPolygon(c,mGeom)?c:this._nearestOfPolyline(c,1<mGeom.length?mGeom[1]:mGeom[0])}},_singleGeomType:function(a){var b=G.Util;if(b.isArray(a[0]))return b.isArray(a[0][0])?"Polygon":"Polyline";if(4==
a.length)return"Extent";if(3==a.length)return"Circle";if(2==a.length)return"Point"},_middlePoint:function(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]},_closestToPoint:function(a,b,c){var d=b[0];b=b[1];var e=c[0]-d,f=c[1]-b,h=e*e+f*f;0<h&&(a=((a[0]-d)*e+(a[1]-b)*f)/h,1<a?(d=c[0],b=c[1]):0<a&&(d+=e*a,b+=f*a));return[d,b]},_nearestOfPoints:function(a,b){for(var c,d,e=Number.MAX_VALUE,f=0,h=b.length;f<h;f++)c=b[f],sqrDis=this._sqrDist(a,c),sqrDis<e&&(d=c,e=sqrDis);return d||b[0]},_nearestOfPolyline:function(a,
b){for(var c,d,e,f=Number.MAX_VALUE,h=0,k=b.length-1;h<k;h++)c=b[h],d=b[h+1],sqrDis=this._sqrDistToPoint(a,c,d),sqrDis<f&&(e=[c,d],f=sqrDis);return e?this._closestToPoint(a,e[0],e[1]):b[0]},_sqrDist:function(a,b){var c=a[0]-b[0],d=a[1]-b[1];return c*c+d*d},_sqrDistToPoint:function(a,b,c){b=this._closestToPoint(a,b,c);return this._sqrDist(a,b)},_polylineLength:function(a){var b,c,d,e=a.length,f=0;if(2>e)return 0;for(d=0;d<e-1;d++)b=a[d],c=a[d+1],f+=Math.pow(this._sqrDist(b,c),0.5);return f},_polygonArea:function(a){var b,
c,d,e=0;b=0;for(c=a.length;b<c;b++)d=a[b],e+=this._islandArea(d)*(0==b?1:-1);return e},_hitPolyline:function(a,b,c){var d,e;c=(c||0)*(c||0);for(var f=0,h=b.length-1;f<h;f++)if(d=b[f],e=b[f+1],d=this._sqrDistToPoint(a,d,e),d<=c)return!0;return!1},_hitPolygon:function(a,b){var c=!1,d,e,f,h,k;d=0;for(iLen=b.length;d<iLen;d++)for(f=b[d],e=0,jLen=f.length;e<jLen;e++){h=f[e];if(h[0]===a[0]&&h[1]===a[1])return!0;k=e===jLen-1?f[0]:f[e+1];h[1]>a[1]!==k[1]>a[1]&&a[0]<(k[0]-h[0])*(a[1]-h[1])/(k[1]-h[1])+h[0]&&
(c=!c)}return c},_islandCentroid:function(a){var b=0,c=0,d=0,e,f,h;e=0;for(f=a.length;e<f;e++)h=a[e],b+=h[0],c+=h[1],d++;return[b/d,c/d]},_islandArea:function(a){var b,c,d,e=a.length,f=0;if(3>e)return 0;for(d=0;d<e-1;d++)b=a[d],c=a[d+1],f+=this._vectorArea(b,c);f+=this._vectorArea(a[e-1],a[0]);return Math.abs(f)},_vectorArea:function(a,b){var c=G.MathUtil,d=c.calcTheta(a[0],a[1])-G.MathUtil.calcTheta(b[0],b[1]),e=c.calcHypotenuse(a[0],a[1]),c=c.calcHypotenuse(b[0],b[1]);return e*c*Math.sin(d)/2}};
G.ExtentUtil={overlaps:function(a,b,c){if(!a||!b)return!1;var d=a[1],e=a[2],f=a[3],h=b[0],k=b[1],l=b[3];c=c||0;return a[0]>b[2]+c||e<h-c||d>l+c||f<k-c?!1:!0},contains:function(a,b,c){if(!a||!b)return!1;var d=a[0],e=a[1],f=a[3],h=b[0];b=b[1];c=c||0;return h-a[2]>c||d-h>c||b-f>c||e-b>c?!1:!0},intersect:function(a,b){var c=Math.min,d=Math.max;if(a&&b){var e=d(a[0],b[0]),d=d(a[1],b[1]),f=c(a[2],b[2]),c=c(a[3],b[3]);if(!(e>=f||d>=c))return[e,d,f,c]}else if(a||b)return a?a:b},union:function(a,b){var c=
Math.min,d=Math.max;if(a&&b){var e=c(a[0],b[0]),c=c(a[1],b[1]),f=d(a[2],b[2]),d=d(a[3],b[3]);return[e,c,f,d]}if(a||b)return a?a:b},equals:function(a,b,c){var d=a[1],e=a[2],f=a[3],h=b[1],k=b[2],l=b[3],n=Math.abs;c=c||0;return n(a[0]-b[0])<=c&&n(e-k)<=c&&n(d-h)<=c&&n(f-l)<=c?!0:!1}};
G.GeodeticUtil={RADIUS:6378137,sphereDistance:function(a,b){var c=Math.cos,d=Math.sin,e=Math.pow,f=G.MathUtil.DEGREE_PER_RADIAN,h=a[1]/f,k=b[1]/f,l=b[0]/f-a[0]/f,f=c(l),n=d(l),l=c(h),h=d(h),c=c(k),d=d(k),k=e(c*n,2),e=e(l*d-h*c*f,2),e=Math.sqrt(k+e);return this.RADIUS*Math.atan2(e,h*d+l*c*f)}};
G.Graphic=G.Class.extend({mixins:[G.Event],options:{clickable:!1,allowPan:!1,vertexSize:16,vertexShape:"circle",vertexColor:"#fff",vertexOutlineWidth:2,vertexDashArray:[6,2],vertexFillColor:"#ff0",lineHighlightColor:"#0ff",lineHighlightWiden:2},addTo:function(a,b,c){var d;if(a instanceof G.Layer.Graphic){if(this._layer)return this._layer===a?a:null;this._layer=a;if(b&&(d=a._graphics[b]))return d;this._id=b?b:a._idSeq++;this._index=a._indexSeq++;this._addAt=+new Date;a._graphics[this._id]=this;a._tree.insert(this.bbox,
this);a.addListener("update",this._onUpdate,this);b=a._calcStyle(this);G.Util.merge(this.options,b);if(b=a._map)b.addListener("viewChanged",this._onViewChanged,this),b.addListener("zoomStart",this._onZoomStart,this),b.addListener("zoomUpdate",this._onZoomUpdate,this),b.addListener("zoomEnd",this._onZoomEnd,this);this._onAdded();b&&!c&&b._requestRedraw();this._isVertex||a.fireEvent("graphicAdded",{graphic:this});return this}},remove:function(a){var b=this._layer;if(b){this.endEdit();b.removeListener("update",
this._onUpdate,this);b._tree.remove(this.bbox,this);this._onRemoved();delete b._graphics[this._id];delete this._id;delete this._layer;var c=b._map;c&&(c.removeListener("viewChanged",this._onViewChanged,this),c.removeListener("zoomStart",this._onZoomStart,this),c.removeListener("zoomUpdate",this._onZoomUpdate,this),c.removeListener("zoomEnd",this._onZoomEnd,this),a||c._requestRedraw());this._isVertex||b.fireEvent("graphicRemoved",{graphic:this});return this}},id:function(){return this._id},updateOptions:function(a,
b){var c=this._layer,d;a&&G.Util.merge(this.options,a);this._updateStyles();c&&(b||(d=c._map)&&d._requestRedraw(),this._isVertex||c.fireEvent("graphicOptionsUpdated",{graphic:this}));return this},updateGeom:function(a,b){var c=this._layer,d;c&&c._tree.remove(this.bbox,this);this._updateGeom(a);c&&(c._tree.insert(this.bbox,this),b||(d=c._map)&&d._requestRedraw(),this._isVertex||c.fireEvent("graphicGeomUpdated",{graphic:this}));return this},updateAttrs:function(a,b){var c=this._layer,d;a&&G.Util.merge(this.attrs,
a);c&&((d=c._calcStyle(this))&&this.updateOptions(d,b),this._isVertex||c.fireEvent("graphicAttrUpdated",{graphic:this}));return this},bringToTop:function(){var a=this._layer;if(!a)return this;this._index=a._indexSeq++;var b=a._map;if(!b)return this;var c,d;d=G.Browser;"canvas"==b._mode||"webgl"==b._mode?b._requestRedraw():"svg"!=b._mode||d.ie?"svg"!=b._mode&&"vml"!=b._mode||!d.ie||(d=this._dom)&&G.DomUtil.setZIndex(d,this._index):(d=this._dom)&&(b=d.parentNode)&&b.appendChild(d);for(c in this._vertexes)b=
this._vertexes[c],b.bringToTop();for(c in this._midvertexes)b=this._midvertexes[c],b.bringToTop();this._isVertex||a.fireEvent("graphicToTop",{graphic:this});return this},startEdit:function(a){var b=this._layer;G.Util.merge(this.options,a);this._editing||this._isVertex||(this._editing=!0,this._onStartEdit(),b&&b.fireEvent("graphicStartEdit",{graphic:this}));return this},endEdit:function(){var a=this._layer;this._editing&&!this._isVertex&&(this._onEndEdit(),this._editing=!1,a&&(a.fireEvent("graphicEndEdit",
{graphic:this}),(a=a._map)&&G.DomUtil.removeClass(a._layersFrame,"g-edit")));return this},isEditing:function(){return!!this._editing},_updateBbox:function(a){var b=this._layer;b&&(b._tree.remove(this.bbox,this),this.bbox=a,b._tree.insert(this.bbox,this))},_hitPoint:function(a,b,c,d){var e=this._hitPointNowrap(a,b,c,d);if(e)return!0;var f;this._layer&&this._layer._map&&(f=this._layer._map);if(!e&&f&&f.options.wrap){var h=[a[0],a[1]],k=f._calcWrapPointRange(a),e=f.options.maxExtent;f=e[2]-e[0];for(var l=
k[0];l<=k[1];l++)if(h[0]=a[0]+l*f,e=this._hitPointNowrap(h,b,c,d))return!0}return!1},_searchVertex:function(a){var b=this._layer._map,c=b._res,d=b.options.touchTol,d=G.Browser.touch?d:0,e,f;for(f in this._vertexes)if(e=this._vertexes[f],e._hitPoint(a,c,b._rotate,d))return e;for(f in this._midvertexes)if(e=this._midvertexes[f],e._hitPoint(a,c,b._rotate,d))return e},_removeVertexes:function(){var a=this._layer._map,b,c;for(b in this._vertexes)c=this._vertexes[b],c.remove(!0);this._vertexes={};for(b in this._midvertexes)c=
this._midvertexes[b],c.remove(!0);this._midvertexes={};a._requestRedraw()},_onVertexMouseOver:function(){var a=this._layer._map,b=a._handlers.Drag;b&&!b._dragging&&b.off();G.DomUtil.addClass(a._layersFrame,"g-edit")},_onVertexMouseOut:function(){var a=this._layer._map,b=a._handlers.Drag;if(b&&!b._dragging)b.on();G.DomUtil.removeClass(a._layersFrame,"g-edit")},clone:function(){},_draw:function(){},_updateStyles:function(){},_erase:function(){var a=this._dom;a&&a.parentNode&&a.parentNode.removeChild(a)},
_updateGeom:function(a){},_hitPointNowrap:function(a,b,c,d){},_onMouseOver:function(){},_onMouseOut:function(){},_onStartEdit:function(){},_onEndEdit:function(){},_onViewChanged:function(a){},_onUpdate:function(a){},_onAdded:function(){},_onRemoved:function(){},_onGeomUpdated:function(){},_onZoomStart:function(a){},_onZoomUpdate:function(a){},_onZoomEnd:function(a){}});
G.Graphic.Point=G.Graphic.extend({options:{shape:"circle",size:[12,12],offset:[0,0],image:"",imageRotate:0,imageGravity:!0,text:"",textFont:"Arial",textStyle:"normal",textAlign:"center",outline:!1,outlineColor:"#000",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#3dc0fd",fillImage:"",fillImageSize:[24,24],fillOpacity:1,gradual:!1},init:function(a,b,c){a&&1<a.length&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){return new G.Graphic.Point([this.geom[0],
this.geom[1]],G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;var b,c;b=a[0];c=a[1];this.geom=a;this.bbox=[b,c,b,c];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){var e=Math.abs,f=this.options,h=f.shape,k=f.size,l=k[0],k=k[1];d=d||0;var n=f.offset,m=this._mouseOver?f.outlineWidth+f.lineHighlightWiden:f.outline?f.outlineWidth:0,m=(m+2*d)/2,p=f.imageRotate;"image"===h&&p&&(c-=p);p=a[0];a=a[1];var q;this._layer&&this._layer._map&&(q=this._layer._map,
"image"!==h||f.imageGravity||(c-=q._rotate));f=f.textAlign;q=this.geom;a=[p-q[0],a-q[1]];a=G.MathUtil.rotateVector(a,-(c||0));c=a[0]/b-n[0];b=-a[1]/b-n[1];if("circle"===h){if(G.MathUtil.calcHypotenuse(c,b)<=l/2+m)return!0}else if("rect"===h){if(e(c)<=l/2+m&&e(b)<=k/2+m)return!0}else if("image"===h){if(c>=-d&&c<=l+d&&b>=-d&&b<=k+d)return!0}else if("text"===h&&("left"==f?(h=-d,k=(this._textMeasureWidth||l)+d):"right"==f?(h=-(this._textMeasureWidth||l)-d,k=d):(h=-(this._textMeasureWidth||l)/2-d,k=-h),
c>=h&&c<=k&&e(b)<=l/2+d))return!0;return!1},_refreshVertexes:function(){var a=this.geom,b=this._layer._map,c=this.options;this._removeVertexes();a=this._vertexes[0]=new G.Graphic.Point(a,null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:c.vertexFillColor,fillOpacity:1,clickable:!0});a._isVertex=!0;a._idVertex=0;a._graphic=this;a.addTo(this._layer);
b._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();h=[0,0];if(b.options.wrap){var k=b._calcRealCoords(c);h[0]=k[0]-c[0];h[1]=k[1]-c[1]}this._drag={vertex:f,wrapOffset:h,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},
_onVertexDrag:function(a){var b=this._layer._map,c=this._drag,d;c&&(d=c.vertex)&&(wrapOffset=c.wrapOffset||[0,0],a=b._calcRealCoords([a.mapX,a.mapY]),a=[a[0]+wrapOffset[0],a[1]+wrapOffset[1]],this.geom=d.geom=a,this.updateGeom(),d.updateGeom())},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();if(e=this._drag)d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),(d=e.vertex)&&d.updateGeom();b.removeListener(c.MOVE[a.type],
this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.Polyline=G.Graphic.extend({options:{lineColor:"#ff941b",lineDashArray:[],lineCap:"butt",lineJoin:"round",lineWidth:4,lineOpacity:1},init:function(a,b,c){a&&0<a.length&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){for(var a=this.geom,b=[],c=0;c<a.length;c++)pt=a[c],b[c]=[pt[0],pt[1]];return new G.Graphic.Polyline(b,G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;for(var b,c,d,e,f,h,k=
0,l=a.length;k<l;k++)b=a[k],c=b[0],b=b[1],d=void 0===d?c:Math.min(d,c),e=void 0===e?c:Math.max(e,c),f=void 0===f?b:Math.min(f,b),h=void 0===h?b:Math.max(h,b);this.geom=a;this.bbox=[d,f,e,h];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){c=this.options;return G.GeomUtil._hitPolyline(a,this.geom,((this._mouseOver?c.lineWidth+c.lineHighlightWiden:c.lineWidth)/2+(d||0))*b)},_refreshVertexes:function(){var a=this.geom,b=a.length,c=this._layer._map,d=this.options;this._removeVertexes();var e,
f;for(e=0;e<b;e++)f=this._vertexes[e]=new G.Graphic.Point(a[e],null,{shape:d.vertexShape,size:[d.vertexSize,d.vertexSize],outline:!0,outlineColor:d.vertexColor,outlineDashArray:d.vertexDashArray,outlineWidth:d.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:d.vertexFillColor,fillOpacity:1,clickable:!0}),f._isVertex=!0,f._idVertex=e,f._graphic=this,f.addTo(this._layer),0<e&&(f=G.GeomUtil._middlePoint(a[e-1],a[e]),f=this._midvertexes[e]=new G.Graphic.Point(f,null,{shape:d.vertexShape,size:[d.vertexSize,
d.vertexSize],outline:!0,outlineColor:d.vertexColor,outlineDashArray:d.vertexDashArray,outlineWidth:d.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),f._isVertex=!0,f._idVertex=e,f._isMid=!0,f._graphic=this,f.addTo(this._layer));c._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();var h=[f.geom[0],f.geom[1]],k=f._idVertex;f._isMid&&(f=this.geom.slice(0,
k),f=f.concat([h]),this.geom=f=f.concat(this.geom.slice(k)),this._refreshVertexes(),f=this._searchVertex(c));this._drag={vertex:f,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},_onVertexDrag:function(a){var b=this._drag,c;if(b&&(b=b.vertex))for(c=[a.mapX,a.mapY],a=b._idVertex,this.geom[a]=b.geom=c,this.updateGeom(),b.updateGeom(),c=a;c<=a+1;c++)if(b=this._midvertexes[c])b.geom=
G.GeomUtil._middlePoint(this.geom[c-1],this.geom[c]),b.updateGeom()},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();var e=this._drag,f;e&&(d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),f=e.vertex)&&(d=f._idVertex,e=+new Date-e.startAt,200>e&&!f._isMid&&2<this.geom.length?(e=this.geom.slice(0,d),this.geom=e=e.concat(this.geom.slice(d+1)),this.updateGeom(),this._refreshVertexes()):f.updateGeom());b.removeListener(c.MOVE[a.type],
this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.Polygon=G.Graphic.extend({options:{outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:0.6},init:function(a,b,c){a&&0<a.length&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){for(var a=this.geom,b=[],c=0,d=a.length;c<d;c++){part=a[c];b[c]=b[c]||[];for(var e=0,f=part.length;e<f;e++)pt=part[e],
b[c][e]=[pt[0],pt[1]]}return new G.Graphic.Polygon(b,G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;for(var b=a[0],c,d,e,f,h,k,l=0,n=b.length;l<n;l++)c=b[l],d=c[0],c=c[1],e=void 0===e?d:Math.min(e,d),f=void 0===f?d:Math.max(f,d),h=void 0===h?c:Math.min(h,c),k=void 0===k?c:Math.max(k,c);this.geom=a;this.bbox=[e,h,f,k];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){var e=this.options;a=[a[0],a[1]];c=this._mouseOver?e.outlineWidth+e.lineHighlightWiden:
e.outline?e.outlineWidth:0;c+=2*(d||0);d=c*b/2;if(this.bbox&&(d=[this.bbox[0]-d,this.bbox[1]-d,this.bbox[2]+d,this.bbox[3]+d],!G.ExtentUtil.contains(d,a)))return!1;d=this.geom;var f,h,k,l=G.Graphic.Polyline.prototype._hitPointNowrap;if(G.GeomUtil._hitPolygon(a,d))return!0;if(e.outline||this._mouseOver)for(e=0,f=d.length;e<f;e++)if(h=d[e],k=[h[h.length-1],h[0]],h={geom:h,options:{lineWidth:c}},k={geom:k,options:{lineWidth:c}},l.call(h,a,b)||l.call(k,a,b))return!0;return!1},_refreshVertexes:function(){var a=
this.geom,b=this._layer._map,c=this.options;this._removeVertexes();var d,e,f,h,k,l;d=0;for(e=a.length;d<e;d++)for(k=a[d],f=0,h=k.length;f<h;f++)l=this._vertexes[d+","+f]=new G.Graphic.Point(k[f],null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:c.vertexFillColor,fillOpacity:1,clickable:!0}),l._isVertex=!0,l._idVertex=[d,f],l._graphic=this,l.addTo(this._layer),
l=0==f?G.GeomUtil._middlePoint(k[h-1],k[0]):G.GeomUtil._middlePoint(k[f-1],k[f]),l=this._midvertexes[d+","+f]=new G.Graphic.Point(l,null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),l._isVertex=!0,l._idVertex=[d,f],l._isMid=!0,l._graphic=this,l.addTo(this._layer);b._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,
a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();var h=[f.geom[0],f.geom[1]],k=f._idVertex,l=k[0],k=k[1];f._isMid&&(f=this.geom[l].slice(0,k),f=f.concat([h]),f=f.concat(this.geom[l].slice(k)),this.geom[l]=f,this._refreshVertexes(),f=this._searchVertex(c));this._drag={vertex:f,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,
this)}},_onVertexDrag:function(a){var b=this._drag,c,d,e,f;if(b&&(c=b.vertex))for(d=[a.mapX,a.mapY],b=c._idVertex,a=b[0],b=b[1],this.geom[a][b]=c.geom=d,this.updateGeom(),c.updateGeom(),d=b;d<=b+1;d++)if(e=0<d?d-1:this.geom[a].length-1,f=d>=this.geom[a].length?0:d,c=this._midvertexes[a+","+f])c.geom=G.GeomUtil._middlePoint(this.geom[a][e],this.geom[a][f]),c.updateGeom()},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();var e=this._drag,
f,h;e&&(d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),f=e.vertex)&&(h=f._idVertex,d=h[0],h=h[1],e=+new Date-e.startAt,200>e&&!f._isMid&&3<this.geom[d].length?(0==h?e=this.geom[d].slice(1,this.geom[d].length):h==this.geom[d].length-1?e=this.geom[d].slice(0,h):(e=this.geom[d].slice(0,h),e=e.concat(this.geom[d].slice(h+1))),this.geom[d]=e,this.updateGeom(),this._refreshVertexes()):f.updateGeom());b.removeListener(c.MOVE[a.type],this._onVertexDrag,this);b.removeListener(c.UP[a.type],
this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.MultiPoint=G.Graphic.extend({options:{shape:"circle",size:[12,12],offset:[0,0],image:"",imageRotate:0,imageGravity:!0,text:"",textFont:"Arial",textStyle:"normal",textAlign:"center",outline:!1,outlineColor:"#000",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#3dc0fd",fillImage:"",fillImageSize:[24,24],fillOpacity:1,gradual:!1},init:function(a,b,c){a&&(a.m&&0<a.m.length)&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){var a=
this.geom.m,b=a.length,c=[],d,e;for(d=0;d<b;d++)e=a[d],c[d]=[e[0],e[1]];return new G.Graphic.MultiPoint({m:c},G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;for(var b=a.m,c,d,e,f,h,k,l=0,n=b.length;l<n;l++)c=b[l],d=c[0],c=c[1],e=void 0===e?d:Math.min(e,d),f=void 0===f?d:Math.max(f,d),h=void 0===h?c:Math.min(h,c),k=void 0===k?c:Math.max(k,c);this.geom=a;this.bbox=[e,h,f,k];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){var e=Math.abs,f=
this.options,h=f.shape,k=f.size,l=k[0],k=k[1];d=d||0;var n=f.offset,m=this._mouseOver?f.outlineWidth+f.lineHighlightWiden:f.outline?f.outlineWidth:0,m=(m+2*d)/2,p=f.imageRotate;"image"===h&&p&&(c-=p);p=a[0];a=a[1];var q;this._layer&&this._layer._map&&(q=this._layer._map,"image"!==h||f.imageGravity||(c-=q._rotate));f=f.textAlign;q=this.geom.m;for(var r,x=0,w=q.length;x<w;x++){r=q[x];var v=[p-r[0],a-r[1]],v=G.MathUtil.rotateVector(v,-(c||0));r=v[0]/b-n[0];v=-v[1]/b-n[1];if("circle"===h){if(G.MathUtil.calcHypotenuse(r,
v)<=l/2+m)return!0}else if("rect"===h){if(e(r)<=l/2+m&&e(v)<=k/2+m)return!0}else if("image"===h){if(r>=-d&&r<=l+d&&v>=-d&&v<=k+d)return!0}else if("text"===h){var s,u;"left"==f?(s=-d,u=(this._textMeasureWidth||l)+d):"right"==f?(s=-(this._textMeasureWidth||l)-d,u=d):(s=-(this._textMeasureWidth||l)/2-d,u=-s);if(r>=s&&r<=u&&e(v)<=l/2+d)return!0}}return!1},_refreshVertexes:function(){var a=this.geom.m,b=a.length,c=this._layer._map,d=this.options;this._removeVertexes();var e,f;for(e=0;e<b;e++)f=this._vertexes[e]=
new G.Graphic.Point(a[e],null,{shape:d.vertexShape,size:[d.vertexSize,d.vertexSize],outline:!0,outlineColor:d.vertexColor,outlineDashArray:d.vertexDashArray,outlineWidth:d.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:d.vertexFillColor,fillOpacity:1,clickable:!0}),f._isVertex=!0,f._idVertex=e,f._graphic=this,f.addTo(this._layer);c._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;
h&&h.off();h=[0,0];if(b.options.wrap){var k=b._calcRealCoords(c);h[0]=k[0]-c[0];h[1]=k[1]-c[1]}this._drag={vertex:f,wrapOffset:h,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},_onVertexDrag:function(a){var b=this._layer._map,c=this._drag,d;c&&(d=c.vertex)&&(wrapOffset=c.wrapOffset||[0,0],a=b._calcRealCoords([a.mapX,a.mapY]),a=[a[0]+wrapOffset[0],a[1]+wrapOffset[1]],
b=d._idVertex,this.geom.m[b]=d.geom=a,this.updateGeom(),d.updateGeom())},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();if(e=this._drag)d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),(d=e.vertex)&&d.updateGeom();b.removeListener(c.MOVE[a.type],this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.MultiPolyline=G.Graphic.extend({options:{lineColor:"#ff941b",lineDashArray:[],lineCap:"butt",lineJoin:"round",lineWidth:4,lineOpacity:1},init:function(a,b,c){a&&(a.m&&0<a.m.length)&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){var a=this.geom.m,b=a.length,c=[],d,e,f,h;for(e=0;e<b;e++)for(f=a[e],c[e]=[],d=0;d<f.length;d++)h=f[d],c[e][d]=[h[0],h[1]];return new G.Graphic.MultiPolyline({m:c},G.Util.merge({},this.attrs),G.Util.merge({},this.options))},
_updateGeom:function(a){a=a||this.geom;for(var b=a.m,c,d,e,f,h,k,l,n=0,m=b.length;n<m;n++){c=b[n];for(var p=0,q=c.length;p<q;p++)d=c[p],e=d[0],d=d[1],f=void 0===f?e:Math.min(f,e),h=void 0===h?e:Math.max(h,e),k=void 0===k?d:Math.min(k,d),l=void 0===l?d:Math.max(l,d)}this.geom=a;this.bbox=[f,k,h,l];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){c=this.options;b*=(this._mouseOver?c.lineWidth+c.lineHighlightWiden:c.lineWidth)/2+(d||0);d=this.geom.m;for(var e=0,f=d.length;e<f;e++)if(c=d[e],G.GeomUtil._hitPolyline(a,
c,b))return!0;return!1},_refreshVertexes:function(){var a=this.geom.m,b=this._layer._map,c=this.options;this._removeVertexes();var d,e,f,h,k,l;d=0;for(e=a.length;d<e;d++)for(k=a[d],f=0,h=k.length;f<h;f++)l=this._vertexes[d+","+f]=new G.Graphic.Point(k[f],null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:c.vertexFillColor,fillOpacity:1,clickable:!0}),
l._isVertex=!0,l._idVertex=[d,f],l._graphic=this,l.addTo(this._layer),0<f&&(l=G.GeomUtil._middlePoint(k[f-1],k[f]),l=this._midvertexes[d+","+f]=new G.Graphic.Point(l,null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),l._isVertex=!0,l._idVertex=[d,f],l._isMid=!0,l._graphic=this,l.addTo(this._layer));b._requestRedraw()},_onVertexDragStart:function(a){var b=
this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();var h=[f.geom[0],f.geom[1]],k=f._idVertex,l=k[0],k=k[1];f._isMid&&(f=this.geom.m[l].slice(0,k),f=f.concat([h]),f=f.concat(this.geom.m[l].slice(k)),this.geom.m[l]=f,this._refreshVertexes(),f=this._searchVertex(c));this._drag={vertex:f,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);
b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},_onVertexDrag:function(a){var b=this._drag,c,d,e,f;if(b&&(c=b.vertex))for(d=[a.mapX,a.mapY],b=c._idVertex,a=b[0],b=b[1],this.geom.m[a][b]=c.geom=d,this.updateGeom(),c.updateGeom(),d=b;d<=b+1;d++)if(e=0<d?d-1:this.geom.m[a].length-1,f=d>=this.geom.m[a].length?0:d,c=this._midvertexes[a+","+f])c.geom=G.GeomUtil._middlePoint(this.geom.m[a][e],this.geom.m[a][f]),c.updateGeom()},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,
d=G.DomUtil,e=b._handlers.Click;if(e)e.on();var e=this._drag,f,h;e&&(d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),f=e.vertex)&&(h=f._idVertex,d=h[0],h=h[1],e=+new Date-e.startAt,200>e&&!f._isMid&&2<this.geom.m[d].length?(0==h?e=this.geom.m[d].slice(1,this.geom.m[d].length):h==this.geom.m[d].length-1?e=this.geom.m[d].slice(0,h):(e=this.geom.m[d].slice(0,h),e=e.concat(this.geom.m[d].slice(h+1))),this.geom.m[d]=e,this.updateGeom(),this._refreshVertexes()):f.updateGeom());b.removeListener(c.MOVE[a.type],
this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.MultiPolygon=G.Graphic.extend({options:{outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:0.6},init:function(a,b,c){a&&(a.m&&0<a.m.length)&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){var a=this.geom.m,b=a.length,c=[],d,e,f,h,k,l;for(d=0;d<b;d++)for(h=a[d],c[d]=[],e=0;e<h.length;e++)for(l=
h[e],c[d][e]=[],f=0;f<l.length;f++)k=l[f],c[d][e][f]=[k[0],k[1]];return new G.Graphic.MultiPolygon({m:c},G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;for(var b=a.m,c,d,e,f,h,k,l,n=0,m=b.length;n<m;n++){c=b[n];c=c[0];for(var p=0,q=c.length;p<q;p++)d=c[p],e=d[0],d=d[1],f=void 0===f?e:Math.min(f,e),h=void 0===h?e:Math.max(h,e),k=void 0===k?d:Math.min(k,d),l=void 0===l?d:Math.max(l,d)}this.geom=a;this.bbox=[f,k,h,l];this._onGeomUpdated()},_hitPointNowrap:function(a,
b,c,d){c=this.options;a=[a[0],a[1]];var e=this._mouseOver?c.outlineWidth+c.lineHighlightWiden:c.outline?c.outlineWidth:0,e=e+2*(d||0);d=e*b/2;if(this.bbox&&(d=[this.bbox[0]-d,this.bbox[1]-d,this.bbox[2]+d,this.bbox[3]+d],!G.ExtentUtil.contains(d,a)))return!1;d=this.geom.m;var f,h,k,l,n,m,p,q=G.Graphic.Polyline.prototype._hitPointNowrap;h=0;for(k=d.length;h<k;h++){f=d[h];if(G.GeomUtil._hitPolygon(a,f))return!0;if(c.outline||this._mouseOver)for(l=0,n=f.length;l<n;l++)if(m=f[l],p=[m[m.length-1],m[0]],
m={geom:m,options:{lineWidth:e}},p={geom:p,options:{lineWidth:e}},q.call(m,a,b)||q.call(p,a,b))return!0}return!1},_refreshVertexes:function(){var a=this.geom.m,b=this._layer._map,c=this.options;this._removeVertexes();var d,e,f,h,k,l,n,m,p;d=0;for(e=a.length;d<e;d++)for(n=a[d],f=0,h=n.length;f<h;f++)for(m=n[f],k=0,l=m.length;k<l;k++)p=this._vertexes[d+","+f+","+k]=new G.Graphic.Point(m[k],null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,
outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:c.vertexFillColor,fillOpacity:1,clickable:!0}),p._isVertex=!0,p._idVertex=[d,f,k],p._graphic=this,p.addTo(this._layer),p=0==k?G.GeomUtil._middlePoint(m[l-1],m[0]):G.GeomUtil._middlePoint(m[k-1],m[k]),p=this._midvertexes[d+","+f+","+k]=new G.Graphic.Point(p,null,{shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,
fill:!1,clickable:!0}),p._isVertex=!0,p._idVertex=[d,f,k],p._isMid=!0,p._graphic=this,p.addTo(this._layer);b._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();var h=[f.geom[0],f.geom[1]],k=f._idVertex,l=k[0],n=k[1],k=k[2];f._isMid&&(f=this.geom.m[l][n].slice(0,k),f=f.concat([h]),f=f.concat(this.geom.m[l][n].slice(k)),this.geom.m[l][n]=f,this._refreshVertexes(),f=
this._searchVertex(c));this._drag={vertex:f,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},_onVertexDrag:function(a){var b=this._drag,c,d,e,f,h;if(b&&(c=b.vertex))for(d=[a.mapX,a.mapY],e=c._idVertex,a=e[0],b=e[1],e=e[2],this.geom.m[a][b][e]=c.geom=d,this.updateGeom(),c.updateGeom(),d=e;d<=e+1;d++)if(f=0<d?d-1:this.geom.m[a][b].length-1,h=d>=this.geom.m[a][b].length?
0:d,c=this._midvertexes[a+","+b+","+h])c.geom=G.GeomUtil._middlePoint(this.geom.m[a][b][f],this.geom.m[a][b][h]),c.updateGeom()},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();var f=this._drag,h,k;f&&(d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),h=f.vertex)&&(k=h._idVertex,d=k[0],e=k[1],k=k[2],f=+new Date-f.startAt,200>f&&!h._isMid&&3<this.geom.m[d][e].length?(0==k?f=this.geom.m[d][e].slice(1,this.geom.m[d][e].length):
k==this.geom.m[d][e].length-1?f=this.geom.m[d][e].slice(0,k):(f=this.geom.m[d][e].slice(0,k),f=f.concat(this.geom.m[d][e].slice(k+1))),this.geom.m[d][e]=f,this.updateGeom(),this._refreshVertexes()):h.updateGeom());b.removeListener(c.MOVE[a.type],this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.Circle=G.Graphic.extend({options:{outline:!0,outlineColor:"#fff",outlineDashArray:[],outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:0.6,gradual:!1},init:function(a,b,c){a&&3==a.length&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){return new G.Graphic.Circle([this.geom[0],this.geom[1],this.geom[2]],G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=
a||this.geom;var b,c,d;b=a[0];c=a[1];d=a[2];this.geom=a;this.bbox=[b-d,c-d,b+d,c+d];this._onGeomUpdated()},_hitPointNowrap:function(a,b,c,d){c=this.options;c=(c.outline?c.outlineWidth:0)+(this._mouseOver?c.lineHighlightWiden:0);var e=this.geom,f=e[2]/b;return G.MathUtil.calcHypotenuse((a[0]-e[0])/b,-(a[1]-e[1])/b)<f+c/2+(d||0)},_refreshVertexes:function(){var a=this.geom,b=this._layer._map,c=this.options;this._removeVertexes();var d,c={shape:c.vertexShape,size:[c.vertexSize,c.vertexSize],outline:!0,
outlineColor:c.vertexColor,outlineDashArray:c.vertexDashArray,outlineWidth:c.vertexOutlineWidth,outlineOpacity:1,fill:!0,fillColor:c.vertexFillColor,fillOpacity:1,clickable:!0};d=[a[0],a[1]];var e=[a[2],0],e=G.MathUtil.rotateVector(e,b._rotate),a=[a[0]+e[0],a[1]+e[1]];d=this._vertexes[0]=new G.Graphic.Point(d,null,c);d._isVertex=!0;d._idVertex=0;d._graphic=this;d.addTo(this._layer);d=this._vertexes[1]=new G.Graphic.Point(a,null,c);d._isVertex=!0;d._idVertex=1;d._graphic=this;d.addTo(this._layer);
b._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();h=[0,0];if(b.options.wrap){var k=b._calcRealCoords(c);h[0]=k[0]-c[0];h[1]=k[1]-c[1]}this._drag={vertex:f,wrapOffset:h,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},
_onVertexDrag:function(a){var b=this._layer._map,c=this._drag,d;c&&(d=c.vertex)&&(wrapOffset=c.wrapOffset||[0,0],a=b._calcRealCoords([a.mapX,a.mapY]),a=[a[0]+wrapOffset[0],a[1]+wrapOffset[1]],d.updateGeom(a),d._idVertex?(d=this._vertexes[0],this.geom[2]=G.MathUtil.calcDistance(d.geom,a)):(d=this._vertexes[1],c=[this.geom[2],0],c=G.MathUtil.rotateVector(c,b._rotate),d.updateGeom([this.geom[0]+c[0],this.geom[1]+c[1]]),this.geom[0]=a[0],this.geom[1]=a[1]),this.updateGeom())},_onVertexDragEnd:function(a){var b=
this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();if(e=this._drag)d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),(d=e.vertex)&&d.updateGeom();b.removeListener(c.MOVE[a.type],this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.Arrow=G.Graphic.Polygon.extend({options:{headSize:30,headAngle:30,neckSize:25,neckAngle:15,tailSize:0,tailAngle:60,outline:!0,outlineColor:"#ff2e6c",outlineDashArray:[],outlineCap:"round",outlineJoin:"round",outlineWidth:2,outlineOpacity:1,fill:!0,fillColor:"#000",fillImage:"",fillImageSize:[24,24],fillOpacity:0.6},init:function(a,b,c){a&&0<a.length&&this._updateGeom(a);this.attrs=b||{};this.options=G.Util.merge({},this.options,c)},clone:function(){for(var a=this.geom,b=[],c=0;c<a.length;c++)pt=
a[c],b[c]=[pt[0],pt[1]];return new G.Graphic.Arrow(b,G.Util.merge({},this.attrs),G.Util.merge({},this.options))},_updateGeom:function(a){a=a||this.geom;for(var b,c,d,e,f,h,k=0,l=0,n=a.length;l<n;l++)b=a[l],c=b[0],b=b[1],d=void 0===d?c:Math.min(d,c),e=void 0===e?c:Math.max(e,c),f=void 0===f?b:Math.min(f,b),h=void 0===h?b:Math.max(h,b),0<l&&(k+=G.MathUtil.calcDistance(a[l],a[l-1]));this.length=k;this.geom=a;this.bbox=[d,f,e,h];this._onGeomUpdated()},_onGeomUpdated:function(){var a=this._layer;a&&(a=
a._map)&&(this._resDraw=null,this._updateGeomDraw(a._res))},_updateGeomDraw:function(a){var b=this.options,c=G.MathUtil,d=Math.sin,e=Math.cos,f=Math.max,h=Math.min,k=Math.PI;if(this._layer&&!(0<a&&this._resDraw==a)){for(var l=this.geom,n=l.length,m=c.calcDistance(l[n-1],l[n-2])/a,m=m>2*b.headSize?1:m/b.headSize/2,p=b.headSize*a*m,q=b.neckSize*a*m,m=b.neckAngle/c.DEGREE_PER_RADIAN,r=b.tailSize*a,x=b.tailAngle/c.DEGREE_PER_RADIAN,w=this.length-q*e(m),m=q*d(m),v=r*d(x),x=[],s=[],u=m-v,y,z,C,A,B,D,J=
0,m=0,K=n-1;m<K;m++)z=l[m],C=l[m+1],0==m?(y=c.calcTheta(z[0]-C[0],z[1]-C[1]),A=b.tailAngle/c.DEGREE_PER_RADIAN,B=[r*e(y-A),r*d(y-A)],x.push([z[0]+B[0],z[1]+B[1]]),B=[r*e(y+A),r*d(y+A)]):(y=l[m-1],D=v+u*J,A=c.calcTheta(z[0]-y[0],z[1]-y[1]),B=c.calcTheta(C[0]-z[0],C[1]-z[1]),y=(A+B)/2+k/2,A=(A-B)/2,A=e(A),D/=0.1>Math.abs(A)?0.1*(0<A?1:-1):A,B=[D*e(y),D*d(y)],x.push([z[0]+B[0],z[1]+B[1]]),B=[D*e(y+k),D*d(y+k)]),s.push([z[0]+B[0],z[1]+B[1]]),J+=c.calcDistance(z,C)/w;z=l[n-1];y=l[n-2];y=c.calcTheta(y[0]-
z[0],y[1]-z[1]);A=b.neckAngle/c.DEGREE_PER_RADIAN;B=[q*e(y-A),q*d(y-A)];x.push([z[0]+B[0],z[1]+B[1]]);B=[q*e(y+A),q*d(y+A)];s.push([z[0]+B[0],z[1]+B[1]]);A=b.headAngle/c.DEGREE_PER_RADIAN;B=[p*e(y-A),p*d(y-A)];x.push([z[0]+B[0],z[1]+B[1]]);B=[p*e(y+A),p*d(y+A)];s.push([z[0]+B[0],z[1]+B[1]]);b=[];b.push(l[0]);b=b.concat(x);b.push(l[n-1]);for(var b=b.concat(s.reverse()),E,F,H,I,m=0,n=b.length;m<n;m++)c=b[m],l=c[0],c=c[1],E=void 0===E?l:h(E,l),F=void 0===F?l:f(F,l),H=void 0===H?c:h(H,c),I=void 0===I?
c:f(I,c);this._geomDraw=[b];this._resDraw=a;this._updateBbox([E,H,F,I])}},_hitPointNowrap:function(a,b,c,d){var e=this.options;this._updateGeomDraw(b);a=[a[0],a[1]];c=this._mouseOver?e.outlineWidth+e.lineHighlightWiden:e.outline?e.outlineWidth:0;c+=2*(d||0);d=c*b/2;if(this.bbox&&(d=[this.bbox[0]-d,this.bbox[1]-d,this.bbox[2]+d,this.bbox[3]+d],!G.ExtentUtil.contains(d,a)))return!1;d=this._geomDraw;var f,h,k,l=G.Graphic.Polyline.prototype._hitPointNowrap;if(e.outline||this._mouseOver)for(e=0,f=d.length;e<
f;e++)if(h=d[e],k=[h[h.length-1],h[0]],h={geom:h,options:{lineWidth:c}},k={geom:k,options:{lineWidth:c}},l.call(h,a,b)||l.call(k,a,b))return!0;return G.GeomUtil._hitPolygon(a,d)},_refreshVertexes:function(){var a=this.geom,b=a.length,c=this._layer._map,d=this.options;this._removeVertexes();var e,f;for(e=0;e<b;e++)f=this._vertexes[e]=new G.Graphic.Point(a[e],null,{shape:d.vertexShape,size:[d.vertexSize,d.vertexSize],outline:!0,outlineColor:d.vertexColor,outlineDashArray:d.vertexDashArray,outlineWidth:d.vertexOutlineWidth,
outlineOpacity:1,fill:!0,fillColor:d.vertexFillColor,fillOpacity:1,clickable:!0}),f._isVertex=!0,f._idVertex=e,f._graphic=this,f.addTo(this._layer),0<e&&(f=G.GeomUtil._middlePoint(a[e-1],a[e]),f=this._midvertexes[e]=new G.Graphic.Point(f,null,{shape:d.vertexShape,size:[d.vertexSize,d.vertexSize],outline:!0,outlineColor:d.vertexColor,outlineDashArray:d.vertexDashArray,outlineWidth:d.vertexOutlineWidth,outlineOpacity:1,fill:!1,clickable:!0}),f._isVertex=!0,f._idVertex=e,f._isMid=!0,f._graphic=this,
f.addTo(this._layer));c._requestRedraw()},_onVertexDragStart:function(a){var b=this._layer._map,c=[a.mapX,a.mapY],d=this.virtualMouse,e=G.DomUtil,f=this._searchVertex(c);if(f){var h=b._handlers.Click;h&&h.off();var k=[f.geom[0],f.geom[1]],h=f._idVertex,l=[0,0];b.options.wrap&&(k=b._calcRealCoords(c),l[0]=k[0]-c[0],l[1]=k[1]-c[1],k=[k[0]+l[0],k[1]+l[1]]);f._isMid&&(f=this.geom.slice(0,h),f=f.concat([k]),this.geom=f=f.concat(this.geom.slice(h)),this._refreshVertexes(),f=this._searchVertex(c));this._drag=
{vertex:f,wrapOffset:l,startAt:+new Date};e.stopPropagation(a);e.preventDefault(a);b._handlers.Drag.off();b.addListener(d.MOVE[a.type],this._onVertexDrag,this);b.addListener(d.UP[a.type],this._onVertexDragEnd,this)}},_onVertexDrag:function(a){var b=this._layer._map,c=this._drag,d;if(c&&(d=c.vertex))for(wrapOffset=c.wrapOffset||[0,0],a=b._calcRealCoords([a.mapX,a.mapY]),b=[a[0]+wrapOffset[0],a[1]+wrapOffset[1]],a=d._idVertex,this.geom[a]=d.geom=b,this.updateGeom(),d.updateGeom(),b=a;b<=a+1;b++)if(d=
this._midvertexes[b])d.geom=G.GeomUtil._middlePoint(this.geom[b-1],this.geom[b]),d.updateGeom()},_onVertexDragEnd:function(a){var b=this._layer._map,c=this.virtualMouse,d=G.DomUtil,e=b._handlers.Click;if(e)e.on();var e=this._drag,f;e&&(d.stopPropagation(a),d.preventDefault(a),b._handlers.Drag.on(),f=e.vertex)&&(d=f._idVertex,e=+new Date-e.startAt,200>e&&!f._isMid&&2<this.geom.length?(e=this.geom.slice(0,d),this.geom=e=e.concat(this.geom.slice(d+1)),this.updateGeom(),this._refreshVertexes()):f.updateGeom());
b.removeListener(c.MOVE[a.type],this._onVertexDrag,this);b.removeListener(c.UP[a.type],this._onVertexDragEnd,this);this._drag=null}});
G.Graphic.Group=G.Graphic.extend({options:{},init:function(a,b,c){this.options=G.Util.merge({},this.options,c);this.attrs=b||{};this.bbox=null;this._graphics=[];var d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d._parentGraphic=this,this._append(d)},clone:function(){return new G.Graphic.Group(this._graphics,G.Util.merge({},this.attrs),G.Util.merge({},this.options))},child:function(a){return this._graphics[a]},children:function(){return this._graphics},_onAdded:function(){var a=this._graphics,
b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d._layer=this._layer,d._onAdded()},_onRemoved:function(){var a=this._graphics,b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d._onRemoved(),d._layer=null},_append:function(a){a instanceof G.Graphic&&(a._layer=this._layer,a.options.clickable=this.options.clickable,a.options.allowPan=this.options.allowPan,this._graphics.push(a),this.bbox=G.ExtentUtil.union(this.bbox,a.bbox))},_draw:function(){var a=this._graphics,b,c,d;if(a&&a.length)for(b=
0,c=a.length;b<c;b++)d=a[b],d._draw&&d._layer&&d._draw()},_erase:function(){var a=this._graphics,b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d._erase&&d._layer&&d._erase()},_hitPointNowrap:function(a,b,c,d){var e=this._graphics,f,h,k;if(e&&e.length)for(f=0,h=e.length;f<h;f++)if(k=e[f],k._hitPointNowrap&&k._hitPointNowrap(a,b,c,d))return!0;return!1},startEdit:function(a){var b=this._graphics,c,d,e;if(b&&b.length)for(c=0,d=b.length;c<d;c++)e=b[c],e.startEdit&&e.startEdit(a);this._editing=
!0},endEdit:function(){var a=this._graphics,b,c,d;if(a&&a.length)for(b=0,c=a.length;b<c;b++)d=a[b],d.endEdit&&d.endEdit();this._editing=!1}});
G.Layer=G.Class.extend({mixins:[G.Event],options:{},addTo:function(a){var b;if(this._map&&void 0!==this._id)return this._map===a?this:null;this._map=a;b=this._id=a._layerIdSeq++;a._layers[b]=this;a._layerOrder.push(b);this._zIndex=a._layerOrder.length-1;a.addListener("resize",this._onResize,this);a.addListener("viewChanged",this._onViewChanged,this);a.addListener("zoomStart",this._onZoomStart,this);a.addListener("zoomUpdate",this._onZoomUpdate,this);a.addListener("zoom",this._onZoom,this);a.addListener("zoomEnd",
this._onZoomEnd,this);a.addListener("moveStart",this._onMoveStart,this);a.addListener("move",this._onMove,this);a.addListener("moveEnd",this._onMoveEnd,this);a.addListener("rotateStart",this._onRotateStart,this);a.addListener("rotate",this._onRotate,this);a.addListener("rotateEnd",this._onRotateEnd,this);a.addListener("pinchStart",this._onPinchStart,this);a.addListener("pinch",this._onPinch,this);a.addListener("pinchEnd",this._onPinchEnd,this);this._onAdded();a.fireEvent("layerAdded",{layer:this});
a._requestUpdate();return this},remove:function(){if(this._map&&void 0!==this._id){var a=this._map,b,c;for(b=a._layerOrder.length-1;0<=b;b--)c=a._layerOrder[b],c==this._id&&a._layerOrder.splice(b,1);delete a._layers[this._id];delete this._id;a.removeListener("resize",this._onResize,this);a.removeListener("viewChanged",this._onViewChanged,this);a.removeListener("zoomStart",this._onZoomStart,this);a.removeListener("zoomUpdate",this._onZoomUpdate,this);a.removeListener("zoom",this._onZoom,this);a.removeListener("zoomEnd",
this._onZoomEnd,this);a.removeListener("moveStart",this._onMoveStart,this);a.removeListener("move",this._onMove,this);a.removeListener("moveEnd",this._onMoveEnd,this);a.removeListener("rotateStart",this._onRotateStart,this);a.removeListener("rotate",this._onRotate,this);a.removeListener("rotateEnd",this._onRotateEnd,this);a.removeListener("pinchStart",this._onPinchStart,this);a.removeListener("pinch",this._onPinch,this);a.removeListener("pinchEnd",this._onPinchEnd,this);this._onRemoved();a.fireEvent("layerRemoved",
{layer:this});a._requestRedraw();return this}},getOrder:function(){var a=this._map,b;for(b in a._layerOrder)if(a._layerOrder[b]==this._id)return b;return-1},bringToOrder:function(a){for(var b=this._map,c=b._layerOrder.length,d=0;d<c&&b._layerOrder[d]!=this._id;d++);a=a||0;0>a&&(a=0);a>c-1&&(a=c-1);b._layerOrder.splice(d,1);b._layerOrder.splice(a,0,this._id);this._afterReorder();b._requestRedraw();return this},bringToTop:function(){for(var a=this._map,b=a._layerOrder.length,c=0;c<b;c++)if(a._layerOrder[c]==
this._id){a._layerOrder.splice(c,1);break}a._layerOrder.push(this._id);this._afterReorder();a._requestRedraw();return this},bringToBottom:function(){for(var a=this._map,b=a._layerOrder.length,c=0;c<b;c++)if(a._layerOrder[c]==this._id){a._layerOrder.splice(c,1);break}a._layerOrder=[this._id].concat(a._layerOrder);this._afterReorder();a._requestRedraw();return this},bringUp:function(a){for(var b=this._map,c=b._layerOrder.length,d=-1,e=0;e<c;e++)if(b._layerOrder[e]==this._id){d=e;break}a=d+(a||1);a>
c-1&&(a=c-1);b._layerOrder.splice(e,1);b._layerOrder.splice(a,0,this._id);this._afterReorder();b._requestRedraw();return this},bringDown:function(a){for(var b=this._map,c=b._layerOrder.length,d=-1,e=0;e<c;e++)if(b._layerOrder[e]==this._id){d=e;break}a=d-(a||1);0>a&&(a=0);b._layerOrder.splice(e,1);b._layerOrder.splice(a,0,this._id);this._afterReorder();b._requestRedraw();return this},hide:function(){var a=this._map;if(this._hidden)return this;this._hidden=!0;this._erase&&this._erase();a&&a._requestRedraw();
return this},show:function(){var a=this._map;if(!this._hidden)return this;this._hidden=!1;a&&(a._requestRedraw(),a._requestUpdate());return this},isVisible:function(){var a=this._map;if(this._hidden||!a)return!1;var b=this.options,c=b.minRes,b=b.maxRes,a=a._res;return b&&b<a||c&&c>a?!1:!0},_afterReorder:function(){var a=this._map,b,c,d;for(b in a._layerOrder)if(c=parseInt(b),d=a._layerOrder[c],d=a._layers[d])d._zIndex=c},clear:function(){return this},_onClear:function(){},_update:function(){},_draw:function(){},
_erase:function(){},_onResize:function(a){},_onViewChanged:function(a){},_onAdded:function(){},_onRemoved:function(){},_onZoomStart:function(a){},_onZoomUpdate:function(a){},_onZoom:function(a){},_onZoomEnd:function(a){},_onMoveStart:function(a){},_onMove:function(a){},_onMoveEnd:function(a){},_onRotateStart:function(a){},_onRotate:function(a){},_onRotateEnd:function(a){},_onPinchStart:function(a){},_onPinch:function(a){},_onPinchEnd:function(a){}});
G.Layer.Filter={setFilters:function(a,b){var c=this._map,d,e,f,h,k;if(a&&b&&(d=Math.min(a.length,b.length),0<d)){var l=this._filters={};for(e=0;e<d;e++)h=a[e],k=b[e],f=h+","+k,l[f]=[h,k];this._dirty=!0}c&&c._requestRedraw();return this},clearFilters:function(){var a=this._map;this._filters=null;this._dirty=!0;a&&a._requestRedraw();return this},_calcFilter:function(a){var b=this._filters;if(!b||!a)return!0;var c,d;for(key in b)if(b[key]&&(c=b[key][0],d=b[key][1],c=eval('"'+a[c]+'"'+d),!c))return!1;
return!0}};
G.Layer.LOD={options:{originX:-2.0037508342784E7,originY:2.0037508342784E7,minX:-2.0037508342784E7,maxX:2.0037508342784E7,minY:-2.0037508342784E7,maxY:2.0037508342784E7,tileSize:256,zoomReses:[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.984905125,1222.9924525625,611.49622628125,305.748113140625,152.8740565703125,76.43702828515625,38.21851414257813,19.10925707128906,9.55462853564453,4.777314267822266,2.388657133911133,1.194328566955567,0.597164283477783,0.298582141738892],
maxRes:156543.033928,minRes:0.298582141738892},_calcVisTileInfos:function(a){var b=this._map,c=b.getSize(),d=b.getCenter(),e=this.options,f=b.options,h=Math.PI*b._rotate/180,k=e.tileSize;a=this._calcNearestZoom(a);for(var l=e.zoomReses[a],n=k*l,k=k*(l/b._res),m=Math.abs,p=Math.sin,q=Math.cos,l=m(c[0]*q(h))+m(c[1]*p(h)),h=m(c[0]*p(h))+m(c[1]*q(h)),c=Math.ceil(l/k/2),h=Math.ceil(h/k/2),k=this._calcTileIndex(d[0],d[1],a),q=k[0]-c,d=k[0]+c,c=k[1]-h,h=k[1]+h,k=-Math.max(b.options.tolerance||0,b._res/10),
l=void 0!==e.minX&&void 0!==e.minY&&void 0!==e.maxX&&void 0!==e.maxY,m=[],p=G.ExtentUtil.intersect([e.minX,e.minY,e.maxX,e.maxY],b.options.maxExtent),r,x,w,v,s=q;s<=d;s++){r=e.originX+s*n;x=r+n;q=s;f.wrap&&(r=b._calcRealCoords([r,0])[0],x=r+n,q=Math.round((r-e.originX)/n));for(var u=c;u<=h;u++){if(l&&(w=e.originY-(u+1)*n,v=e.originY-u*n,!G.ExtentUtil.overlaps([r,w,x,v],p,k)))continue;m.push([q,u,a])}}return m},_sortTileInfos:function(a,b,c){var d,e;a.sort(function(a,h){d=Math.pow(a[0]-b,2)+Math.pow(a[1]-
c,2);e=Math.pow(h[0]-b,2)+Math.pow(h[1]-c,2);return Math.abs(d-e)})},_calcNearestZoom:function(a){for(var b=this._map._res,c=b/100,d=this.options.zoomReses,e,f=0,h=0,k=d.length;h<k;h++){e=d[h];if(b>e+c)return a?h:f;if(b<=e+c&&b>e-c)return h;f=h}return 0},_calcTileIndex:function(a,b,c){var d=this.options;c=Number(d.zoomReses[c]);if(!c)return[-1,-1];c*=d.tileSize;return[Math.floor((a-d.originX)/c),Math.floor((d.originY-b)/c)]},_calcTileExtent:function(a,b,c){var d=this.options;if(c=Number(d.zoomReses[c]))return c*=
d.tileSize,a=c*a+d.originX,b=d.originY-c*b,[a,b-c,a+c,b]},_getTileName:function(a,b,c){return a+","+b+","+c},_getTileUrl:function(a,b,c,d){var e=this.url,f=G.Util,h=this.options.cluster;if(e){var k=d?d.scale||1:1,e=f.isFunction(e)?e(c,a,b,k):e,l;f.isArray(h)&&0<h.length&&(l=Math.abs(a+b)%h.length,l=h[l]);return f.renderString(e,G.Util.merge({s:l,z:c,x:a,y:b,i:1<k?"@2x":""},d))}},_tileOverlap:function(a,b){var c=this._calcTileExtent(a[0],a[1],a[2]),d=this._calcTileExtent(b[0],b[1],b[2]);return G.ExtentUtil.overlaps(c,
d)}};G.Layer.LOD.calcNearestZoom=G.Layer.LOD._calcNearestZoom;G.Layer.LOD.calcTileIndex=G.Layer.LOD._calcTileIndex;G.Layer.LOD.calcTileExtent=G.Layer.LOD._calcTileExtent;
G.Layer.Tile=G.Layer.extend({mixins:[G.Layer.LOD],options:{cluster:[],errorTileUrl:"",opacity:1,tileLiveMs:6E5,tileEnlarge:!0,keepResample:!0,retryTimes:3,crossOrigin:"*"},statics:{EMPTY_TILE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU5MjRFQkZCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU5MjRFQkVCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmU5MjNlNDE0LWNlOTktMzk0My1hZjRjLTgwZjhiOGY1MjY0NCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54esASAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},init:function(a,
b){this.url=a;this.options=G.Util.merge({},this.options,b);this._tiles={};this._idleTiles=[]},setUrl:function(a){this.url=a;this.clear();return this},clear:function(){for(var a=this._map,b=this._tiles,c,d=0,e=b.length;d<e;d++)c=b[d],this._stopLoadingTile(c);this._tiles={};this._idleTiles=[];this._onClear();a&&a._requestUpdate();return this},_tileInfoExist:function(a,b){for(var c,d=0,e=b.length;d<e;d++)if(c=b[d],c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2])return!0;return!1},_onAdded:function(){var a=this._map;
this._container||this._initContainer();a._zoomReses=this.options.zoomReses},_onRemoved:function(){var a=this._map;this._container&&this._destroyContainer();for(var b,c,d=0,e=a._layers.length;d<e;d++)if(c=a._layers[d],c instanceof G.Layer.Tile){b=c;break}b||delete a._zoomReses},_stopLoadingTiles:function(a){a=a.getElementsByTagName("img");for(var b,c=0,d=a.length;c<d;c++)b=a[c],this._stopLoadingTile(b)},_stopLoadingTile:function(a){if(a&&!a.complete){G.Browser.android||(a.onload=null,a.onerror=null,
a.src="");var b=a.parentNode;b&&b.removeChild(a)}},_removeTile:function(a){var b=this._tiles[a];if(b){this._stopLoadingTile(b);if(b._wraps){for(var c in b._wraps){var d=b._wraps[c];d&&d.parentNode&&d.parentNode.removeChild(d)}b._wraps={}}(c=b.parentNode)&&c.removeChild(b);this._onTileRemoved(b);G.DomUtil.removeClass(b,"g-tile-loaded");this._idleTiles.push(b);delete this._tiles[a]}},_resetTile:function(a){a._loaded=!1;a._responseTime=null;a._retried=0;a.src=""},_getIdleTile:function(){if(0<this._idleTiles.length){var a=
this._idleTiles.pop();this._resetTile(a);return a}return this._createTile()},_createTile:function(){var a=this.options,b=G.DomUtil.create("img","g-tile"),c=a.tileSize,d=G.Browser.getPxRatio();G.DomUtil.setSize(b,c/d[0],c/d[1]);b._retried=0;a.crossOrigin&&(b.crossOrigin=a.crossOrigin);return b},_placeTile:function(a,b,c,d,e){var f=G.Browser.getPxRatio(),h=f[0],f=f[1],k=this._map,l=k._rotate,n=k.getSize(),m=k.getCenter(),p=k._res,q=this.options,r=k.options,k=q.tileSize*q.zoomReses[d],l=q.tileEnlarge&&
(!!(l%90)||G.Browser.gecko||G.Browser.safari),l=Math.ceil(k/p)+(l?2:0),x=(q.originX+b*k-m[0])/p/h+n[0]/2;c=-(q.originY-c*k-m[1])/p/f+n[1]/2;var w=G.DomUtil;w.markScaleTransform(a,1/h,1/f);w.markPosTransform(a,x,c);w.markSizeTransform(a,l,l);w.updateTransform(a);w.updateOpacity(a,q.opacity);void 0===e&&(e=q.zoomReses.length,x=this._calcNearestZoom(!0),e=d==x?e+1:d);w.setZIndex(a,e);if(r.wrap&&!a._isWrap){var x=d=0,r=r.maxExtent,v=this._redrawExtent;if(v&&r){var s=r[2]-r[0],x=Math.floor((v[0]-q.minX)/
s)-1;d=Math.ceil((v[2]-q.maxX)/s)+1}a._wraps=a._wraps||{};for(var u in a._wraps)(u>d||u<x)&&(r=a._wraps[u])&&r.parentNode&&(r.parentNode.removeChild(r),delete a._wraps[u]);for(u=x;u<=d;u++)0!=u&&(r=a._wraps[u],r||(r=a._wraps[u]=G.DomUtil.create("img","g-tile"),r._isWrap=!0,w.addClass(r,"g-tile-wrap"),r.crossOrigin=a.crossOrigin,r.src=a.src,r._info=a._info,r._loaded=!0,w.addClass(r,"g-tile-loaded"),this._onNewWrapTile(a,u)),x=(q.originX+b*k-m[0]+u*s)/p/h+n[0]/2,w.markScaleTransform(r,1/h,1/f),w.markPosTransform(r,
x,c),w.markSizeTransform(r,l,l),w.updateTransform(r),w.updateOpacity(r,q.opacity),w.setZIndex(r,e))}},_checkAllHandled:function(){if(this._numLoad==this._numLoadSuccess+this._numLoadError){var a,b;for(b in this._tiles)a=this._tiles[b],a=G.DomUtil.getSize(a),a=a[0]/this.options.tileSize,(4<a||0.125>a)&&this._removeTile(b);this._clearBgBuffer();this.fireEvent("allLoaded")}},_loadTile:function(a,b,c,d,e){a._layer=this;a._info=[b,c,d];a._loaded=!1;a.onload=this._onTileLoad;a.onerror=this._onTileError;
e||(a._retried=0,this.fireEvent("tileStart",{tile:a,url:a.src}));a.src=this._getTileUrl(b,c,d,{scale:G.Browser.retina?2:1})},_onTileLoad:function(){var a=this._layer;this._responseTime=+new Date;var b=a.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,c,d;this.src!==b&&("naturalWidth"in this&&!this.naturalWidth?(d=this.src,this.src=b,a._numLoadError++,a.fireEvent("tileError",{tile:this,url:d})):(G.DomUtil.addClass(this,"g-tile-loaded"),this._loaded=!0,c=this._info,b=parseInt(c[0]),d=parseInt(c[1]),c=
parseInt(c[2]),a._placeTile(this,b,d,c),a._numLoadSuccess++,a.fireEvent("tileSuccess",{tile:this,url:this.src})),a._checkAllHandled())},_onTileError:function(){var a=this._layer;this._responseTime=+new Date;var b=a.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,c=this.src,d;this.src!==b&&(this._retried++<a.options.retryTimes?(d=this._info,b=parseInt(d[0]),c=parseInt(d[1]),d=parseInt(d[2]),a._loadTile(this,b,c,d,!0)):(this.src=b,a._numLoadError++,a.fireEvent("tileError",{tile:this,url:c}),a._checkAllHandled()))},
_onTileRemoved:function(a){},_onNewWrapTile:function(a,b){}});
G.Layer.Graphic=G.Layer.extend({options:{clickable:!0},init:function(a){this.options=G.Util.merge({},this.options,a);this._indexSeq=this._idSeq=0;this._graphics={};this._styles={};this._tree=new G.RTree},add:function(a,b,c){if(a instanceof G.Graphic)return a.addTo(this,b,c),a._id},get:function(a){return this._graphics[a]},all:function(){var a=this._tree.all(),b=[],c,d;for(c in a)d=a[c],d._isVertex||b.push(d);return b},query:function(a){var b=this._tree.search(a),c=[],d,e,f;for(d in b)e=b[d],f=e.bbox,
G.ExtentUtil.overlaps(f,a)&&!e._isVertex&&c.push(e);return c},count:function(){var a=this._tree.all(),b=0,c,d;for(c in a)d=a[c],d._isVertex||b++;return b},clear:function(){var a=this._map,b=G.DomUtil,c;for(c in this._graphics)this._graphics[c].endEdit(!0);this._graphics={};this._tree.clear();a&&(delete a._focusGraphic,b.removeClass(a._layersFrame,"g-clickable"),b.removeClass(a._layersFrame,"g-edit"));this._onClear();a&&a._requestRedraw();return this},setStyle:function(a,b,c){var d=this._map,e=this._styles,
f=this._graphics,h,k,l,n,m=[];if(a&&b){n=Math.min(a.length,b.length);for(h=0;h<n;h++)k=a[h],l=b[h],k=k+","+l,m.push(k);e[m.join(";")]=c}else e[""]=c;for(h in f)a=f[h],b=this._calcStyle(a),a.updateOptions(b,!0);d&&d._requestRedraw();return this},clearStyles:function(a){var b=this._map,c=this._graphics;this._styles={};for(i in c)g=c[i],g.updateOptions(a,!0);b&&b._requestRedraw();return this},calcDataExtent:function(a){var b=this._graphics,c,d,e;for(d in b)e=b[d],e=e.bbox,c?(c[0]=e[0]<c[0]?e[0]:c[0],
c[1]=e[1]<c[1]?e[1]:c[1],c[2]=e[2]>c[2]?e[2]:c[2],c[3]=e[3]>c[3]?e[3]:c[3]):c=[e[0],e[1],e[2],e[3]];c&&a&&(b=(c[0]+c[2])/2,d=(c[1]+c[3])/2,e=(c[2]-c[0])/2*a,a*=(c[3]-c[1])/2,c[0]=b-e,c[1]=d-a,c[2]=b+e,c[3]=d+a);return c},_calcStyle:function(a){var b=this._styles;a=a.attrs;var c=b[""];if(!a)return c;var d,e,f,h,k,l;for(d in b)if(d){e=d.split(";");for(h in e)if((f=e[h])&&(f.indexOf&&f.substring)&&(k=f.indexOf(","),l=f.substring(0,k),f=f.substring(k+1),l=eval('"'+a[l]+'"'+f),!l))break;if(l){c=b[d];break}}return c},
_initContainer:function(){},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_onAdded:function(){this._container||this._initContainer();var a=this._map;a.addListener("mousemove",this._onMouseMove,this);a.addListener("click",this._onClick,this)},_onRemoved:function(){this._container&&this._destroyContainer();var a=this._map;a.removeListener("mousemove",this._onMouseMove,this);a.removeListener("click",this._onClick,this)},_onListenerAdded:function(a,
b,c){(b=this._map)&&"graphicClicked"==a&&(b.removeListener("click",this._onClick,this),b.addListener("click",this._onClick,this))},_onClear:function(){},_onZoomStart:function(){},_onZoomUpdate:function(){},_onZoomEnd:function(){},_vacuum:function(){var a=this._map;if(a){var b=a.getCenter(),c=a._res,d=a.getDrawSize(),a=d[0],d=d[1],b=this._tree.search([b[0]-a*c/2,b[1]-d*c/2,b[0]+a*c/2,b[1]+d*c/2]),c={},e,d=this._graphics;for(e in d)c[e]=!0;for(e in b)a=b[e],delete c[a._id];for(e in c)a=d[e],a.remove();
return c.length}},_sortIndex:function(a,b){return a&&b?a._index-b._index||0:0},_onMouseMove:function(a){var b=this._map,c=b._focusGraphic;if(this.options.clickable)if(c&&!c._layer)c._mouseOver=!1,b._focusGraphic=null;else{var d=b._handlers.Drag;if((!d||!d._dragging)&&this.isVisible()){d=b.getRedrawExtent();d=this._tree.search(d).sort(this._sortIndex).reverse();a=[a.mapX,a.mapY];var e,f,h,k;e=0;for(f=d.length;e<f;e++)if(h=d[e],k=h.options,h._layer&&k.clickable)if((k=h._hitPoint(a,b._res,b._rotate))&&
h._mouseOver)break;else if(k&&!h._mouseOver){c&&(c._mouseOver=!1,c._onMouseOut&&c._onMouseOut(),c._isVertex?c._graphic._onVertexMouseOut():this.fireEvent("graphicOut",{graphic:c}));h._mouseOver=!0;b._focusGraphic=h;h._onMouseOver&&h._onMouseOver();h._isVertex?h._graphic._onVertexMouseOver():this.fireEvent("graphicOver",{graphic:h});break}else!k&&h._mouseOver&&(h._mouseOver=!1,h._onMouseOut&&h._onMouseOut(),h._isVertex?h._graphic._onVertexMouseOut():this.fireEvent("graphicOut",{graphic:c}),b._focusGraphic=
null);G.Browser.ielt9&&(G.DomUtil.hasClass(b._layersFrame,"g-clickable")||G.DomUtil.hasClass(b._layersFrame,"g-edit")?b._layersFrame.style.cursor="":b._layersFrame.style.cursor="default")}}},_onClick:function(a){var b=this._map;if(this.isVisible()&&this.options.clickable){var c=b.getRedrawExtent(),c=this._tree.search(c).sort(this._sortIndex).reverse(),d=[a.mapX,a.mapY],e=b.options.touchTol,e=G.Browser.touch?e:0,f,h,k;for(h=0;h<c.length;h++)if(f=c[h],k=f.options,f._layer&&k.clickable&&f._hitPoint(d,
b._res,b._rotate,e)&&!f._isVertex){a.cancel();this.fireEvent("graphicClicked",{graphic:f});break}}}});
G.Layer.Html=G.Layer.extend({init:function(a,b){this.options=G.Util.merge({},this.options,b);this._idSeq=0;this._htmls={}},addHtml:function(a,b,c){var d=this._map,e=G.DomUtil.create("div","g-html",this._container);e.innerHTML=a;e._id=this._idSeq++;e._addAt=+new Date;this._htmls[e._id]=e;e.geom=[b,c];e.bbox=[b,c,b,c];d&&d._requestRedraw();return e._id},getHtml:function(a){return this._htmls[a]},removeHtml:function(a){var b=this._htmls[a];if(b){var c=b.parentNode;c&&c.removeChild(b);delete this._htmls[a];
return this}},clear:function(){var a=this._map,b,c,d;for(b in this._htmls)c=this._htmls[b],(d=c.parentNode)&&d.removeChild(c);this._htmls={};this._onClear();a&&a._requestRedraw();return this},_initContainer:function(){var a=this._map,b=G.DomUtil,c=this._container=b.create("div","g-layer g-html-container");a._layersFrame.appendChild(this._container);b.setZIndex(c,this._zIndex)},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_onAdded:function(){this._container||
this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){this.isVisible()?this._draw():this._erase()},_draw:function(){var a=G.DomUtil;a.show(this._container);a.setZIndex(this._container,this._zIndex);var a=this._htmls,b,c;for(b in a)c=a[b],this._placeHtml(c)},_erase:function(){G.DomUtil.hide(this._container)},_placeHtml:function(a){var b=this._map,c=G.Browser.getPxRatio(),d=c[0],c=c[1],b=this._map,e=b.getSize(),f=b._rotate,h=b.getCenter(),b=b._res,
k=G.DomUtil,l=a.geom;k.markPosTransform(a,(l[0]-h[0])/b/d+e[0]/2,-(l[1]-h[1])/b/c+e[1]/2);k.markRotateTransform(a,-f);k.updateTransform(a)},_onZoomStart:function(a){var b=this._map,c=b._mapFrame,d=b.getSize(),e=G.DomUtil,f=e.Transition;this._zooming||(this._zooming=!0);var h=[d[0]/2,d[1]/2],d=a.aroundScreen||h,k=h[0]-d[0],h=h[1]-d[1];this._aroundScreen=d;this._scale=a.scale;this._zoomStartRes=b._res;this._zoomStartScale=a.scale;b=b._zoomAnim&&b._zoomAnim._params.ignoreAnim;a=1/a.scale-1;var l=this._htmls,
n,m,p,q;for(n in l)if(m=l[n],k=m._zoomStartPos=e.getPosition(m))p=k[0],q=k[1],k=(p-d[0])*a,h=(q-d[1])*a,e.markPosTransform(m,p+k,q+h),e.updateTransform(m),b||(m.style[f]=c.style[f])},_onZoomUpdate:function(a){var b=G.DomUtil;if(this._zooming){this._tempScale=a.scale;var c=this._aroundScreen;a=1/a.scale-1/this._scale;var d=this._htmls,e,f,h,k;for(e in d)if(f=d[e],h=f._zoomStartPos)k=h[0],h=h[1],dx=(k-c[0])*a,dy=(h-c[1])*a,b.markPosTransform(f,k+dx,h+dy),b.updateTransform(f)}},_onZoomEnd:function(){var a=
G.DomUtil.Transition;this._scale=1;var b=this._htmls,c,d;for(c in b)d=b[c],d.style[a]="";this._zooming=!1}});
G.Layer.Image=G.Layer.extend({options:{errorImageUrl:"",opacity:1,retryTimes:3,crossOrigin:"*"},statics:{EMPTY_TILE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3FpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUU5MjRFQkZCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUU5MjRFQkVCOTQxMTFFMzlDQjA5NkM1REQ1MEUwODciIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmU5MjNlNDE0LWNlOTktMzk0My1hZjRjLTgwZjhiOGY1MjY0NCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxOWUzZTA0YS1lOWFjLTljNDctODI5ZS0yMjM3YTQ3YzU3MzciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz54esASAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},init:function(a,
b){G.Util.isString(a)?this.options=G.Util.merge({},this.options,b):this.options=G.Util.merge({},this.options,a);this._idSeq=0;this._images={}},addImage:function(a,b,c,d,e){var f=this._map,h=G.DomUtil.create("img","g-image",this._container),k=G.Browser.getPxRatio(),l=f._res;G.DomUtil.setSize(h,(d-b)/l/k[0],(e-c)/l/k[1]);h._id=this._idSeq++;h._addAt=+new Date;this._images[h._id]=h;h.geom=h.bbox=[b,c,d,e];h._src=a;this._loadImage(h);f&&f._requestRedraw();return h._id},getImage:function(a){return this._images[a]},
removeImage:function(a){var b=this._images[a];if(b){var c=b.parentNode;c&&c.removeChild(b);delete this._images[a];map&&map._requestRedraw();return this}},clear:function(){for(var a=this._map,b=this._images,c,d=0,e=b.length;d<e;d++)c=b[d],this._stopLoadingImage(c);this._images={};this._onClear();a&&a._requestUpdate();return this},_initContainer:function(){var a=this._map,b=G.DomUtil,c=this._container=b.create("div","g-layer g-image-container");a._layersFrame.appendChild(this._container);b.setZIndex(c,
this._zIndex)},_destroyContainer:function(){this._container.parentNode.removeChild(this._container);delete this._container},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){this.isVisible()?this._draw():this._erase()},_draw:function(){var a=G.DomUtil;a.show(this._container);a.setZIndex(this._container,this._zIndex);var a=this._images,b,c;for(b in a)c=a[b],this._placeImage(c)},_erase:function(){G.DomUtil.hide(this._container)},
_placeImage:function(a){var b=G.DomUtil,c=G.Browser.getPxRatio(),d=c[0],c=c[1],e=this._map,f=e._res,h=a.bbox,k=h[0],l=h[1],n=this._zoomScale||this._scale,m=this._aroundScreen,p=(h[2]-h[0])/f,f=(h[3]-h[1])/f;n&&1!==n&&(p/=n,f/=n);k=e.toScreen([k,l],m,n);e=k[0];k=k[1]-f;b.markScaleTransform(a,1/d,1/c);b.markPosTransform(a,e,k);b.markSizeTransform(a,p,f);b.updateTransform(a);b.updateOpacity(a,this.options.opacity)},_stopLoadingImages:function(a){a=a.getElementsByTagName("img");for(var b,c=0,d=a.length;c<
d;c++)b=a[c],this._stopLoadingImage(b)},_stopLoadingImage:function(a){if(a&&!a.complete){G.Browser.android||(a.onload=null,a.onerror=null,a.src="");var b=a.parentNode;b&&b.removeChild(a)}},_loadImage:function(a,b){a._layer=this;a._loaded=!1;a.onload=this._onImageLoad;a.onerror=this._onImageError;b||(a._retried=0,this.fireEvent("imageStart",{image:a,url:a.src}));a.src=a._src},_onImageLoad:function(){var a=this._layer;this._responseTime=+new Date;var b=a.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE;
if(this.src!==b)if("naturalWidth"in this&&!this.naturalWidth){var c=this.src;this.src=b;a.fireEvent("imageError",{image:this,url:c})}else G.DomUtil.addClass(this,"g-image-loaded"),this._loaded=!0,a._placeImage(this),a.fireEvent("imageSuccess",{image:this,url:this.src})},_onImageError:function(){var a=this._layer;this._responseTime=+new Date;var b=a.options.errorImageUrl||G.Layer.Image.EMPTY_TILE,c=this.src;this.src!==b&&(this._retried++<a.options.retryTimes?a._loadImage(this,!0):(this.src=b,a.fireEvent("imageError",
{image:this,url:c})))},_onImageRemoved:function(a){},_onNewWrapImage:function(a,b){},_onZoomStart:function(a){var b=this._map,c=b._mapFrame,d=b.getSize(),e=b._rotate,f=G.DomUtil,h=f.Transition;this._zooming||(this._zooming=!0);var k=[d[0]/2,d[1]/2],d=a.aroundScreen||k,l=k[0]-d[0],n=k[1]-d[1];e&&(l&&n)&&(d=G.MathUtil.rotateVector([l,n],-e),d=[k[0]-d[0],k[1]-d[1]]);this._aroundScreen=d;this._scale=a.scale;b=b._zoomAnim&&b._zoomAnim._params.ignoreAnim;a=1/a.scale-1;var e=this._images,m,p,q;for(p in e)q=
e[p],l=q._zoomStartPos=f.getPosition(q),q._zoomStartSize=f.getSize(q),k=l[0],m=l[1],l=(k-d[0])*a,n=(m-d[1])*a,f.markPosTransform(q,k+l,m+n),f.updateTransform(q),b||(q.style[h]=c.style[h])},_onZoomUpdate:function(a){var b=G.DomUtil;if(this._zooming){var c=this._aroundScreen,d=this._scale=a.scale;a=1/a.scale-1;var e=this._images,f,h,k,l;for(k in e)if(l=e[k],f=l._zoomStartPos)h=f[0],f=f[1],dx=(h-c[0])*a,dy=(f-c[1])*a,size=l._zoomStartSize,b.markSizeTransform(l,size[0]/d,size[1]/d),b.markPosTransform(l,
h+dx,f+dy),b.updateTransform(l)}},_onZoomEnd:function(){this._scale=1;var a=this._images,b,c;for(b in a)c=a[b],this._placeImage(c);this._zooming=!1}});G.Anim=G.Class.extend({mixins:[G.Event],init:function(a){this._map=a;this._playing=!1;return this},start:function(){},update:function(){},stop:function(){}});
G.Anim.Pan=G.Anim.extend({start:function(a){var b=this._map,c=b._mapFrame,d=G.DomUtil;if(!this._playing&&a&&a.duration&&a.ease){this._playing=G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0;this._params=a;d.addClass(c,"g-pan-anim");var e=d.getPosition(c);this._srcX=e[0];this._srcY=e[1];this._destX=this._srcX+a.offsetX;this._destY=this._srcY-a.offsetY;clearTimeout(this._timer);this._timer=setTimeout(G.Util.bind(this._onTimer,this),1E3*a.duration);d.Transition&&(d.addListener(c,d.TransitionEnd,
this._onTransitionEnd,this),c.style[d.Transition]="all "+a.duration+"s cubic-bezier(0,0,"+a.ease+",1)");d.markPosTransform(c,this._destX,this._destY);d.updateTransform(c);b.fireEvent("moveStart");G.Util.cancelAnimFrame(this._animFrame);this._animFrame=G.Util.requestAnimFrame(this._onStep,!1,this)}},_onStep:function(){this._map.fireEvent("move");this._animFrame=G.Util.requestAnimFrame(this._onStep,!1,this)},_onTimer:function(){this._final()},_final:function(){var a=this._map,b=a._mapFrame,c=G.DomUtil;
this._playing&&(this._playing=!1,clearTimeout(this._timer),G.Util.cancelAnimFrame(this._animFrame),b.style[c.Transition]="",c.removeClass(b,"g-pan-anim"),a._mergeFramePos(),a._updateUrl(),a.fireEvent("moveEnd"),a._checkView(),a._requestUpdate(),G.DomDraggable.forbidden=G.DomPinchable.forbidden=!1)},_onTransitionEnd:function(){var a=G.DomUtil;a.removeListener(this._map._mapFrame,a.TransitionEnd,this._onTransitionEnd,this);this._final()}});
G.Anim.Rotate=G.Anim.extend({start:function(a){var b=this._map,c=b._mapFrame,d=b._compass,e=G.DomUtil,f=G.Util;!this._playing&&(a&&a.duration)&&(this._playing=G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0,this._params=a,b.fireEvent("rotateStart"),e.addClass(c,"g-rotate-anim"),e.Transition&&(e.addListener(d,e.TransitionEnd,this._onTransitionEnd,this),d.style[e.Transition]="all "+a.duration+"s linear"),b._isCanvasRelMode()?(f.cancelAnimFrame(this._animFrame),this._animFrame=f.requestAnimFrame(this._onStep,
!0,this)):e.Transition?(e.addListener(c,e.TransitionEnd,this._onTransitionEnd,this),c.style[e.Transition]="all "+a.duration+"s linear",b._rawRotateTo(a.to)):this._final(),this._startAt=+new Date,this._startRotate=b._rotate)},_onStep:function(){var a=this._map,b=this._startRotate,c=this._params,d=+new Date-this._startAt,e=1E3*c.duration;d<e?(b+=(c.to-b)*d/e,a._rawRotateTo(b),a._requestRedraw(),a.fireEvent("rotate"),this._animFrame=G.Util.requestAnimFrame(this._onStep,!0,this)):this._final()},_final:function(){var a=
this._map,b=a._mapFrame,c=this._params,d=G.DomUtil;this._playing&&(this._playing=!1,d.removeClass(b,"g-rotate-anim"),a._rawRotateTo(c.to),a._updateUrl(),a.fireEvent("rotateEnd"),G.DomDraggable.forbidden=G.DomPinchable.forbidden=!1,a._checkView(),a._requestUpdate())},_onTransitionEnd:function(){var a=this._map,b=a._mapFrame,a=a._compass,c=G.DomUtil;c.removeListener(b,c.TransitionEnd,this._onTransitionEnd,this);c.removeListener(a,c.TransitionEnd,this._onTransitionEnd,this);b.style[c.Transition]="";
a.style[c.Transition]="";this._final()}});
G.Anim.Zoom=G.Anim.extend({start:function(a){var b=this._map,c=b._mapFrame,d=G.DomUtil,e=G.Util;if(!this._playing&&a&&a.center&&a.width&&a.height){this._playing=G.DomDraggable.forbidden=G.DomPinchable.forbidden=!0;this._params=a;var f=a.center,h=a.width,k=a.height,l=b.getSize(),n=b._res,k=b._calcResByViewport(f,h,k),h=k/n,m=b.getCenter(),f=[(k*m[0]-n*f[0])/(k-n),(k*m[1]-n*f[1])/(k-n)],k=b.toScreen(f);d.addClass(c,"g-zoom-anim");a.ignoreAnim||(clearTimeout(this._timer),this._timer=setTimeout(G.Util.bind(this._onTimer,
this),1E3*a.duration),b._isCanvasRelMode()?(e.cancelAnimFrame(this._animFrame),this._animFrame=e.requestAnimFrame(this._onStep,!0,this)):d.Transition?(d.addListener(c,d.TransitionEnd,this._onTransitionEnd,this),c.style[d.Transition]="all "+a.duration+"s linear"):this._final());this._startAt=+new Date;this._startCenter=b.getCenter();this._startMapSize=[l[0]*n,l[1]*n];this._startRes=n;b.fireEvent("zoomStart",{aroundMap:f,aroundScreen:k,scale:h});a.ignoreAnim&&a.fireEnd&&this._final(!a.fireEnd)}},update:function(a){var b=
this._map,c=b._mapFrame,d=G.DomUtil,e=G.Util;if(this._playing){this._params=a;var f=a.center,h=this._startRes,k=b._calcResByViewport(f,a.width,a.height),l=k/h,n=b.getCenter(),m=f[0],f=f[1],h=[k===h?m:(k*n[0]-h*m)/(k-h),k===h?f:(k*n[1]-h*f)/(k-h)],k=b.toScreen(h);a.ignoreAnim?b._isCanvasRelMode()&&(b._rawZoomTo(a.center,a.width,a.height),b._requestRedraw()):(clearTimeout(this._timer),this._timer=setTimeout(G.Util.bind(this._onTimer,this),1E3*a.duration),b._isCanvasRelMode()?(e.cancelAnimFrame(this._animFrame),
this._animFrame=e.requestAnimFrame(this._onStep,!0,this)):d.Transition?c.style[d.Transition]="all "+a.duration+"s linear":this._final());b.fireEvent("zoomUpdate",{aroundMap:h,aroundScreen:k,scale:l});b.fireEvent("zoom");a.ignoreAnim&&this._final()}},_onTimer:function(){this._final()},_onStep:function(){var a=this._map,b=this._startCenter,c=this._startMapSize,d=this._params,e=+new Date-this._startAt,f=1E3*d.duration,h;e<f?(f=e/f,e=b[0]+(d.center[0]-b[0])*f,b=b[1]+(d.center[1]-b[1])*f,h=c[0]+(d.width-
c[0])*f,c=c[1]+(d.height-c[1])*f,a._rawZoomTo([e,b],h,c),a._requestRedraw(),a.fireEvent("zoom"),this._animFrame=G.Util.requestAnimFrame(this._onStep,!0,this)):this._final()},_final:function(a){var b=this._map,c=b._mapFrame,d=this._params,e=G.DomUtil;if(d.fireEnd){if(!this._playing)return;this._playing=!1;e.removeClass(c,"g-zoom-anim");b._rawZoomTo(d.center,d.width,d.height);b._updateUrl();a||b.fireEvent("zoomEnd");b._checkView();b._requestUpdate()}G.DomDraggable.forbidden=G.DomPinchable.forbidden=
!1},_onTransitionEnd:function(){var a=this._map._mapFrame,b=G.DomUtil;b.removeListener(a,b.TransitionEnd,this._onTransitionEnd,this);a.style[b.Transition]="";this._final()}});G.Handler=G.Class.extend({init:function(a){this._map=a;this._enabled=!1;return this},on:function(a){if(this._forbidden&&!a)return this;this._enabled||(this._enabled=!0,this.afterOn());return this},off:function(){this._enabled&&(this._enabled=!1,this.afterOff());return this},afterOn:function(){},afterOff:function(){}});
G.Handler.Click=G.Handler.extend({afterOn:function(){var a=this._map,b=G.DomUtil,c=G.Event.virtualMouse,d;for(d in c.DOWN)b.addListener(a._mapFrame,c.DOWN[d],this._onDown,this);for(d in c.UP)b.addListener(a._mapFrame,c.UP[d],this._onUp,this)},afterOff:function(){var a=this._map,b=G.DomUtil,c=G.Event.virtualMouse,d;for(d in c.DOWN)b.removeListener(a._mapFrame,c.DOWN[d],this._onDown,this);for(d in c.UP)b.removeListener(a._mapFrame,c.UP[d],this._onUp,this)},_onDown:function(a){var b=this._map,c=G.DomUtil;
c.hide(b._spark);if(!(b.isZooming()||b.isPanning()||b.isRotating()||!a||a.touches&&1>a.touches.length)){this._touchesCount=a.touches?a.touches.length:0;this._lastDown=a.touches?a.touches[0]:a;if(a.touches&&2<=a.touches.length){var d=(this._lastDown.pageY+a.touches[1].pageY)/2;this._lastDown.pageX=(this._lastDown.pageX+a.touches[1].pageX)/2;this._lastDown.pageY=d;a=c.getMousePosition(this._lastDown,b._container);this._virtualClick(a,this._lastDown)}this._lastTime=+new Date}},_onUp:function(a){for(var b=
this._map,c=G.DomUtil,d=Math.abs,e=b.options.touchTol,f=(a||a.touches[0]).target;f;){if("g-popup"==f.className)return;f=f.parentElement}var h=this._lastDown,k=a.changedTouches?a.changedTouches[0]:a;h&&(f=b._mapFrame._pos,h=c.getMousePosition(h,b._container),c=c.getMousePosition(k,b._container),b=d(h[0]-c[0]-f[0]),d=d(h[1]-c[1]-f[1]),b<e&&(d<e&&200>+new Date-this._lastTime)&&this._virtualClick(h,a));this._lastDown=null},_virtualClick:function(a,b){var c=this._map,d=c.toMap(a);c.fireEvent("virtualclick",
{mapX:d[0],mapY:d[1],screenX:a[0],screenY:a[1]});c.options.spark&&this._showSpark(d,a);d=+new Date;c=1E3*c.options.doubleDuration;if(this._lastClick)if(d-this._lastClickTime<c)clearTimeout(this._clickTimeout),this._lastClick=null,this._realDoubleClick(a,b);else{if(b.touches&&2>this._touchesCount||1===b.which||1===b.button)this._lastClick=a,this._realClick()}else if(b.touches&&2>this._touchesCount||1===b.which||1===b.button)this._lastClick=a,this._clickTimeout=setTimeout(G.Util.bind(this._realClick,
this),c);this._lastClickTime=d},_realDoubleClick:function(a,b){var c=this._map,d=c.toMap(a),e;c.options.doubleZoom&&(e=b.touches&&2>this._touchesCount||1===b.which||1===b.button,this._doubleZoom(d,!e));c.fireEvent("doubleclick",{mapX:d[0],mapY:d[1],screenX:a[0],screenY:a[1]})},_doubleZoom:function(a,b){var c=this._map;if(c.options.doubleZoom){var d=c.getSize(),e=c._res,f=G.MathUtil.limitRange(c._calcNearestRes(b),c.options.minRes,c.options.maxRes);if(!(Math.abs(f-e)<e/100)){var e=f/e,h=d[0]*f,d=d[1]*
f,f=c.getCenter(),k=a[0],l=a[1];c.zoomTo([k+(f[0]-k)*e,l+(f[1]-l)*e],h,d)}}},_realClick:function(){var a=this._map;clearTimeout(this._clickTimeout);var b=this._lastClick,c=a.toMap(b);this._lastClick=null;this._lastClickTime=+new Date;a.fireEvent("click",{mapX:c[0],mapY:c[1],screenX:b[0],screenY:b[1]})},_showSpark:function(a,b){var c=this._map,d=G.DomUtil;if(!(c.isZooming()||c.isPanning()||c.isRotating())){var e=c.options.sparkOffset||[0,0],f=c.options.sparkDuration||1,h=b[0]+e[0],e=b[1]+e[1],k=c._spark;
k.geom=a;d.markPosTransform(k,h,e);d.updateTransform(k);var l=3*(f/4);d.show(k,f/4,function(){d.show(k);d.hide(k,l)})}}});
G.Handler.DoubleClick=G.Handler.extend({afterOn:function(){var a=this._map;G.Util.merge(a.options,{doubleZoom:!0});a.addListener("dblclick",this._onDoubleClick,this);if(G.Browser.touch){var b=G.Event.virtualMouse,c;for(c in b.DOWN)G.DomUtil.addListener(a._mapFrame,b.DOWN[c],this._onDown,this)}},afterOff:function(){var a=this._map;a.removeListener("dblclick",this._onDoubleClick,this);if(G.Browser.touch){var b=G.Event.virtualMouse,c;for(c in b.DOWN)G.DomUtil.removeListener(a._mapFrame,b.DOWN[c],this._onDown,
this)}},_onDown:function(a){var b=this._map,c=G.DomUtil;if(a.touches){var d,e;if(this._lastTouch&&this._lastTime&&(d=+new Date-this._lastTime,d<1E3*b.options.doubleDuration)){d=c.getMousePosition(this._lastTouch,b._container);e=b.toMap(d);this._doubleZoom(e,2==a.touches.length?!0:!1);c.stopPropagation(a);c.preventDefault(a);this._lastTouch=null;this._lastTime=0;b.fireEvent("doubleclick",{mapX:e[0],mapY:e[1],screenX:d[0],screenY:d[1]});return}this._lastTouch=a.touches[0];this._lastTime=+new Date}},
_onDoubleClick:function(a){var b=this._map;b.isZooming()||(b.isPanning()||b.isRotating())||(b.fireEvent("doubleclick",{mapX:a.mapX,mapY:a.mapY,screenX:a.screenX,screenY:a.screenY}),this._doubleZoom([a.mapX,a.mapY]))},_doubleZoom:function(a,b){var c=this._map;if(c.options.doubleZoom){var d=c.getSize(),e=c._res,f=G.MathUtil.limitRange(c._calcNearestRes(b),c.options.minRes,c.options.maxRes);if(!(Math.abs(f-e)<e/100)){var e=f/e,h=d[0]*f,d=d[1]*f,f=c.getCenter(),k=a[0],l=a[1];c.zoomTo([k+(f[0]-k)*e,l+
(f[1]-l)*e],h,d)}}}});
G.Handler.Drag=G.Handler.extend({afterOn:function(){var a=this._map;this._draggable||(this._draggable=new G.DomDraggable(a._mapFrame,a._container,a.options.dragEdge),this._draggable.addListener("dragStart",this._onDragStart,this),this._draggable.addListener("drag",this._onDrag,this),this._draggable.addListener("dragEnd",this._onDragEnd,this),this._draggable.on())},afterOff:function(){this._draggable&&(this._draggable.off(),this._draggable.removeListener("dragStart",this._onDragStart,this),this._draggable.removeListener("drag",
this._onDrag,this),this._draggable.removeListener("dragEnd",this._onDragEnd,this),delete this._draggable)},_onDragStart:function(a){var b=this._map,c=G.DomUtil,d=b._mapFrame,e=b.options;b._panAnim&&b._panAnim.stop();if(!(b.isZooming()||(b.isPanning()||b.isRotating())||this._dragging)){this._dragging=!0;c.preventDefault(a);c.stopPropagation(a);d.style[c.Transition]="";e.panAnim&&(this._poses=[],this._times=[]);this._mergedFramePos=[0,0];var f,h,k,l,n,m;n=Math.abs;m=Math.sin;var p=Math.cos,c=Math.round;
if(d=e.maxExtent)a=b.getSize(),a=[0,0,a[0],a[1]],f=b._res,h=(d[2]-d[0])/2/f,k=(d[3]-d[1])/2/f,(f=b._rotate)?(l=f/G.MathUtil.DEGREE_PER_RADIAN,f=n(h*p(l))+n(k*m(l)),n=n(h*m(l))+n(k*p(l))):(f=h,n=k),d=b.toScreen([(d[2]+d[0])/2,(d[3]+d[1])/2]),m=[c(d[0]-f),c(d[1]-n),c(d[0]+f),c(d[1]+n)],c=m[0]>a[0]?a[0]-m[0]:a[2]-m[2],d=m[3]<a[3]?a[3]-m[3]:a[1]-m[1],n=m[2]<a[2]?a[2]-m[2]:a[0]-m[0],a=m[1]>a[1]?a[1]-m[1]:a[3]-m[3],e.wrap&&(c=-Number.MAX_VALUE,n=Number.MAX_VALUE),this._draggable._dLimit=[c,d,n,a];b.fireEvent("moveStart")}},
_onDrag:function(a){var b=this._map,c=G.DomUtil;this._dragging&&(c.preventDefault(a),c.stopPropagation(a),clearTimeout(this._timeout),this._timeout=setTimeout(G.Util.bind(this._checkStay,this),500),b.options.panAnim&&(a=this._lastTime=+new Date,c=this._lastPos=[this._draggable._newX,this._draggable._newY],this._poses.push(c),this._times.push(a),40<a-this._times[0]&&(this._poses.shift(),this._times.shift())),b.fireEvent("move"))},_onDragEnd:function(a){var b=this._map,c=b.options,d=+new Date-this._lastTime,
e=G.DomUtil;if(this._dragging)if(this._dragging=!1,e.preventDefault(a),e.stopPropagation(a),clearTimeout(this._timeout),!c.panAnim||100<d||!this._poses[0]||G.Browser.ielt9)this._final();else{e=(this._lastTime+d-this._times[0])/1E3;a=c.panAnimEase;var d=(this._lastPos[0]-this._poses[0][0])*a/e,e=(this._lastPos[1]-this._poses[0][1])*a/e,f=Math.pow(d*d+e*e,0.5),f=Math.min(c.panAnimMaxSpeed,f)/f,c=c.panAnimDuration,d=d*f*c,h=-(e*f)*c;if(d||h){var k=this._draggable._dLimit;if(k)var e=Math.min(k[0],0),
f=Math.max(k[1],0),l=Math.max(k[2],0),k=Math.min(k[3],0),n=b._mapFrame._pos,d=d+n[0],h=-h+n[1],d=Math.min(Math.max(d,e),l),h=Math.min(Math.max(h,k),f),d=d-n[0],h=n[1]-h;b.panBy(d,h,{duration:c,ease:a})}else this._final()}},_final:function(){var a=this._map;a._mergeFramePos();a._updateUrl();a.fireEvent("moveEnd");a._checkView();a._requestUpdate()},_checkStay:function(){this._map.options.panAnim&&(this._poses=[],this._times=[])}});
G.Handler.ScrollWheel=G.Handler.extend({afterOn:function(){var a=this._map,b=G.DomUtil;G.Util.merge(a.options,{scrollWheelZoom:!0});this._toDelta=0;a.addListener("mousewheel",this._onMouseWheel,this);b.addListener(a._container,"MozMousePixelScroll",b.preventDefault)},afterOff:function(){var a=this._map,b=G.DomUtil;a.removeListener("mousewheel",this._onMouseWheel,this);b.removeListener(a._container,"MozMousePixelScroll",b.preventDefault)},_onMouseWheel:function(a){var b=this._map,c=b.options,d=G.DomUtil;
if(b._isLoaded()&&c.scrollWheelZoom&&!b.isPanning()&&!b.isRotating())if(d.preventDefault(a),d.stopPropagation(a),d=d.getWheelDelta(a.originEvent),G.Browser.ielt9||!b.options.continuouslyZoom)this._mouseMap=[a.mapX,a.mapY],0>this._toDelta*d&&(this._toDelta=0),this._toDelta+=d,3<this._toDelta?(this._toDelta=0,this._zoomByLod()):-3>this._toDelta&&(this._toDelta=0,this._zoomByLod(1));else{var e=b._zoomAnim;e&&e._playing?(this._toDelta+=d,a=0<c.zoomAnimDuration?1E3*c.zoomAnimDuration:500,clearTimeout(this._timer),
this._timer=setTimeout(G.Util.bind(this._onTimer,this),a)):(this._mouseMap=[a.mapX,a.mapY],this._toDelta=d,this._startRes=b._res,this._startCenter=b.getCenter());this._toDelta=G.MathUtil.limitRange(this._toDelta,-80,80);this._tempZoom()}},_onTimer:function(){this._finalZoom()},_calcScale:function(a){return Math.pow(2,a/-20)},_zoomByLod:function(a){var b=this._map,c=b.options,d=c.minRes,e=c.maxRes,c=b.getSize(),f=b._res,d=G.MathUtil.limitRange(b._calcNearestRes(a),d,e);Math.abs(d-f)<f/1E4||(scale=
d/f,a=c[0]*d,c=c[1]*d,d=b.getCenter(),f=this._mouseMap[0],e=this._mouseMap[1],this._newCenter=[f+(d[0]-f)*scale,e+(d[1]-e)*scale],this._newWidth=a,this._newHeight=c,b.zoomTo(this._newCenter,this._newWidth,this._newHeight,{fireEnd:!0}))},_tempZoom:function(){var a=this._map,b=a.options,c=b.minRes,d=b.maxRes,e=a.getSize(),f=this._startRes,b=this._calcScale(this._toDelta),c=G.MathUtil.limitRange(b*f,c,d),b=c/f,f=e[0]*c,e=e[1]*c,d=this._startCenter,h=this._mouseMap[0],k=this._mouseMap[1];this._newCenter=
[h+(d[0]-h)*b,k+(d[1]-k)*b];this._newWidth=f;this._newHeight=e;c==this._lastRes?(clearTimeout(this._timer),this._timer=setTimeout(G.Util.bind(this._onTimer,this),250)):(this._lastRes=c,a.zoomTo(this._newCenter,this._newWidth,this._newHeight,{ignoreAnim:!0,fireEnd:!1}))},_finalZoom:function(){this._map.zoomTo(this._newCenter,this._newWidth,this._newHeight,{ignoreAnim:!0})}});
G.Handler.ShiftDrag=G.Handler.extend({afterOn:function(){var a=this._map;G.Util.merge(a.options,{dragZoom:!0});a.addListener("mousedown",this._onMouseDown,this)},afterOff:function(){this._map.removeListener("mousedown",this._onMouseDown,this)},_onMouseDown:function(a){var b=a.originEvent;if(!b||!b.shiftKey||1!==b.which&&1!==b.button)return!1;var b=this._map,c=G.DomUtil,d=c.addListener;c.preventDefault(a);c.stopPropagation(a);c.disableTextSelection();c.disableImageDrag();var e=this._startScreen=[a.screenX,
a.screenY];a=this._box={lt:c.create("div","g-zoom-box",b._mapFrame),rt:c.create("div","g-zoom-box",b._mapFrame),lb:c.create("div","g-zoom-box",b._mapFrame),rb:c.create("div","g-zoom-box",b._mapFrame),l:c.create("div","g-zoom-box g-zoom-box-left",b._mapFrame),r:c.create("div","g-zoom-box g-zoom-box-right",b._mapFrame),t:c.create("div","g-zoom-box g-zoom-box-top",b._mapFrame),b:c.create("div","g-zoom-box g-zoom-box-bottom",b._mapFrame)};for(var f in a)c.setPosition(a[f],e[0],e[1]),c.setZIndex(a[f],
b.options.topZIndex);f=window.getComputedStyle;var c=f(a.l),e=f(a.r),h=f(a.t),k=f(a.b);this._boxBorders=f?{l:parseInt(c["border-right-width"]||c.borderRightWidth)||0,r:parseInt(e["border-left-width"]||e.borderLeftWidth)||0,t:parseInt(h["border-bottom-width"]||h.borderBottomWidth)||0,b:parseInt(k["border-top-width"]||k.borderTopWidth)||0}:{l:parseInt(a.l.currentStyle["border-right-width"])||0,r:parseInt(a.r.currentStyle["border-left-width"])||0,t:parseInt(a.t.currentStyle["border-bottom-width"])||
0,b:parseInt(a.b.currentStyle["border-top-width"])||0};b._container.style.cursor="crosshair";d(document,"mousemove",this._onMouseMove,this);d(document,"mouseup",this._onMouseUp,this);b.fireEvent("shiftDragStart")},_onMouseMove:function(a){var b=this._map,c=b.getSize(),d=b.getDrawSize(),e=b._isCanvasRelMode(),f=e?c[0]:d[0],h=e?c[1]:d[1],k=G.DomUtil,l=k.setPosition,n=k.setSize,m=Math.min,p=Math.max,q=Math.abs,r=this._box,x=this._boxBorders,w=this._startScreen,v=k.getMousePosition(a,b._container),s=
p(0,q(v[0]-w[0])-x.l-x.r),p=p(0,q(v[1]-w[1])-x.t-x.b),q=m(v[0],w[0]),m=m(v[1],w[1]),v=w=0;e||(e=b.getCenter(),w=b._res,b=b.toScreen([e[0]-w*d[0]/2,e[1]+w*d[1]/2],0,0,!0),w=b[0],v=b[1],q-=(d[0]-c[0])/2,m+=(d[1]-c[1])/2);w=parseInt(w);v=parseInt(v);s=parseInt(s);p=parseInt(p);q=parseInt(q);m=parseInt(m);k.preventDefault(a);k.stopPropagation(a);0>q&&(s+=q,q=0);0>m&&(p+=m,m=0);a=f-q-x.l-x.r;x=h-m-x.t-x.b;s=s>a?a:s;p=p>x?x:p;l(r.lt,w,v);n(r.lt,q,m);l(r.rt,w+q+s,v);n(r.rt,f-q-s,m);l(r.lb,w,v+m+p);n(r.lb,
q,h-m-p);l(r.rb,w+q+s,v+m+p);n(r.rb,f-q-s,h-m-p);l(r.l,w,v+m);n(r.l,q,p);l(r.r,w+q+s,v+m);n(r.r,f-q-s,p);l(r.t,w+q,v);n(r.t,s,m);l(r.b,w+q,v+m+p);n(r.b,s,h-m-p)},_onMouseUp:function(a){var b=this._map,c=b._res,d=b._rotate,e=d/G.MathUtil.DEGREE_PER_RADIAN,f=G.DomUtil,h=f.removeListener,k=this._startScreen,l=f.getMousePosition(a,b._container);f.preventDefault(a);f.stopPropagation(a);for(var n in this._box)b._mapFrame.removeChild(this._box[n]);b._container.style.cursor="";f.enableTextSelection();f.enableImageDrag();
h(document,"mousemove",this._onMouseMove,this);h(document,"mouseup",this._onMouseUp,this);a=Math.abs;h=this._boxBorders;f=l[0]-k[0]-h.l-h.r;l=l[1]-k[1]-h.t-h.b;if(0!==f||0!==f)b.fireEvent("shiftDragEnd"),k=b.toMap([k[0]+f/2,k[1]+l/2]),f=a(f)*c,c*=a(l),d&&(f*=Math.cos(e),c*=Math.cos(e)),b.zoomTo(k,f,c)}});
G.Handler.Pinch=G.Handler.extend({afterOn:function(){var a=this._map;this._pinchable||(this._pinchable=new G.DomPinchable(a._mapFrame,a._container),this._pinchable.addListener("pinchStart",this._onPinchStart,this),this._pinchable.addListener("pinch",this._onPinch,this),this._pinchable.addListener("pinchEnd",this._onPinchEnd,this),this._pinchable.on())},afterOff:function(){this._pinchable&&(this._pinchable.off(),this._pinchable.removeListener("pinchStart",this._onPinchStart,this),this._pinchable.removeListener("pinch",
this._onPinch,this),this._pinchable.removeListener("pinchEnd",this._onPinchEnd,this),delete this._pinchable)},_onPinchStart:function(a){var b=this._map,c=G.MathUtil;b._zoomAnim&&b._zoomAnim.stop();if(!this._pinching){this._pinching=!0;b.fireEvent("pinchStart");var d=G.DomUtil.getMousePosition(a.originTouch1,b._container),e=G.DomUtil.getMousePosition(a.originTouch2,b._container);a=d[0];var d=d[1],f=e[0],e=e[1],h=a-f,k=d-e;this._pinchStart=[(a+f)/2,(d+e)/2];this._pinchStartMap=b.toMap(this._pinchStart);
this._pinchStartDis=c.calcHypotenuse(h,k);this._pinchStartRotate=c.calcTheta(h,k);this._startRes=b._res;this._startRotate=b._rotate;this._startCenter=b._center;this._zooming=this._rotating=!1;b._handlers.Click._lastDown=null;c=b._mode;"webgl"!=c&&"canvas"!=c&&(b._mapFrame.style[G.DomUtil.Transition]="")}},_onPinch:function(a){var b=this._map;this._pinching&&(this._temp(a),b.fireEvent("pinch"))},_onPinchEnd:function(){var a=this._map,b=a.options,c=b.minRes,d=b.maxRes;if(this._pinching&&(this._pinching=
!1,a.fireEvent("pinchEnd"),this._final(),!a.options.continuouslyZoom)){var e=this._startRes,b=a._res;if(!(Math.abs(e-b)<b/1E4||(d=G.MathUtil.limitRange(a._calcNearestRes(b>e),c,d),Math.abs(d-b)<b/1E4))){var c=d/b,e=a.getSize(),b=e[0]*d,d=e[1]*d,e=a.getCenter(),f=this._pinchStartMap[0],h=this._pinchStartMap[1];this._newCenter=[f+(e[0]-f)*c,h+(e[1]-h)*c];this._newWidth=b;this._newHeight=d;a.zoomTo(this._newCenter,this._newWidth,this._newHeight,{fireEnd:!0})}}},_temp:function(a){var b=this._map,c=b.options,
d=c.minRes,e=c.maxRes,f=b.getSize(),h=G.MathUtil,k=Math.max,l=G.DomUtil.getMousePosition(a.originTouch1,b._container),n=G.DomUtil.getMousePosition(a.originTouch2,b._container);a=l[0];var l=l[1],m=n[0],p=n[1],n=h.calcHypotenuse(a-m,l-p),q;c.pinchRotate&&(c=h.calcTheta(a-m,l-p),q=c-this._pinchStartRotate,this._rotating||(this._pinchStartRotate=c,this._rotating=!0,b.fireEvent("rotateStart"),q=0));var r=this._pinchStartDis,c=n-r,k=k(k(f[0]/2,f[1]/2),r),k=Math.pow(2,-c/k);a=[(a+m)/2,(l+p)/2];this._zooming||
(this._pinchStart=a,this._pinchStartMap=b.toMap(this._pinchStart),this._pinchStartDis=n,this._zooming=!0,b.fireEvent("zoomStart"),k=1);d=h.limitRange(k*this._startRes,d,e);a=[a[0]-f[0]/2,a[1]-f[1]/2];a=h.rotateVector(a,-b._rotate);this._rotating&&(a=h.rotateVector(a,q*h.DEGREE_PER_RADIAN));k=this._pinchStartMap;e=k[0]-a[0]*d;a=k[1]+a[1]*d;k=this._startRotate;this._rotating&&(k=this._startRotate+q*h.DEGREE_PER_RADIAN);this._newCenter=[e,a];this._newWidth=f[0]*d;this._newHeight=f[1]*d;b._rawView(this._newCenter,
this._newWidth,this._newHeight,k);this._rotating&&b.fireEvent("rotate");this._zooming&&b.fireEvent("zoom");b._requestRedraw()},_final:function(){var a=this._map;this._rotating&&a.fireEvent("rotateEnd");this._zooming&&a.fireEvent("zoomEnd");a._checkView();a._requestUpdate()}});
G.Map=G.Class.extend({mixins:[G.Event],options:{srid:3857,wrap:!0,minRes:0.298582141738892,maxRes:156543.033928,maxExtent:[-2.0037508342784E7,-2.0037508342784E7,2.0037508342784E7,2.0037508342784E7],scrollPage:!1,zoomAnim:!0,zoomAnimDuration:0.3,panAnim:!0,panAnimMaxSpeed:1E3,panAnimDuration:0.3,panAnimEase:0.3,rotateAnim:!0,rotateAnimDuration:0.3,tolerance:1E-5,topZIndex:100,doubleDuration:0.3,hideLogo:!1,doubleZoom:!0,pinchZoom:!0,pinchRotate:!0,dragPan:!0,shiftZoom:!0,scrollZoom:!0,continuouslyZoom:!0,
touchTol:8,dragEdge:8,recordStatus:!0,mask:!1,maskColor:"#000",maskOpacity:1,spark:!0,sparkOffset:[-24,-24],sparkDuration:1,canvasAnimRedraw:!1,canvasExpandFactor:0.25,glColor:"#fff",initStatus:{center:[0,0],res:156543.033928,rotate:0}},init:function(a,b){var c=this._container=G.DomUtil.get(a);this.options=G.Util.merge({},this.options,b);if(!c)throw Error("No map container!");c._initBy!==G.name&&(this._initLayout(),this._initListeners(),this._initHandlers(),this._initAddition(),c._initBy=G.name,this._onResize(),
this.fireEvent("resize"));this._center=this.options.initStatus.center||[0,0];this._res=this.options.initStatus.res||156543.033928;this._rotate=this.options.initStatus.rotate||0;this._extent=[];this._layerIdSeq=0;this._layers={};this._layerOrder=[];this._masks=[];this._rotate&&(this._updateCompass(this._rotate),this._updateDrawSize());this._ensureViewByUrl()},resize:function(){var a=this._container;this._size=[a.offsetWidth,a.offsetHeight];this.view(this._center,this._width,this._height,this._rotate);
this._onResize();this.fireEvent("resize");return this},redraw:function(){this._requestRedraw();return this},update:function(){this._requestUpdate();return this},getExtent:function(a){var b=this.getSize(),c=this.getCenter(),d=this._res,e=a||0;a=b[0]*d/2+e;b=b[1]*d/2+e;return[c[0]-a,c[1]-b,c[0]+a,c[1]+b]},getRedrawExtent:function(a){var b=this.getDrawSize(),c=this.getCenter(),d=this._res,e=this.options,f=this._isCanvasRelMode()?1+2*e.canvasExpandFactor:1,h=a||0;a=(b[0]*d/2+h)*f;d=(b[1]*d/2+h)*f;b=c[0]-
a;a=c[0]+a;c=[b,c[1]-d,a,c[1]+d];e.wrap&&(d=e.maxExtent,e=d[0],d=d[2],b<e&&(c[2]=Math.max(a,d+e-b)),a>d&&(c[0]=Math.min(b,e+d-a)));return c},getRotate:function(){return this._rotate},getSize:function(){if(!this._size){var a=this._container;a&&(this._size=[a.offsetWidth,a.offsetHeight])}return this._size},getDrawSize:function(){this._drawSize||this._updateDrawSize();return this._drawSize},getLayers:function(){return this._layers},getLayer:function(a){return this._layers[a]},addLayer:function(a){if(a instanceof
G.Layer)return a.addTo(this),a._id},addMask:function(a){if(a instanceof G.Graphic.Polygon||a instanceof G.Graphic.Circle)a._map=this,this._masks.push(a),this._requestRedraw();return this},clearMask:function(){this._masks=[];this._requestRedraw();return this},view:function(a,b,c,d){this._rawView(a,b,c,d);this._updateUrl();this._checkView();this._requestUpdate();return this},centerAt:function(a,b){var c=this._center,d=this._res;return this.panBy((c[0]-a[0])/d,(c[1]-a[1])/d,b)},zoomTo:function(a,b,c,
d){var e=this.options,f=this._size,h=e.maxRes,k=e.minRes,l=h?f[1]*h:c,n=k?f[1]*k:c;d={center:a,width:G.MathUtil.limitRange(b,k?f[0]*k:b,h?f[0]*h:b),height:G.MathUtil.limitRange(c,n,l),duration:d&&void 0!==d.duration?d.duration:e.zoomAnimDuration,fireEnd:d&&void 0!==d.fireEnd?d.fireEnd:!0,ignoreAnim:d&&void 0!==d.ignoreAnim?d.ignoreAnim:!1};e.zoomAnim&&!G.Browser.ielt9?(this._zoomAnim=this._zoomAnim||new G.Anim.Zoom(this),this._zoomAnim._playing?this._zoomAnim.update(d):this._zoomAnim.start(d)):(this.fireEvent("zoomStart"),
this._rawZoomTo(a,b,c),this._updateUrl(),this.fireEvent("zoomEnd"),this._checkView(),this._requestUpdate());return this},zoomRes:function(a,b,c){if(!b)return this;var d=this.getSize();return this.zoomTo(a,d[0]*b,d[1]*b,c)},zoomExtent:function(a,b){var c=this.options;if(!a)return this;var d=this.getSize(),e=(a[0]+a[2])/2,f=(a[1]+a[3])/2,h=a[2]-a[0],k=a[3]-a[1],l=Math.max(h/d[0],k/d[1]),n=l,m=this._zoomReses;if(!c.continuouslyZoom&&m){d=0;for(h=m.length;d<h&&!(c=m[d],c<l);d++)n=c;return this.zoomRes([e,
f],n,b)}h&&k||(n=this._res,h=d[0]*n,k=d[1]*n);return this.zoomTo([e,f],h,k,b)},zoomIn:function(a){var b=this.getSize(),c=this._res,d=G.MathUtil.limitRange(this._calcNearestRes(),this.options.minRes,this.options.maxRes);if(!(Math.abs(d-c)<c/1E4))return c=b[0]*d,b=b[1]*d,d=this.getCenter(),this.zoomTo(d,c,b,a)},zoomOut:function(a){var b=this.getSize(),c=this._res,d=G.MathUtil.limitRange(this._calcNearestRes(1),this.options.minRes,this.options.maxRes);if(!(Math.abs(d-c)<c/1E4))return c=b[0]*d,b=b[1]*
d,d=this.getCenter(),this.zoomTo(d,c,b,a)},panBy:function(a,b,c){var d=this.options;d.panAnim&&!G.Browser.ielt9?(this._panAnim||(this._panAnim=new G.Anim.Pan(this)),this._panAnim.start({offsetX:a||0,offsetY:b||0,duration:c&&void 0!==c.duration?c.duration:d.panAnimDuration,ease:c&&void 0!==c.ease?c.ease:d.panAnimEase})):(this.fireEvent("moveStart"),this._rawPanBy(a,b),this._updateUrl(),this.fireEvent("moveEnd"),this._checkView(),this._requestUpdate());return this},rotateTo:function(a,b){var c=this.options;
c.rotateAnim&&!G.Browser.ielt9?(this._rotateAnim||(this._rotateAnim=new G.Anim.Rotate(this)),this._rotateAnim.start({to:a||0,duration:b&&void 0!==b.duration?b.duration:c.rotateAnimDuration})):(this.fireEvent("rotateStart"),this._rawRotateTo(a||0),this._updateUrl(),this.fireEvent("rotateEnd"),this._checkView(),this._requestUpdate());return this},isZooming:function(){var a=this._zoomAnim;return a&&a._playing},isPanning:function(){var a=this._panAnim;return a&&a._playing},isRotating:function(){var a=
this._rotateAnim;return a&&a._playing},isDragging:function(){var a=this._handlers.Drag;return a&&a._dragging},isPinching:function(){var a=this._handlers.Pinch;return a&&a._pinching},getCenter:function(){return this._center},getResolution:function(){return this._res},toScreen:function(a,b,c,d){var e=this.getSize(),f=this.getCenter(),h=this._res,k=this._rotate,l=e[0]/2,e=e[1]/2,n=G.Browser.getPxRatio(),m=l+(a[0]-f[0])/h/n[0];a=e-(a[1]-f[1])/h/n[1];b&&(c&&1!==c)&&(c=1/c-1,m+=(m-b[0])*c,a+=(a-b[1])*c);
b=m-l;c=a-e;k&&(b&&c&&!d)&&(d=G.MathUtil.rotateVector([b,c],k),m=d[0]+l,a=d[1]+e);return[m,a]},toMap:function(a,b){var c=this.getSize(),d=this.getCenter(),e=this._res,f=this._rotate,h=c[0]/2,k=c[1]/2,l=G.Browser.getPxRatio(),c=l[0],l=l[1],h=a[0]-h,k=a[1]-k;f&&(h&&k&&!b)&&(f=G.MathUtil.rotateVector([h,k],-f),h=f[0],k=f[1]);return[h*e*c+d[0],-k*e*l+d[1]]},showPopup:function(a,b,c,d){var e=G.DomUtil;b&&(this._popupContentWrapper.innerHTML=b);b=this._popup;b._mapPoint=a;b._offsetX=c||0;b._offsetY=d||
0;this._updatePopupPos();e.show(b);this.fireEvent("popupShown");return this},hidePopup:function(a){var b=this._popup;b._mapPoint=null;G.DomUtil.hide(b);a&&(this._popupContentWrapper.innerHTML="");this.fireEvent("popupHidden");return this},isPrintable:function(){if("canvas"!=this._mode&&"webgl"!=this._mode)return!1;var a,b;for(a in this._layers)if(b=this._layers[a])if(b=b.options.crossOrigin,void 0!==b&&"*"!==b)return!1;return!0},destroy:function(){var a=this._container,b=G.DomUtil,c=G.DomUtil.removeListener,
d,e;for(d in this._layers)this._layers[d].remove();var f=this._mouseEvents;d=0;for(e=f.length;d<e;d++)c(a,f[d],this._onMouseEvent,this);c(this._popup,"mouseenter",b.stopPropagation);c(this._popup,"mousemove",b.stopPropagation);c(this._popup,"mouseleave",b.stopPropagation);c(this._popup,"mousedown",b.stopPropagation);c(this._popupClose,"click",this._onPopupCloseDown,this);c(this._popupClose,"mousedown",this._onPopupCloseDown,this);c(this._popupClose,"touchstart",this._onPopupCloseDown,this);c(this._compass,
"click",this._onCompassDown,this);c(this._compass,"mousedown",this._onCompassDown,this);c(this._compass,"touchstart",this._onCompassDown,this);c(window,"contextmenu",this._onWinContextMenu,this);c(window,"resize",this._onWinResize,this);c(window,"hashchange",this._onWinHashChange,this);b.removeClass(a,"g-container");b.remove(this._mapFrame,a);b.remove(this._panelFrame,a);a._initBy=void 0;return this},_initLayout:function(){var a=G.DomUtil,b=G.Browser;a.addClass(this._container,"g-container");b.retina&&
a.addClass(this._container,"retina");b.ielt9&&a.addClass(this._container,"ielt9");this._mapFrame=a.create("div","g-map-frame",this._container);this._layersFrame=a.create("div","g-layers-frame",this._mapFrame);var c=this._popup=a.create("div","g-popup",this._mapFrame),d=a.create("div","g-popup-wrapper",c);this._popupClose=a.create("div","g-popup-close",d);d=a.create("div","g-popup-content",d);this._popupContentWrapper=a.create("div","g-popup-content-wrapper",d);this._popupPointer=a.create("div","g-popup-pointer",
c);a.hide(c);this._maskFrame=a.create("div","g-mask-frame",this._mapFrame);this._spark=a.create("div",G.DomUtil.testStyle(["pointer-events"])?"g-spark":"",this._mapFrame);this._panelFrame=a.create("div","g-panel-frame",this._container);b.ielt9?(b=a.createVML("group","",this._panelFrame),this._compass=a.createVML("image","g-vml g-compass",b)):this._compass=a.create("div","g-compass",this._panelFrame);a.hide(this._compass);this.options.hideLogo||(b=this._brand=a.create("div","g-brand",this._panelFrame),
c=b.style,c.left="8px",c.bottom="8px",c.position="absolute",c.background="#fff",c.border="1px solid #ddd",c.borderRadius=c["-moz-border-radius"]=c["-webkit-border-radius"]=c["-o-border-radius"]="13px",c=this._brandImg=a.create("img","",b),d=c.style,d.verticalAlign="middle",d.width="24px",d.height="24px",c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4MDk4YTdlNC03ZGFmLTQ1MzctODRhNy0yYmVhYWFhMzgxYjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZCNEU1MTNENjY1MTFFNUI0N0JCRTI4MDZCREI0RTgiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZCNEU1MTJENjY1MTFFNUI0N0JCRTI4MDZCREI0RTgiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ZTdmYzZiYjctYzk5YS00ZDBkLWI1NWYtNzkyZTY0ODg2ZmMwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjgwOThhN2U0LTdkYWYtNDUzNy04NGE3LTJiZWFhYWEzODFiNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PjwgStUAAApESURBVHja7FlrTJTpFT5zY4AZZrgPVhgUAYsyOKLbjZcsdjXa1CZeahNNNU0bo25a/2xMf3jpj66aNO0Pk6ahVmpa1xRb29Wtl9h1q6XuqlUpWgsIAjLcGRhGZoa5MZee55VPh0EYQLbtZn2TLzPffO/3vufynOec844sHA7T53nI6XM+Xivwvx7K6B8GBgb+74VOTU19DaEvrgKgbblcTlqtltRqNb0qjcv/24KnpaVRcnIy9fb2UigUEvdQBN9nJIg/K8GlwHv06BFVVlbSgwcPKCsrizZs2EBlZWWUnp5OLpeLvF6vmD/ZIYt24UyxkCR4SkqKuG9sbKTr169TfX093bt3jzQaDQUCASH44sWLaeXKlbR06VKKj48nm81GMplsUiw0owpgrcTERCF4XFycEKK2tpZu3rwpLD48PCys3tDQQD6fT8yZPXu2eM/hcFBOTg5t2rSJTCYT2e32cZWYtAL79u2jogVFZOmy8ExIGCK1SkOhcDxZ7f0ciDpK0CbRvz+9TkpZkHSGWRSQqcpaGxt+qNXp/5yZZbgeCIb1LqfrLoVY+IxMGpYrKC0lmfyD/eRwuYUCer1eeKOzs5MyMzPp0KFDpFAoyOPxxFRgWjEQYqUVSiWxkKxTiDTpBpqbn0effnz1SEN97X45KxufoPm6pSneFQoGg/MXLSlJSExsS0zU0LBCyc8SyGsPjfIcLijT3d1Nt2/fpjVr1pDb7Z4QSlNWIDyymUajpQHXoLHh4f3FWp3uQx0r0N1r+5aluWl/UpKOVAwNKBYMBLQBhk1PR+tvEzXaG3arVRtWKHuyDJnV6XrNX8ntHbNHUlISVVVVUWlpqYgTKDF9BUbQpVQpSC6TM9UFSKdPZny6MqquXKhxDthSl65c9WV7f92WtpbGw3Hxap4b94zb2XLwUhxTZF9X9yqXc3CVQqWi3PyCOp6UkZqs6wQpRccQFOjo6KBbt27R+vXraWhoaEIvTKiATP7sRZvNwbqESMnu9/h66JNrNz5w9PenJiWnUHN97X2vx6OMi4PwqjGJyetxM2Ti+94oe/v7anXC3/QZqX2mErPG0WnROJ4+HQtP9hxiAjBasWJFTC9MSLiAgUqp4gBTktPFKsi09KCmdmf7k8crU9IzSM6B5vf74llwJaw9JqvyvY953bxs2cFla9ae5Xf63EMuilMqhlL0eqvEVMJY/Cld8AIC+u7du4JWJ8rWEyoALOv1Olo0v4DyMg00x5BJDOy3FKyUyJwIZvaKJMThw4dp3bp1zzcMC/ipmKl0Ld3tbWS3WcnvG6ZLZ05vOXr0SDXnhF8iK8PisHTkBboF9Q4ODlICB/20INTV1aVoamoOOpmjw3IlBWUhpk7NnXAovANCR1rm5MmTtHr1atqxYwcdOHCATp8+LRRDTrhXVfWzBSWLzaBi15CbWh7VnWFYKCwWS+mlS5f+wKXENdDoKMvye7w/zZs3T+QGZOgpe6Cmpib864oKuvLRR+QPhjnVuynDMOvjBLYQs+OoucCsNJqamp5/V8cn0ICtd5F9oO+d9AyDqH2USuVZ8Dxb1s0QaQaUUA9FXjAO+B7JbaI6aUIPsBVCHg7CrOwcDl4/DXB2ZEg80iUn/8tht5eAYaRx/PhxkYVRJoBBIplDwcmrv7/vKwa3q9zr81J+sXlbprXrT2zVGi41LIBIpAdg/ZaWFtqyZYsoL56+JNgnx0IshJYzbW7uXHZViC/OARxUxty8I3c6qn6PGJGh8GJrYe6xY8eev/ci6YUEFZYa57YUziskx+CIMHn5f6y+VSVKCvbIKI/6/X4RByj0MPBsPCqdUAFYBXBJ5RJAxcEo54AFl38px3g1K9tYa7f1LyQRB1wDcXKLjAlsCMYBjRYsNP1q6ZtvvmfMmU3utJTnc+58cm2MYBL2IXxRUZGw/rTzgHyE1poeNwhLQlguDYgTln152VeLa2v++fOng/a1Kanpt1oa678DvENRzgsE6Bnz8m8bc/N/pE5IvOp1uzifWLmgC4xSMnrA+oDUxo0bY1o/diYeYZpwKCiElyzs8/rI7XBS8aJF7yoS44eD3gB53ENJ1p7uzUMuJ2Ubc2vSMg1Hk5LT/jInb76z4eFD8mcheFUs0IuARMaFl8H7Ugzgt127dpHZbI5p/UnXQnCrVHBJZQJKY7lCPowQaG+zUJG59Jsp7e3fs3Z2mJi53j3x/u/C7a1tNNBnFRldJpO/qE1Gxt69e4XHwELS2k6nk7Zu3SqYB0rFam4mVACJBBZAU1JeXk4nTpygOXPmPNss4CVbT7eYl6BWku+pjUJ+z8ntO75NGRkZ1GtpoQUF+bRz506RVZFRQbVvmE1iDVAlLA+IRMIE38FmKKVjWX/SDQ0WxLw9e/ZQXV3dqHpcGtgYQkmbMxSKOVm9zx2XArjGYOv62OrfyM/P74WlMQ+WjhQUVsdea9euFYZ4WU8w5X4Am2Gxbdu20blz50SaH+NKpkJky9bWVvGdMRw8f/68+fHjx8KD6LCQxNrb2wNo6AFBlBCAUGSikhTAJ9aZkaYe7ocAWBi1DjaNHjqdjh5ysEKw5cuXwxv17I23Tp069XcIwu8MHzx4MJ9LZNvly5eForAy1kYuiBy4h1KS517pWEWq0cHNfX19QvjIgJYuQAiCGgwGAUM0JSzsDRbyB1B+9+7dX+Naqe3ixYvU3NwsrA/h8V70Wghc9MhQAiXHK3kAmGa309mzZwVEsOnLBrj7yZMnhYzZUsb4GTTuhYWFwGsoLKpWRQAFXk9PD82aNQvN/nZOVFfYOP3RHsDAEQtgVFJSMmE/EFMBUByOOSAQlBmPGZD6GdsLGPeVzDLblyxZUl5ZWWlmWB0G9isqKqqys7PfMZlMnRcuXPgJl9JFfD+f++B+lBrRA97GQC2EQB6vJ4jJQhAYsEGCQTCP12Cgroen9u/ff6i6uvrHeA8WLC4urmDlfspUWs6weBvQAGw2b978XYbVb+DV6FIaA0rhvCg3N3eMB6bEQhIOARFUiFAA92NaRxYEm7LL3+Pnv2BomDige5iBGqAY4381W9XMBkriNf+xcOFCP9ZAoEZ7FRaH19hD4/YBkw5iLA6MYkFg1yPqHM9L58GywC57bIAtVwXhwUp4H884cO8bjcYbKHkwD88kI+GCQvgNzyA88kp03zEtGpUW4eAU7gOPA2oQWh3RE0TOhzcguNTnSrQoUWS08hAeguMTVSgUiHUiMWkFJOticZycIalZrVZxCIWeFc8RxFMdknAQHAPrFhQUiAMuKTZm7GBLshICCjwNvsfBLBgKimBDXNGlAe5fVjJgLVgY6wGaqI/wibXxe/T8GTtej1QEwQyPID5wj01RAiNRIalBOQQ/YIZkBtgBRmA0wARGwAWLQ3CsIRV2kxF+Rk6npcyJHIHNmUJFSQG2QkCiKUfsWCwWwWIS/sHvSFIQdCoW/8yO1yW6lf4PmMzAXuGRfnq6/1LO2D80UtMzVQNMVfiYEHr9L+VrBb5gCvxHgAEA/sHRcrWRKMYAAAAASUVORK5CYII=",
b=this._brandInfo=a.create("div","",b),c=b.style,c.color="#999",c.verticalAlign="middle",c.fontSize="12px",c.margin="0px 12px 0px 4px",c.display="none",b.innerHTML="Powered by <a style='color:#009BAE' href='http://geohey.com' target='_blank'>GeoHey</a>");a.markPosTransform(this._mapFrame,0,0);a.updateTransform(this._mapFrame)},_initListeners:function(){for(var a=G.DomUtil,b=G.DomUtil.addListener,c=this._mouseEvents="click dblclick mousedown mousemove mouseup mouseenter mouseleave mousewheel DOMMouseScroll touchstart touchmove touchend".split(" "),
d=0,e=c.length;d<e;d++)b(this._container,c[d],this._onMouseEvent,this);b(this._popup,"mouseenter",a.stopPropagation);b(this._popup,"mousemove",a.stopPropagation);b(this._popup,"mouseleave",a.stopPropagation);b(this._popup,"mousedown",a.stopPropagation);b(this._popupClose,"click",this._onPopupCloseDown,this);b(this._popupClose,"mousedown",this._onPopupCloseDown,this);b(this._popupClose,"touchstart",this._onPopupCloseDown,this);b(this._compass,"click",this._onCompassDown,this);b(this._compass,"mousedown",
this._onCompassDown,this);b(this._compass,"touchstart",this._onCompassDown,this);this._brand&&b(this._brand,"mousemove",this._onBrandMouseMove,this);this._brandImg&&(b(this._brandImg,"mousedown",this._onBrandImgDown,this),b(this._brandImg,"touchstart",this._onBrandImgDown,this));b(window,"contextmenu",this._onWinContextMenu,this);b(window,"resize",this._onWinResize,this);b(window,"hashchange",this._onWinHashChange,this);this.addListener("zoomStart",this._onZoomStart,this);this.addListener("zoomUpdate",
this._onZoomUpdate,this);this.addListener("zoom",this._onZoom,this);this.addListener("zoomEnd",this._onZoomEnd,this);this.addListener("moveStart",this._onMoveStart,this);this.addListener("move",this._onMove,this);this.addListener("moveEnd",this._onMoveEnd,this);this.addListener("rotateStart",this._onRotateStart,this);this.addListener("rotate",this._onRotate,this);this.addListener("rotateEnd",this._onRotateEnd,this);this.addListener("pinchStart",this._onPinchStart,this);this.addListener("pinch",this._onPinch,
this);this.addListener("pinchEnd",this._onPinchEnd,this)},_initHandlers:function(){var a=this.options;this._handlers={};this._handlers.Click=new G.Handler.Click(this);a.doubleZoom&&G.Browser.ielt9&&(this._handlers.DoubleClick=new G.Handler.DoubleClick(this));a.pinchZoom&&(this._handlers.Pinch=new G.Handler.Pinch(this));a.dragPan&&(this._handlers.Drag=new G.Handler.Drag(this));a.shiftZoom&&(this._handlers.ShiftDrag=new G.Handler.ShiftDrag(this));a.scrollZoom&&(this._handlers.ScrollWheel=new G.Handler.ScrollWheel(this));
this._resetHandlers()},_resetHandlers:function(){var a=this.options;this._handlers.Click.on(1);if(a.doubleZoom&&G.Browser.ielt9)this._handlers.DoubleClick.on(1);if(a.pinchZoom)this._handlers.Pinch.on(1);if(a.dragPan)this._handlers.Drag.on(1);if(a.shiftZoom)this._handlers.ShiftDrag.on(1);if(a.scrollZoom)this._handlers.ScrollWheel.on(1)},_initAddition:function(){},_isCanvasRelMode:function(){return"canvas"==this._mode||"webgl"==this._mode},_isLoaded:function(){return this._center&&0<this._res},_updateCompass:function(a){var b=
G.DomUtil,c=this._compass;b.markRotateTransform(c,a);b.updateTransform(c);if(G.Browser.ielt9){c.style.rotation=a;var d=c.currentStyle.src;c.src=d.substring(1,d.length-1)}a?b.show(c,this.options.rotateAnimDuration):b.hide(c,0.5)},_updateDrawSize:function(){var a=this.getSize();if(a&&2==a.length){var b=a[0],a=a[1],c=Math.abs,d=Math.sin,e=Math.cos,f=this._rotate,h;f?(h=f/G.MathUtil.DEGREE_PER_RADIAN,f=c(b*e(h))+c(a*d(h)),b=c(b*d(h))+c(a*e(h))):(f=b,b=a);this._drawSize=[f,b]}},_onMouseEvent:function(a){var b=
G.DomUtil;if(this._isLoaded()){var c=a.type,d=G.DomUtil.getMousePosition(a,this._container),e=this.toMap(d);if("click"!=c||G.Browser.chromelite){for(var f=(a||a.touches[0]).target;f;){if("g-popup"==f.className)return;f=f.parentElement}"DOMMouseScroll"==c&&(c="mousewheel");"mousewheel"==c&&this.options.scrollPage||b.preventDefault(a);this.fireEvent(c,{mapX:e[0],mapY:e[1],screenX:d[0],screenY:d[1],originEvent:a})}}},_onPopupCloseDown:function(a){var b=G.DomUtil;b.stopPropagation(a);b.preventDefault(a);
this.hidePopup(!0)},_onCompassDown:function(a){var b=G.DomUtil;b.stopPropagation(a);b.preventDefault(a);this.rotateTo(0)},_onBrandMouseMove:function(a){var b=G.DomUtil;b.stopPropagation(a);b.preventDefault(a)},_onBrandImgDown:function(a){var b=G.DomUtil;b.stopPropagation(a);b.preventDefault(a);a=this._brandInfo;a.style.display="none"==a.style.display?"inline-block":"none"},_onWinContextMenu:function(a){G.DomUtil.preventDefault(a)},_onWinResize:function(){this.resize()},_onWinHashChange:function(){this.options.recordStatus&&
this._ensureViewByUrl()},_requestRedraw:function(){var a=G.Util;a.cancelAnimFrame(this._redrawAnimFrame);this._redrawAnimFrame=a.requestAnimFrame(this._redraw,!0,this)},_redraw:function(){var a,b;for(a in this._layerOrder)b=this._layerOrder[a],(b=this._layers[b])&&(b.isVisible()?b._draw():b._erase());this._drawMask();this.fireEvent("redraw")},_requestUpdate:function(){var a=G.Util;a.cancelAnimFrame(this._updateAnimFrame);this._updateAnimFrame=a.requestAnimFrame(this._update,!0,this)},_update:function(){var a,
b;for(a in this._layers)b=this._layers[a],b.isVisible()&&b._update();this._drawMask();this.fireEvent("update")},_onResize:function(){this._updateDrawSize();this._requestUpdate()},_checkView:function(){var a=this._lastView||{},b=a.res,c=a.center||[],a=a.rotate,d=this._res,e=this._center||[],f=this._rotate;if(d!==b||e[0]!==c[0]||e[1]!==c||f!==a)this._lastView={res:d,center:e,rotate:f},this.fireEvent("viewChanged",{from:{res:b,center:c,rotate:a},to:this._lastView})},_rawZoomTo:function(a,b,c){a=this._center=
this._calcRealCoords(a);b&&c&&(this._res=this._calcResByViewport(a,b,c));this._updatePopupPos()},_rawPanBy:function(a,b){var c=G.DomUtil,d=this._mapFrame,e=c.getPosition(d);c.markPosTransform(d,-e[0]+a,e[1]-b);c.updateTransform(d);this._updatePopupPos()},_rawRotateTo:function(a,b){for(var c=G.DomUtil,d=this.getSize(),e=this._mapFrame;180<a;)a-=360;for(;-180>a;)a+=360;var f=b;!f&&e._rotate&&(f=[e._rotate[1],e._rotate[2]]);f||(f=[d[0]/2,d[1]/2]);this._rotate=a;d=this._mode;"webgl"!=d&&"canvas"!=d&&
(c.markRotateTransform(e,a,f[0],f[1]),c.updateTransform(e));this._updateCompass(a);this._updateDrawSize();this._updatePopupPos()},_rawView:function(a,b,c,d){this._rawRotateTo(d||0);this._rawZoomTo(a,b,c)},_updatePopupPos:function(){var a=G.DomUtil,b=this._popup,c=b._mapPoint;if(c){var c=this.toScreen(c),d=a.getSizeNocache(b),e=a.getSizeNocache(this._popupPointer);a.markPosTransform(b,c[0]-d[0]/2+b._offsetX,c[1]-d[1]-e[1]+b._offsetY);a.updateTransform(b)}},_mergeFramePos:function(){var a=this,b=a._res,
c=a._center,d=a._rotate,e=G.DomUtil,f=a._mapFrame,h=e.getPosition(f),k=h[0]*b,h=h[1]*b,b=c[0]-k,l=c[1]+h;0!==d&&(0!==k&&0!==h)&&(d=G.MathUtil.rotateVector([k,h],-d),b=c[0]-d[0],l=c[1]+d[1]);a._center=a._calcRealCoords([b,l]);G.Util.requestAnimFrame(function(){a._beforeMergeFramePos();e.markPosTransform(f,0,0);e.updateTransform(f);a._updatePopupPos()},!0,a)},_beforeMergeFramePos:function(){},_calcWrapPointRange:function(a){var b=0,c=0;a=a[0];var d=this.getExtent(),e=this.options,f=e.maxExtent;e.wrap&&
f&&(b=f[2]-f[0],c=Math.floor((d[0]-a)/b),b=Math.ceil((d[2]-a)/b));return[c,b]},_calcRealCoords:function(a){if(a){var b=this.options,c=b.maxExtent,d=0;if(b.wrap&&c){for(d=c[2]-c[0];a[0]<=c[0];)a[0]+=d;for(;a[0]>=c[2];)a[0]-=d}return a}},_calcResByViewport:function(a,b,c){a=this.getSize();return Math.max(b/a[0],c/a[1])},_calcNearestRes:function(a){var b=this._res,c=this._zoomReses,d;if(c)for(var e=0,f=0,h=c.length;f<h;f++){d=c[f];if(Math.abs(d-b)<b/100)return b=f+1>=h?h-1:f+1,a?c[e]:c[b];if(d<b)return a?
c[e]:d;e=f}return a?2*b:b/2},_ensureViewByUrl:function(){var a=window.location.hash;if(a){var b=a.indexOf("!g_vs=");if(!(0>b)){var c=a.substring(b+6).split("!");if(c&&4<c.length){var a=Number(c[1]),b=Number(c[2]),d=Number(c[3]),c=Number(c[4]),e=this.getSize();this.view([a,b],e[0]*d,e[1]*d,c)}}}},_updateUrl:function(){if(this.options.recordStatus){var a=this._res,b=this.getCenter(),c=this._rotate;if(!(isNaN(b[0])||isNaN(b[1])||0>=a)){var d=window.location.hash||"#",e=d.indexOf("!g_vs="),a=(0<e?d.substring(0,
e):d)+"!g_vs=!"+b[0]+"!"+b[1]+"!"+a+"!"+c;if((c=window.history)&&c.pushState){if(b=c.state?c.state.uri:null,a!=b)try{c.pushState({uri:a},null,a)}catch(f){}}else b=window.location.href,a!=b&&(window.location.href=a)}}},print:function(){},_drawMask:function(){},_onZoomStart:function(a){},_onZoomUpdate:function(a){},_onZoom:function(a){},_onZoomEnd:function(a){},_onMoveStart:function(a){},_onMove:function(a){},_onMoveEnd:function(a){},_onRotateStart:function(a){},_onRotate:function(a){},_onRotateEnd:function(a){},
_onPinchStart:function(a){},_onPinch:function(a){},_onPinchEnd:function(a){}});G.Proj={};
G.Proj.WebMercator={a:6378137,max:2.0037507842788246E7,project:function(a,b){var c=G.Proj.WebMercator,d=G.MathUtil.DEGREE_PER_RADIAN,e=c.a,f=a/d*e,d=Math.sin(b/d),e=e/2*Math.log((1+d)/(1-d));Infinity===e?e=c.max:-Infinity===e&&(e=-c.max);return[f,e]},unproject:function(a,b){var c=G.MathUtil.DEGREE_PER_RADIAN,d=G.Proj.WebMercator.a,e=a/d,f=Math.PI,e=e-2*Math.floor(e/f/2+0.5)*f,d=f/2-2*Math.atan(Math.exp(-b/d));return[e*c,d*c]}};
G.Proj.Gcj={a:6378245,ee:0.006693421622965823,project:function(a,b){var c=G.Proj.Gcj;if(!c._isInChina(a,b))return[a,b];var d=Math.PI,e=c._lonToGcj02(a-105,b-35),f=c._latToGcj02(a-105,b-35),h=b/180*d,k=Math.sin(h),k=1-c.ee*k*k,l=Math.sqrt(k),e=180*e/(c.a/l*Math.cos(h)*d),f=180*f/(c.a*(1-c.ee)/(k*l)*d);return[a+e,b+f]},unproject:function(a,b){for(var c=G.Proj.Gcj,d=a,e=b,f=c.project(d,e),h=f[0]-a,f=f[1]-b;1E-6<Math.abs(h)||1E-6<Math.abs(f);)d-=h/2,e-=f/2,f=c.project(d,e),h=f[0]-a,f=f[1]-b;return[d,
e]},_isInChina:function(a,b){return 72.004<=a&&137.8347>=a&&0.8293<=b&&55.8271>=b},_latToGcj02:function(a,b){var c=Math.PI,d=Math.sin,e=-100+2*a+3*b+0.2*b*b+0.1*a*b+0.2*Math.sqrt(Math.abs(a)),e=e+2*(20*d(6*a*c)+20*d(2*a*c))/3,e=e+2*(20*d(b*c)+40*d(b/3*c))/3;return e+=2*(160*d(b/12*c)+320*d(b*c/30))/3},_lonToGcj02:function(a,b){var c=Math.PI,d=Math.sin,e=300+a+2*b+0.1*a*a+0.1*a*b+0.1*Math.sqrt(Math.abs(a)),e=e+2*(20*d(6*a*c)+20*d(2*a*c))/3,e=e+2*(20*d(a*c)+40*d(a/3*c))/3;return e+=2*(150*d(a/12*c)+
300*d(a/30*c))/3}};G.ProjUtil={projectPoint:function(a,b){return b(a[0],a[1])},projectPolyline:function(a,b){var c=a[0],d=a[1],e,f,h=[];e=0;for(f=a.length;e<f;e++)d=a[e],c=d[0],d=d[1],h[e]=b(c,d);return h},projectPolygon:function(a,b){var c=a[0],d=a[1],e,f,h,k,l,n=[],m;e=0;for(f=a.length;e<f;e++){l=a[e];m=[];h=0;for(k=l.length;h<k;h++)d=l[h],c=d[0],d=d[1],m[h]=b(c,d);n[e]=m}return n}};
(function(){var a=window,b=document.getElementsByTagName("head")[0],c=G.Browser;if(!a.G_NOT_SET_VIEWPORT){var d=document.createElement("meta");d.name="viewport";d.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no";b.appendChild(d)}G.ready=function(a){a=G._readyFunc=a;G._needExecReady&&a&&(G._needExecReady=!1,a())};b=c.ielt9?"vml":"svg";a.G_OFF_CANVAS||c.avoidCanvas||(b=c.canvas?"canvas":b);a.G_ON_WEBGL&&(b=c.webgl?"webgl":b);G.loadModule(b,function(){G._needExecReady=
!0;var a=G._readyFunc;a&&(G._needExecReady=!1,a())},function(){throw Error("Core library load error!");})})();
