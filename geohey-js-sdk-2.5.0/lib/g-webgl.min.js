(function(a){var b;"undefined"===typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b={},define(function(){return b})):b="undefined"!==typeof window?window:a:b=exports;(function(a){if(!b)var b=1E-6;if(!f)var f="undefined"!==typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var k={setMatrixArrayType:function(m){f=m}};"undefined"!==typeof a&&(a.glMatrix=k);var n=Math.PI/180;k.toRadian=function(m){return m*n};var l={create:function(){var m=new f(2);m[0]=0;
m[1]=0;return m},clone:function(m){var a=new f(2);a[0]=m[0];a[1]=m[1];return a},fromValues:function(m,a){var b=new f(2);b[0]=m;b[1]=a;return b},copy:function(m,a){m[0]=a[0];m[1]=a[1];return m},set:function(m,a,b){m[0]=a;m[1]=b;return m},add:function(m,a,b){m[0]=a[0]+b[0];m[1]=a[1]+b[1];return m},subtract:function(m,a,b){m[0]=a[0]-b[0];m[1]=a[1]-b[1];return m}};l.sub=l.subtract;l.multiply=function(m,a,b){m[0]=a[0]*b[0];m[1]=a[1]*b[1];return m};l.mul=l.multiply;l.divide=function(m,a,b){m[0]=a[0]/b[0];
m[1]=a[1]/b[1];return m};l.div=l.divide;l.min=function(m,a,b){m[0]=Math.min(a[0],b[0]);m[1]=Math.min(a[1],b[1]);return m};l.max=function(m,a,b){m[0]=Math.max(a[0],b[0]);m[1]=Math.max(a[1],b[1]);return m};l.scale=function(m,a,b){m[0]=a[0]*b;m[1]=a[1]*b;return m};l.scaleAndAdd=function(m,a,b,d){m[0]=a[0]+b[0]*d;m[1]=a[1]+b[1]*d;return m};l.distance=function(m,a){var b=a[0]-m[0],d=a[1]-m[1];return Math.sqrt(b*b+d*d)};l.dist=l.distance;l.squaredDistance=function(m,a){var b=a[0]-m[0],d=a[1]-m[1];return b*
b+d*d};l.sqrDist=l.squaredDistance;l.length=function(m){var a=m[0];m=m[1];return Math.sqrt(a*a+m*m)};l.len=l.length;l.squaredLength=function(m){var a=m[0];m=m[1];return a*a+m*m};l.sqrLen=l.squaredLength;l.negate=function(m,a){m[0]=-a[0];m[1]=-a[1];return m};l.normalize=function(m,a){var b=a[0],d=a[1],b=b*b+d*d;0<b&&(b=1/Math.sqrt(b),m[0]=a[0]*b,m[1]=a[1]*b);return m};l.dot=function(m,a){return m[0]*a[0]+m[1]*a[1]};l.cross=function(m,a,b){a=a[0]*b[1]-a[1]*b[0];m[0]=m[1]=0;m[2]=a;return m};l.lerp=function(m,
a,b,d){var c=a[0];a=a[1];m[0]=c+d*(b[0]-c);m[1]=a+d*(b[1]-a);return m};l.random=function(m,a){a=a||1;var b=2*d()*Math.PI;m[0]=Math.cos(b)*a;m[1]=Math.sin(b)*a;return m};l.transformMat2=function(m,a,b){var d=a[0];a=a[1];m[0]=b[0]*d+b[2]*a;m[1]=b[1]*d+b[3]*a;return m};l.transformMat2d=function(m,a,b){var d=a[0];a=a[1];m[0]=b[0]*d+b[2]*a+b[4];m[1]=b[1]*d+b[3]*a+b[5];return m};l.transformMat3=function(m,a,b){var d=a[0];a=a[1];m[0]=b[0]*d+b[3]*a+b[6];m[1]=b[1]*d+b[4]*a+b[7];return m};l.transformMat4=function(m,
a,b){var d=a[0];a=a[1];m[0]=b[0]*d+b[4]*a+b[12];m[1]=b[1]*d+b[5]*a+b[13];return m};l.forEach=function(){var m=l.create();return function(a,b,d,c,e,k){b||(b=2);d||(d=0);for(c=c?Math.min(c*b+d,a.length):a.length;d<c;d+=b)m[0]=a[d],m[1]=a[d+1],e(m,m,k),a[d]=m[0],a[d+1]=m[1];return a}}();l.str=function(m){return"vec2("+m[0]+", "+m[1]+")"};"undefined"!==typeof a&&(a.vec2=l);var q={create:function(){var m=new f(3);m[0]=0;m[1]=0;m[2]=0;return m},clone:function(m){var a=new f(3);a[0]=m[0];a[1]=m[1];a[2]=
m[2];return a},fromValues:function(m,a,b){var d=new f(3);d[0]=m;d[1]=a;d[2]=b;return d},copy:function(m,a){m[0]=a[0];m[1]=a[1];m[2]=a[2];return m},set:function(m,a,b,d){m[0]=a;m[1]=b;m[2]=d;return m},add:function(m,a,b){m[0]=a[0]+b[0];m[1]=a[1]+b[1];m[2]=a[2]+b[2];return m},subtract:function(m,a,b){m[0]=a[0]-b[0];m[1]=a[1]-b[1];m[2]=a[2]-b[2];return m}};q.sub=q.subtract;q.multiply=function(m,a,b){m[0]=a[0]*b[0];m[1]=a[1]*b[1];m[2]=a[2]*b[2];return m};q.mul=q.multiply;q.divide=function(m,a,b){m[0]=
a[0]/b[0];m[1]=a[1]/b[1];m[2]=a[2]/b[2];return m};q.div=q.divide;q.min=function(m,a,b){m[0]=Math.min(a[0],b[0]);m[1]=Math.min(a[1],b[1]);m[2]=Math.min(a[2],b[2]);return m};q.max=function(m,a,b){m[0]=Math.max(a[0],b[0]);m[1]=Math.max(a[1],b[1]);m[2]=Math.max(a[2],b[2]);return m};q.scale=function(m,a,b){m[0]=a[0]*b;m[1]=a[1]*b;m[2]=a[2]*b;return m};q.scaleAndAdd=function(m,a,b,d){m[0]=a[0]+b[0]*d;m[1]=a[1]+b[1]*d;m[2]=a[2]+b[2]*d;return m};q.distance=function(m,a){var b=a[0]-m[0],d=a[1]-m[1],c=a[2]-
m[2];return Math.sqrt(b*b+d*d+c*c)};q.dist=q.distance;q.squaredDistance=function(m,a){var b=a[0]-m[0],d=a[1]-m[1],c=a[2]-m[2];return b*b+d*d+c*c};q.sqrDist=q.squaredDistance;q.length=function(m){var a=m[0],b=m[1];m=m[2];return Math.sqrt(a*a+b*b+m*m)};q.len=q.length;q.squaredLength=function(m){var a=m[0],b=m[1];m=m[2];return a*a+b*b+m*m};q.sqrLen=q.squaredLength;q.negate=function(m,a){m[0]=-a[0];m[1]=-a[1];m[2]=-a[2];return m};q.normalize=function(m,a){var b=a[0],d=a[1],c=a[2],b=b*b+d*d+c*c;0<b&&(b=
1/Math.sqrt(b),m[0]=a[0]*b,m[1]=a[1]*b,m[2]=a[2]*b);return m};q.dot=function(m,a){return m[0]*a[0]+m[1]*a[1]+m[2]*a[2]};q.cross=function(m,a,b){var d=a[0],c=a[1];a=a[2];var e=b[0],k=b[1];b=b[2];m[0]=c*b-a*k;m[1]=a*e-d*b;m[2]=d*k-c*e;return m};q.lerp=function(m,a,b,d){var c=a[0],e=a[1];a=a[2];m[0]=c+d*(b[0]-c);m[1]=e+d*(b[1]-e);m[2]=a+d*(b[2]-a);return m};q.random=function(m,a){a=a||1;var b=2*d()*Math.PI,c=2*d()-1,e=Math.sqrt(1-c*c)*a;m[0]=Math.cos(b)*e;m[1]=Math.sin(b)*e;m[2]=c*a;return m};q.transformMat4=
function(m,a,b){var d=a[0],c=a[1];a=a[2];m[0]=b[0]*d+b[4]*c+b[8]*a+b[12];m[1]=b[1]*d+b[5]*c+b[9]*a+b[13];m[2]=b[2]*d+b[6]*c+b[10]*a+b[14];return m};q.transformMat3=function(m,a,b){var d=a[0],c=a[1];a=a[2];m[0]=d*b[0]+c*b[3]+a*b[6];m[1]=d*b[1]+c*b[4]+a*b[7];m[2]=d*b[2]+c*b[5]+a*b[8];return m};q.transformQuat=function(m,a,b){var d=a[0],c=a[1],e=a[2];a=b[0];var k=b[1],f=b[2];b=b[3];var l=b*d+k*e-f*c,n=b*c+f*d-a*e,p=b*e+a*c-k*d,d=-a*d-k*c-f*e;m[0]=l*b+d*-a+n*-f-p*-k;m[1]=n*b+d*-k+p*-a-l*-f;m[2]=p*b+d*
-f+l*-k-n*-a;return m};q.rotateX=function(m,a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[0];e[1]=c[1]*Math.cos(d)-c[2]*Math.sin(d);e[2]=c[1]*Math.sin(d)+c[2]*Math.cos(d);m[0]=e[0]+b[0];m[1]=e[1]+b[1];m[2]=e[2]+b[2];return m};q.rotateY=function(m,a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[2]*Math.sin(d)+c[0]*Math.cos(d);e[1]=c[1];e[2]=c[2]*Math.cos(d)-c[0]*Math.sin(d);m[0]=e[0]+b[0];m[1]=e[1]+b[1];m[2]=e[2]+b[2];return m};q.rotateZ=function(m,
a,b,d){var c=[],e=[];c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];e[0]=c[0]*Math.cos(d)-c[1]*Math.sin(d);e[1]=c[0]*Math.sin(d)+c[1]*Math.cos(d);e[2]=c[2];m[0]=e[0]+b[0];m[1]=e[1]+b[1];m[2]=e[2]+b[2];return m};q.forEach=function(){var m=q.create();return function(a,b,d,c,e,k){b||(b=3);d||(d=0);for(c=c?Math.min(c*b+d,a.length):a.length;d<c;d+=b)m[0]=a[d],m[1]=a[d+1],m[2]=a[d+2],e(m,m,k),a[d]=m[0],a[d+1]=m[1],a[d+2]=m[2];return a}}();q.str=function(m){return"vec3("+m[0]+", "+m[1]+", "+m[2]+")"};"undefined"!==
typeof a&&(a.vec3=q);var s={create:function(){var m=new f(4);m[0]=0;m[1]=0;m[2]=0;m[3]=0;return m},clone:function(m){var a=new f(4);a[0]=m[0];a[1]=m[1];a[2]=m[2];a[3]=m[3];return a},fromValues:function(m,a,b,d){var c=new f(4);c[0]=m;c[1]=a;c[2]=b;c[3]=d;return c},copy:function(m,a){m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=a[3];return m},set:function(m,a,b,d,c){m[0]=a;m[1]=b;m[2]=d;m[3]=c;return m},add:function(m,a,b){m[0]=a[0]+b[0];m[1]=a[1]+b[1];m[2]=a[2]+b[2];m[3]=a[3]+b[3];return m},subtract:function(m,
a,b){m[0]=a[0]-b[0];m[1]=a[1]-b[1];m[2]=a[2]-b[2];m[3]=a[3]-b[3];return m}};s.sub=s.subtract;s.multiply=function(m,a,b){m[0]=a[0]*b[0];m[1]=a[1]*b[1];m[2]=a[2]*b[2];m[3]=a[3]*b[3];return m};s.mul=s.multiply;s.divide=function(m,a,b){m[0]=a[0]/b[0];m[1]=a[1]/b[1];m[2]=a[2]/b[2];m[3]=a[3]/b[3];return m};s.div=s.divide;s.min=function(m,a,b){m[0]=Math.min(a[0],b[0]);m[1]=Math.min(a[1],b[1]);m[2]=Math.min(a[2],b[2]);m[3]=Math.min(a[3],b[3]);return m};s.max=function(m,a,b){m[0]=Math.max(a[0],b[0]);m[1]=
Math.max(a[1],b[1]);m[2]=Math.max(a[2],b[2]);m[3]=Math.max(a[3],b[3]);return m};s.scale=function(m,a,b){m[0]=a[0]*b;m[1]=a[1]*b;m[2]=a[2]*b;m[3]=a[3]*b;return m};s.scaleAndAdd=function(m,a,b,d){m[0]=a[0]+b[0]*d;m[1]=a[1]+b[1]*d;m[2]=a[2]+b[2]*d;m[3]=a[3]+b[3]*d;return m};s.distance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2],k=b[3]-a[3];return Math.sqrt(d*d+c*c+e*e+k*k)};s.dist=s.distance;s.squaredDistance=function(a,b){var d=b[0]-a[0],c=b[1]-a[1],e=b[2]-a[2],k=b[3]-a[3];return d*d+c*c+
e*e+k*k};s.sqrDist=s.squaredDistance;s.length=function(a){var b=a[0],d=a[1],c=a[2];a=a[3];return Math.sqrt(b*b+d*d+c*c+a*a)};s.len=s.length;s.squaredLength=function(a){var b=a[0],d=a[1],c=a[2];a=a[3];return b*b+d*d+c*c+a*a};s.sqrLen=s.squaredLength;s.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};s.normalize=function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],d=d*d+c*c+e*e+k*k;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d);return a};s.dot=function(a,
b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};s.lerp=function(a,b,d,c){var e=b[0],k=b[1],f=b[2];b=b[3];a[0]=e+c*(d[0]-e);a[1]=k+c*(d[1]-k);a[2]=f+c*(d[2]-f);a[3]=b+c*(d[3]-b);return a};s.random=function(a,b){b=b||1;a[0]=d();a[1]=d();a[2]=d();a[3]=d();s.normalize(a,a);s.scale(a,a,b);return a};s.transformMat4=function(a,b,d){var c=b[0],e=b[1],k=b[2];b=b[3];a[0]=d[0]*c+d[4]*e+d[8]*k+d[12]*b;a[1]=d[1]*c+d[5]*e+d[9]*k+d[13]*b;a[2]=d[2]*c+d[6]*e+d[10]*k+d[14]*b;a[3]=d[3]*c+d[7]*e+d[11]*k+d[15]*b;return a};
s.transformQuat=function(a,b,d){var c=b[0],e=b[1],k=b[2];b=d[0];var f=d[1],l=d[2];d=d[3];var n=d*c+f*k-l*e,p=d*e+l*c-b*k,r=d*k+b*e-f*c,c=-b*c-f*e-l*k;a[0]=n*d+c*-b+p*-l-r*-f;a[1]=p*d+c*-f+r*-b-n*-l;a[2]=r*d+c*-l+n*-f-p*-b;return a};s.forEach=function(){var a=s.create();return function(b,d,c,e,k,f){d||(d=4);c||(c=0);for(e=e?Math.min(e*d+c,b.length):b.length;c<e;c+=d)a[0]=b[c],a[1]=b[c+1],a[2]=b[c+2],a[3]=b[c+3],k(a,a,f),b[c]=a[0],b[c+1]=a[1],b[c+2]=a[2],b[c+3]=a[3];return b}}();s.str=function(a){return"vec4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=s);k={create:function(){var a=new f(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},clone:function(a){var b=new f(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(a===b){var d=b[1];a[1]=b[2];a[2]=d}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},invert:function(a,b){var d=
b[0],c=b[1],e=b[2],k=b[3],f=d*k-e*c;if(!f)return null;f=1/f;a[0]=k*f;a[1]=-c*f;a[2]=-e*f;a[3]=d*f;return a},adjoint:function(a,b){var d=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=d;return a},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,d){var c=b[0],e=b[1],k=b[2];b=b[3];var f=d[0],l=d[1],n=d[2];d=d[3];a[0]=c*f+k*l;a[1]=e*f+b*l;a[2]=c*n+k*d;a[3]=e*n+b*d;return a}};k.mul=k.multiply;k.rotate=function(a,b,d){var c=b[0],e=b[1],k=b[2];b=b[3];var f=Math.sin(d);d=Math.cos(d);a[0]=
c*d+k*f;a[1]=e*d+b*f;a[2]=c*-f+k*d;a[3]=e*-f+b*d;return a};k.scale=function(a,b,d){var c=b[1],e=b[2],k=b[3],f=d[0];d=d[1];a[0]=b[0]*f;a[1]=c*f;a[2]=e*d;a[3]=k*d;return a};k.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};k.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};k.LDU=function(a,b,d,c){a[2]=c[2]/c[0];d[0]=c[0];d[1]=c[1];d[3]=c[3]-a[2]*d[1];return[a,b,d]};"undefined"!==typeof a&&(a.mat2=k);k={create:function(){var a=
new f(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},clone:function(a){var b=new f(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},invert:function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=d*k-c*e;if(!n)return null;n=1/n;a[0]=k*n;a[1]=-c*n;a[2]=-e*n;a[3]=d*n;a[4]=(e*l-k*f)*n;a[5]=(c*f-d*l)*n;return a},
determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=b[4];b=b[5];var n=d[0],p=d[1],r=d[2],q=d[3],s=d[4];d=d[5];a[0]=c*n+k*p;a[1]=e*n+f*p;a[2]=c*r+k*q;a[3]=e*r+f*q;a[4]=c*s+k*d+l;a[5]=e*s+f*d+b;return a}};k.mul=k.multiply;k.rotate=function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=b[4];b=b[5];var n=Math.sin(d);d=Math.cos(d);a[0]=c*d+k*n;a[1]=e*d+f*n;a[2]=c*-n+k*d;a[3]=e*-n+f*d;a[4]=l;a[5]=b;return a};k.scale=function(a,b,d){var c=b[1],e=b[2],
k=b[3],f=b[4],l=b[5],n=d[0];d=d[1];a[0]=b[0]*n;a[1]=c*n;a[2]=e*d;a[3]=k*d;a[4]=f;a[5]=l;return a};k.translate=function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=b[4];b=b[5];var n=d[0];d=d[1];a[0]=c;a[1]=e;a[2]=k;a[3]=f;a[4]=c*n+k*d+l;a[5]=e*n+f*d+b;return a};k.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};k.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};"undefined"!==
typeof a&&(a.mat2d=k);var t={create:function(){var a=new f(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new f(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];
return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=d;a[5]=b[7];a[6]=c;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=b[6],p=b[7],r=b[8],q=r*f-l*p,s=-r*k+l*n,t=p*k-f*n,x=d*q+c*s+e*t;if(!x)return null;x=1/x;a[0]=q*x;a[1]=(-r*c+e*p)*
x;a[2]=(l*c-e*f)*x;a[3]=s*x;a[4]=(r*d-e*n)*x;a[5]=(-l*d+e*k)*x;a[6]=t*x;a[7]=(-p*d+c*n)*x;a[8]=(f*d-c*k)*x;return a},adjoint:function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=b[6],p=b[7],r=b[8];a[0]=f*r-l*p;a[1]=e*p-c*r;a[2]=c*l-e*f;a[3]=l*n-k*r;a[4]=d*r-e*n;a[5]=e*k-d*l;a[6]=k*p-f*n;a[7]=c*n-d*p;a[8]=d*f-c*k;return a},determinant:function(a){var b=a[3],d=a[4],c=a[5],e=a[6],k=a[7],f=a[8];return a[0]*(f*d-c*k)+a[1]*(-f*b+c*e)+a[2]*(k*b-d*e)},multiply:function(a,b,d){var c=b[0],e=b[1],k=
b[2],f=b[3],l=b[4],n=b[5],p=b[6],r=b[7];b=b[8];var q=d[0],s=d[1],t=d[2],x=d[3],z=d[4],A=d[5],B=d[6],E=d[7];d=d[8];a[0]=q*c+s*f+t*p;a[1]=q*e+s*l+t*r;a[2]=q*k+s*n+t*b;a[3]=x*c+z*f+A*p;a[4]=x*e+z*l+A*r;a[5]=x*k+z*n+A*b;a[6]=B*c+E*f+d*p;a[7]=B*e+E*l+d*r;a[8]=B*k+E*n+d*b;return a}};t.mul=t.multiply;t.translate=function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=b[4],n=b[5],p=b[6],r=b[7];b=b[8];var q=d[0];d=d[1];a[0]=c;a[1]=e;a[2]=k;a[3]=f;a[4]=l;a[5]=n;a[6]=q*c+d*f+p;a[7]=q*e+d*l+r;a[8]=q*k+d*n+b;return a};
t.rotate=function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=b[4],n=b[5],p=b[6],r=b[7];b=b[8];var q=Math.sin(d);d=Math.cos(d);a[0]=d*c+q*f;a[1]=d*e+q*l;a[2]=d*k+q*n;a[3]=d*f-q*c;a[4]=d*l-q*e;a[5]=d*n-q*k;a[6]=p;a[7]=r;a[8]=b;return a};t.scale=function(a,b,d){var c=d[0];d=d[1];a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=d*b[3];a[4]=d*b[4];a[5]=d*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};t.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};
t.fromQuat=function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=d+d,l=c+c,n=e+e,d=d*f,p=c*f,c=c*l,r=e*f,q=e*l,e=e*n,f=k*f,l=k*l,k=k*n;a[0]=1-c-e;a[3]=p-k;a[6]=r+l;a[1]=p+k;a[4]=1-d-e;a[7]=q-f;a[2]=r-l;a[5]=q+f;a[8]=1-d-c;return a};t.normalFromMat4=function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=b[6],p=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15],E=d*l-c*f,H=d*n-e*f,F=d*p-k*f,I=c*n-e*l,R=c*p-k*l,T=e*p-k*n,U=r*z-q*x,V=r*A-s*x,r=r*B-t*x,W=q*A-s*z,q=q*B-t*z,s=s*B-t*A,t=
E*s-H*q+F*W+I*r-R*V+T*U;if(!t)return null;t=1/t;a[0]=(l*s-n*q+p*W)*t;a[1]=(n*r-f*s-p*V)*t;a[2]=(f*q-l*r+p*U)*t;a[3]=(e*q-c*s-k*W)*t;a[4]=(d*s-e*r+k*V)*t;a[5]=(c*r-d*q-k*U)*t;a[6]=(z*T-A*R+B*I)*t;a[7]=(A*F-x*T-B*H)*t;a[8]=(x*R-z*F+B*E)*t;return a};t.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};t.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],
2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=t);var p={create:function(){var a=new f(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new f(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];
a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(a===b){var d=b[1],c=b[2],e=b[3],k=b[6],f=b[7],l=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=c;a[9]=k;a[11]=b[14];a[12]=e;a[13]=
f;a[14]=l}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},invert:function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=b[6],p=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15],E=d*l-c*f,H=d*n-e*f,F=d*p-k*f,I=c*n-e*l,R=c*p-k*l,T=e*p-k*n,U=r*z-q*x,V=r*A-s*x,W=r*B-t*x,X=q*A-s*z,Y=q*B-t*z,Z=s*B-t*A,S=E*Z-H*Y+F*X+I*W-R*V+T*U;if(!S)return null;
S=1/S;a[0]=(l*Z-n*Y+p*X)*S;a[1]=(e*Y-c*Z-k*X)*S;a[2]=(z*T-A*R+B*I)*S;a[3]=(s*R-q*T-t*I)*S;a[4]=(n*W-f*Z-p*V)*S;a[5]=(d*Z-e*W+k*V)*S;a[6]=(A*F-x*T-B*H)*S;a[7]=(r*T-s*F+t*H)*S;a[8]=(f*Y-l*W+p*U)*S;a[9]=(c*W-d*Y-k*U)*S;a[10]=(x*R-z*F+B*E)*S;a[11]=(q*F-r*R-t*E)*S;a[12]=(l*V-f*X-n*U)*S;a[13]=(d*X-c*V+e*U)*S;a[14]=(z*H-x*I-A*E)*S;a[15]=(r*I-q*H+s*E)*S;return a},adjoint:function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=b[4],l=b[5],n=b[6],p=b[7],r=b[8],q=b[9],s=b[10],t=b[11],x=b[12],z=b[13],A=b[14],B=b[15];
a[0]=l*(s*B-t*A)-q*(n*B-p*A)+z*(n*t-p*s);a[1]=-(c*(s*B-t*A)-q*(e*B-k*A)+z*(e*t-k*s));a[2]=c*(n*B-p*A)-l*(e*B-k*A)+z*(e*p-k*n);a[3]=-(c*(n*t-p*s)-l*(e*t-k*s)+q*(e*p-k*n));a[4]=-(f*(s*B-t*A)-r*(n*B-p*A)+x*(n*t-p*s));a[5]=d*(s*B-t*A)-r*(e*B-k*A)+x*(e*t-k*s);a[6]=-(d*(n*B-p*A)-f*(e*B-k*A)+x*(e*p-k*n));a[7]=d*(n*t-p*s)-f*(e*t-k*s)+r*(e*p-k*n);a[8]=f*(q*B-t*z)-r*(l*B-p*z)+x*(l*t-p*q);a[9]=-(d*(q*B-t*z)-r*(c*B-k*z)+x*(c*t-k*q));a[10]=d*(l*B-p*z)-f*(c*B-k*z)+x*(c*p-k*l);a[11]=-(d*(l*t-p*q)-f*(c*t-k*q)+r*
(c*p-k*l));a[12]=-(f*(q*A-s*z)-r*(l*A-n*z)+x*(l*s-n*q));a[13]=d*(q*A-s*z)-r*(c*A-e*z)+x*(c*s-e*q);a[14]=-(d*(l*A-n*z)-f*(c*A-e*z)+x*(c*n-e*l));a[15]=d*(l*s-n*q)-f*(c*s-e*q)+r*(c*n-e*l);return a},determinant:function(a){var b=a[0],d=a[1],c=a[2],e=a[3],k=a[4],f=a[5],l=a[6],n=a[7],p=a[8],r=a[9],q=a[10],s=a[11],t=a[12],x=a[13],z=a[14];a=a[15];return(b*f-d*k)*(q*a-s*z)-(b*l-c*k)*(r*a-s*x)+(b*n-e*k)*(r*z-q*x)+(d*l-c*f)*(p*a-s*t)-(d*n-e*f)*(p*z-q*t)+(c*n-e*l)*(p*x-r*t)},multiply:function(a,b,d){var c=b[0],
e=b[1],k=b[2],f=b[3],l=b[4],n=b[5],p=b[6],r=b[7],q=b[8],s=b[9],t=b[10],x=b[11],z=b[12],A=b[13],B=b[14];b=b[15];var E=d[0],H=d[1],F=d[2],I=d[3];a[0]=E*c+H*l+F*q+I*z;a[1]=E*e+H*n+F*s+I*A;a[2]=E*k+H*p+F*t+I*B;a[3]=E*f+H*r+F*x+I*b;E=d[4];H=d[5];F=d[6];I=d[7];a[4]=E*c+H*l+F*q+I*z;a[5]=E*e+H*n+F*s+I*A;a[6]=E*k+H*p+F*t+I*B;a[7]=E*f+H*r+F*x+I*b;E=d[8];H=d[9];F=d[10];I=d[11];a[8]=E*c+H*l+F*q+I*z;a[9]=E*e+H*n+F*s+I*A;a[10]=E*k+H*p+F*t+I*B;a[11]=E*f+H*r+F*x+I*b;E=d[12];H=d[13];F=d[14];I=d[15];a[12]=E*c+H*l+
F*q+I*z;a[13]=E*e+H*n+F*s+I*A;a[14]=E*k+H*p+F*t+I*B;a[15]=E*f+H*r+F*x+I*b;return a}};p.mul=p.multiply;p.translate=function(a,b,d){var c=d[0],e=d[1];d=d[2];var k,f,l,n,p,r,q,s,t,x,z,A;b===a?(a[12]=b[0]*c+b[4]*e+b[8]*d+b[12],a[13]=b[1]*c+b[5]*e+b[9]*d+b[13],a[14]=b[2]*c+b[6]*e+b[10]*d+b[14],a[15]=b[3]*c+b[7]*e+b[11]*d+b[15]):(k=b[0],f=b[1],l=b[2],n=b[3],p=b[4],r=b[5],q=b[6],s=b[7],t=b[8],x=b[9],z=b[10],A=b[11],a[0]=k,a[1]=f,a[2]=l,a[3]=n,a[4]=p,a[5]=r,a[6]=q,a[7]=s,a[8]=t,a[9]=x,a[10]=z,a[11]=A,a[12]=
k*c+p*e+t*d+b[12],a[13]=f*c+r*e+x*d+b[13],a[14]=l*c+q*e+z*d+b[14],a[15]=n*c+s*e+A*d+b[15]);return a};p.scale=function(a,b,d){var c=d[0],e=d[1];d=d[2];a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};p.rotate=function(a,d,c,k){var f=k[0],l=k[1];k=k[2];var n=Math.sqrt(f*f+l*l+k*k),p,r,q,s,t,O,P,x,z,A,B,E,H,F,I,R,T,U,V,W;if(Math.abs(n)<b)return null;
n=1/n;f*=n;l*=n;k*=n;p=Math.sin(c);r=Math.cos(c);q=1-r;c=d[0];n=d[1];s=d[2];t=d[3];O=d[4];P=d[5];x=d[6];z=d[7];A=d[8];B=d[9];E=d[10];H=d[11];F=f*f*q+r;I=l*f*q+k*p;R=k*f*q-l*p;T=f*l*q-k*p;U=l*l*q+r;V=k*l*q+f*p;W=f*k*q+l*p;f=l*k*q-f*p;l=k*k*q+r;a[0]=c*F+O*I+A*R;a[1]=n*F+P*I+B*R;a[2]=s*F+x*I+E*R;a[3]=t*F+z*I+H*R;a[4]=c*T+O*U+A*V;a[5]=n*T+P*U+B*V;a[6]=s*T+x*U+E*V;a[7]=t*T+z*U+H*V;a[8]=c*W+O*f+A*l;a[9]=n*W+P*f+B*l;a[10]=s*W+x*f+E*l;a[11]=t*W+z*f+H*l;d!==a&&(a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);
return a};p.rotateX=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[4],k=b[5],f=b[6],l=b[7],n=b[8],p=b[9],q=b[10],r=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=e*d+n*c;a[5]=k*d+p*c;a[6]=f*d+q*c;a[7]=l*d+r*c;a[8]=n*d-e*c;a[9]=p*d-k*c;a[10]=q*d-f*c;a[11]=r*d-l*c;return a};p.rotateY=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[0],k=b[1],f=b[2],l=b[3],n=b[8],p=b[9],q=b[10],r=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],
a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*d-n*c;a[1]=k*d-p*c;a[2]=f*d-q*c;a[3]=l*d-r*c;a[8]=e*c+n*d;a[9]=k*c+p*d;a[10]=f*c+q*d;a[11]=l*c+r*d;return a};p.rotateZ=function(a,b,d){var c=Math.sin(d);d=Math.cos(d);var e=b[0],k=b[1],f=b[2],l=b[3],n=b[4],p=b[5],q=b[6],r=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=e*d+n*c;a[1]=k*d+p*c;a[2]=f*d+q*c;a[3]=l*d+r*c;a[4]=n*d-e*c;a[5]=p*d-k*c;a[6]=q*d-f*c;a[7]=r*d-l*c;return a};
p.fromRotationTranslation=function(a,b,d){var c=b[0],e=b[1],k=b[2],f=b[3],l=c+c,n=e+e,p=k+k;b=c*l;var q=c*n,c=c*p,r=e*n,e=e*p,k=k*p,l=f*l,n=f*n,f=f*p;a[0]=1-(r+k);a[1]=q+f;a[2]=c-n;a[3]=0;a[4]=q-f;a[5]=1-(b+k);a[6]=e+l;a[7]=0;a[8]=c+n;a[9]=e-l;a[10]=1-(b+r);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};p.fromQuat=function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=d+d,l=c+c,n=e+e,d=d*f,p=c*f,c=c*l,q=e*f,r=e*l,e=e*n,f=k*f,l=k*l,k=k*n;a[0]=1-c-e;a[1]=p+k;a[2]=q-l;a[3]=0;a[4]=p-k;a[5]=1-d-e;
a[6]=r+f;a[7]=0;a[8]=q+l;a[9]=r-f;a[10]=1-d-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};p.frustum=function(a,b,d,c,e,k,f){var l=1/(d-b),n=1/(e-c),p=1/(k-f);a[0]=2*k*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*n;a[6]=0;a[7]=0;a[8]=(d+b)*l;a[9]=(e+c)*n;a[10]=(f+k)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*(f*k)*p;a[15]=0;return a};p.perspective=function(a,b,d,c,e){b=1/Math.tan(b/2);var k=1/(c-e);a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+c)*k;a[11]=-1;a[12]=0;a[13]=
0;a[14]=2*e*c*k;a[15]=0;return a};p.ortho=function(a,b,d,c,e,k,f){var l=1/(b-d),n=1/(c-e),p=1/(k-f);a[0]=-2*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*n;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(b+d)*l;a[13]=(e+c)*n;a[14]=(f+k)*p;a[15]=1;return a};p.lookAt=function(a,d,c,k){var f,l,n,q,r,s,t,C,O=d[0],P=d[1];d=d[2];n=k[0];q=k[1];l=k[2];t=c[0];k=c[1];f=c[2];if(Math.abs(O-t)<b&&Math.abs(P-k)<b&&Math.abs(d-f)<b)return p.identity(a);c=O-t;k=P-k;t=d-f;C=1/Math.sqrt(c*c+k*k+t*t);c*=C;k*=C;t*=C;f=q*
t-l*k;l=l*c-n*t;n=n*k-q*c;(C=Math.sqrt(f*f+l*l+n*n))?(C=1/C,f*=C,l*=C,n*=C):n=l=f=0;q=k*n-t*l;r=t*f-c*n;s=c*l-k*f;(C=Math.sqrt(q*q+r*r+s*s))?(C=1/C,q*=C,r*=C,s*=C):s=r=q=0;a[0]=f;a[1]=q;a[2]=c;a[3]=0;a[4]=l;a[5]=r;a[6]=k;a[7]=0;a[8]=n;a[9]=s;a[10]=t;a[11]=0;a[12]=-(f*O+l*P+n*d);a[13]=-(q*O+r*P+s*d);a[14]=-(c*O+k*P+t*d);a[15]=1;return a};p.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+
a[13]+", "+a[14]+", "+a[15]+")"};p.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=p);var r={create:function(){var a=new f(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};r.rotationTo=function(){var a=
q.create(),b=q.fromValues(1,0,0),d=q.fromValues(0,1,0);return function(c,e,k){var f=q.dot(e,k);if(-0.999999>f)return q.cross(a,b,e),1E-6>q.length(a)&&q.cross(a,d,e),q.normalize(a,a),r.setAxisAngle(c,a,Math.PI),c;if(0.999999<f)return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c;q.cross(a,e,k);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=1+f;return r.normalize(c,c)}}();r.setAxes=function(){var a=t.create();return function(b,d,c,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-d[0];a[5]=-d[1];a[8]=-d[2];
return r.normalize(b,r.fromMat3(b,a))}}();r.clone=s.clone;r.fromValues=s.fromValues;r.copy=s.copy;r.set=s.set;r.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};r.setAxisAngle=function(a,b,d){d*=0.5;var c=Math.sin(d);a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=Math.cos(d);return a};r.add=s.add;r.multiply=function(a,b,d){var c=b[0],e=b[1],k=b[2];b=b[3];var f=d[0],l=d[1],n=d[2];d=d[3];a[0]=c*d+b*f+e*n-k*l;a[1]=e*d+b*l+k*f-c*n;a[2]=k*d+b*n+c*l-e*f;a[3]=b*d-c*f-e*l-k*n;return a};r.mul=r.multiply;
r.scale=s.scale;r.rotateX=function(a,b,d){d*=0.5;var c=b[0],e=b[1],k=b[2];b=b[3];var f=Math.sin(d);d=Math.cos(d);a[0]=c*d+b*f;a[1]=e*d+k*f;a[2]=k*d-e*f;a[3]=b*d-c*f;return a};r.rotateY=function(a,b,d){d*=0.5;var c=b[0],e=b[1],k=b[2];b=b[3];var f=Math.sin(d);d=Math.cos(d);a[0]=c*d-k*f;a[1]=e*d+b*f;a[2]=k*d+c*f;a[3]=b*d-e*f;return a};r.rotateZ=function(a,b,d){d*=0.5;var c=b[0],e=b[1],k=b[2];b=b[3];var f=Math.sin(d);d=Math.cos(d);a[0]=c*d+e*f;a[1]=e*d-c*f;a[2]=k*d+b*f;a[3]=b*d-k*f;return a};r.calculateW=
function(a,b){var d=b[0],c=b[1],e=b[2];a[0]=d;a[1]=c;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-d*d-c*c-e*e));return a};r.dot=s.dot;r.lerp=s.lerp;r.slerp=function(a,b,d,c){var e=b[0],k=b[1],f=b[2];b=b[3];var l=d[0],n=d[1],p=d[2];d=d[3];var q,r,s;r=e*l+k*n+f*p+b*d;0>r&&(r=-r,l=-l,n=-n,p=-p,d=-d);1E-6<1-r?(q=Math.acos(r),s=Math.sin(q),r=Math.sin((1-c)*q)/s,c=Math.sin(c*q)/s):r=1-c;a[0]=r*e+c*l;a[1]=r*k+c*n;a[2]=r*f+c*p;a[3]=r*b+c*d;return a};r.invert=function(a,b){var d=b[0],c=b[1],e=b[2],k=b[3],f=d*d+c*c+e*
e+k*k,f=f?1/f:0;a[0]=-d*f;a[1]=-c*f;a[2]=-e*f;a[3]=k*f;return a};r.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};r.length=s.length;r.len=r.length;r.squaredLength=s.squaredLength;r.sqrLen=r.squaredLength;r.normalize=s.normalize;r.fromMat3=function(a,b){var d=b[0]+b[4]+b[8];if(0<d)d=Math.sqrt(d+1),a[3]=0.5*d,d=0.5/d,a[0]=(b[7]-b[5])*d,a[1]=(b[2]-b[6])*d,a[2]=(b[3]-b[1])*d;else{var c=0;b[4]>b[0]&&(c=1);b[8]>b[3*c+c]&&(c=2);var e=(c+1)%3,k=(c+2)%3,d=Math.sqrt(b[3*c+c]-b[3*
e+e]-b[3*k+k]+1);a[c]=0.5*d;d=0.5/d;a[3]=(b[3*k+e]-b[3*e+k])*d;a[e]=(b[3*e+c]+b[3*c+e])*d;a[k]=(b[3*k+c]+b[3*c+k])*d}return a};r.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=r)})(b)})(this);
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.poly2tri=a()}}(function(){return function b(c,e,f){function d(l,n){if(!e[l]){if(!c[l]){var s="function"==typeof require&&require;if(!n&&s)return s(l,!0);if(k)return k(l,!0);throw Error("Cannot find module '"+l+"'");}s=e[l]={exports:{}};c[l][0].call(s.exports,function(b){var e=
c[l][1][b];return d(e?e:b)},s,s.exports,b,c,e,f)}return e[l].exports}for(var k="function"==typeof require&&require,n=0;n<f.length;n++)d(f[n]);return d}({1:[function(b,c,e){c.exports={version:"1.3.5"}},{}],2:[function(b,c,e){b=function(b,d){this.head_=b;this.tail_=d;this.search_node_=b};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.search=function(){return this.search_node_};
b.prototype.setSearch=function(b){this.search_node_=b};b.prototype.findSearchNode=function(){return this.search_node_};b.prototype.locateNode=function(b){var d=this.search_node_;if(b<d.value)for(;d=d.prev;){if(b>=d.value)return this.search_node_=d}else for(;d=d.next;)if(b<d.value)return this.search_node_=d.prev;return null};b.prototype.locatePoint=function(b){var d=b.x,c=this.findSearchNode(d),e=c.point.x;if(d===e){if(b!==c.point)if(b===c.prev.point)c=c.prev;else if(b===c.next.point)c=c.next;else throw Error("poly2tri Invalid AdvancingFront.locatePoint() call");
}else if(d<e)for(;(c=c.prev)&&b!==c.point;);else for(;(c=c.next)&&b!==c.point;);c&&(this.search_node_=c);return c};c.exports=b;c.exports.Node=function(b,d){this.point=b;this.triangle=d||null;this.prev=this.next=null;this.value=b.x}},{}],3:[function(b,c,e){c.exports=function(b,d){if(!b)throw Error(d||"Assert Failed");}},{}],4:[function(b,c,e){var f=b("./xy"),d=function(b,d){this.x=+b||0;this.y=+d||0;this._p2t_edge_list=null};d.prototype.toString=function(){return f.toStringBase(this)};d.prototype.toJSON=
function(){return{x:this.x,y:this.y}};d.prototype.clone=function(){return new d(this.x,this.y)};d.prototype.set_zero=function(){this.y=this.x=0;return this};d.prototype.set=function(b,d){this.x=+b||0;this.y=+d||0;return this};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};d.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};d.prototype.sub=function(b){this.x-=b.x;this.y-=b.y;return this};d.prototype.mul=function(b){this.x*=b;this.y*=b;return this};d.prototype.length=
function(){return Math.sqrt(this.x*this.x+this.y*this.y)};d.prototype.normalize=function(){var b=this.length();this.x/=b;this.y/=b;return b};d.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};d.negate=function(b){return new d(-b.x,-b.y)};d.add=function(b,c){return new d(b.x+c.x,b.y+c.y)};d.sub=function(b,c){return new d(b.x-c.x,b.y-c.y)};d.mul=function(b,c){return new d(b*c.x,b*c.y)};d.cross=function(b,c){return"number"===typeof b?"number"===typeof c?b*c:new d(-b*c.y,b*c.x):"number"===
typeof c?new d(c*b.y,-c*b.x):b.x*c.y-b.y*c.x};d.toString=f.toString;d.compare=f.compare;d.cmp=f.compare;d.equals=f.equals;d.dot=function(b,d){return b.x*d.x+b.y*d.y};c.exports=d},{"./xy":11}],5:[function(b,c,e){var f=b("./xy");b=function(b,c){this.name="PointError";this.points=c=c||[];this.message=b||"Invalid Points!";for(var e=0;e<c.length;e++)this.message+=" "+f.toString(c[e])};b.prototype=Error();b.prototype.constructor=b;c.exports=b},{"./xy":11}],6:[function(b,c,e){(function(c){var d=c.poly2tri;
e.noConflict=function(){c.poly2tri=d;return e};e.VERSION=b("../dist/version.json").version;e.PointError=b("./pointerror");e.Point=b("./point");e.Triangle=b("./triangle");e.SweepContext=b("./sweepcontext");var k=b("./sweep");e.triangulate=k.triangulate;e.sweep={Triangulate:k.triangulate}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(b,c,e){function f(b,
c,e,k,l){if(!d(k,c,e)){var n=k.pointCCW(l),m=C(e,n,c);if(m===K.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[e,n,c]);var n=k.pointCW(l),p=C(e,n,c);if(p===K.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[e,n,c]);m===p?(k=m===K.CW?k.neighborCCW(l):k.neighborCW(l),f(b,c,e,k,l)):v(b,c,e,k,l)}}function d(b,d,c){var e=b.edgeIndex(d,c);return-1!==e?(b.markConstrainedEdgeByIndex(e),(b=b.getNeighbor(e))&&b.markConstrainedEdgeByPoints(d,c),!0):!1}function k(b,
d){var c=new Q(d.prev.point,d.point,d.next.point);c.markNeighbor(d.prev.triangle);c.markNeighbor(d.triangle);b.addToMap(c);d.prev.next=d.next;d.next.prev=d.prev;n(b,c)||b.mapTriangleToNodes(c)}function n(b,d){for(var c=0;3>c;++c)if(!d.delaunay_edge[c]){var e=d.getNeighbor(c);if(e){var k=d.getPoint(c),f=e.oppositePoint(d,k),m=e.index(f);if(e.constrained_edge[m]||e.delaunay_edge[m])d.constrained_edge[c]=e.constrained_edge[m];else{var p;var r=d.pointCCW(k),q=d.pointCW(k);p=k.x-f.x;var s=k.y-f.y,t=r.x-
f.x,r=r.y-f.y,u=p*r-t*s;if(0>=u)p=!1;else{var v=q.x-f.x,q=q.y-f.y,C=v*s-p*q;p=0>=C?!1:0<(p*p+s*s)*(t*q-v*r)+(t*t+r*r)*C+(v*v+q*q)*u}if(p)return d.delaunay_edge[c]=!0,e.delaunay_edge[m]=!0,l(d,k,e,f),(k=!n(b,d))&&b.mapTriangleToNodes(d),(k=!n(b,e))&&b.mapTriangleToNodes(e),d.delaunay_edge[c]=!1,e.delaunay_edge[m]=!1,!0}}}return!1}function l(b,d,c,e){var k,f,l,n;k=b.neighborCCW(d);f=b.neighborCW(d);l=c.neighborCCW(e);n=c.neighborCW(e);var m,p,r,q;m=b.getConstrainedEdgeCCW(d);p=b.getConstrainedEdgeCW(d);
r=c.getConstrainedEdgeCCW(e);q=c.getConstrainedEdgeCW(e);var s,t,u,v;s=b.getDelaunayEdgeCCW(d);t=b.getDelaunayEdgeCW(d);u=c.getDelaunayEdgeCCW(e);v=c.getDelaunayEdgeCW(e);b.legalize(d,e);c.legalize(e,d);c.setDelaunayEdgeCCW(d,s);b.setDelaunayEdgeCW(d,t);b.setDelaunayEdgeCCW(e,u);c.setDelaunayEdgeCW(e,v);c.setConstrainedEdgeCCW(d,m);b.setConstrainedEdgeCW(d,p);b.setConstrainedEdgeCCW(e,r);c.setConstrainedEdgeCW(e,q);b.clearNeighbors();c.clearNeighbors();k&&c.markNeighbor(k);f&&b.markNeighbor(f);l&&
b.markNeighbor(l);n&&c.markNeighbor(n);b.markNeighbor(c)}function q(b,d){var c;c=b.basin.width>(b.basin.left_highest?b.basin.left_node.point.y-d.point.y:b.basin.right_node.point.y-d.point.y)?!0:!1;if(!c&&(k(b,d),d.prev!==b.basin.left_node||d.next!==b.basin.right_node)){if(d.prev===b.basin.left_node){c=C(d.point,d.next.point,d.next.next.point);if(c===K.CW)return;d=d.next}else if(d.next===b.basin.right_node){c=C(d.point,d.prev.point,d.prev.prev.point);if(c===K.CCW)return;d=d.prev}else d=d.prev.point.y<
d.next.point.y?d.prev:d.next;q(b,d)}}function s(b,d,c){c.point.x<d.p.x&&(C(c.point,c.next.point,c.next.next.point)===K.CCW?t(b,d,c):(p(b,d,c),s(b,d,c)))}function t(b,d,c){k(b,c.next);c.next.point!==d.p&&(C(d.q,c.next.point,d.p)===K.CCW&&C(c.point,c.next.point,c.next.next.point)===K.CCW)&&t(b,d,c)}function p(b,d,c){C(c.next.point,c.next.next.point,c.next.next.next.point)===K.CCW?t(b,d,c.next):C(d.q,c.next.next.point,d.p)===K.CCW&&p(b,d,c.next)}function r(b,d,c){c.point.x>d.p.x&&(C(c.point,c.prev.point,
c.prev.prev.point)===K.CW?u(b,d,c):(m(b,d,c),r(b,d,c)))}function m(b,d,c){C(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===K.CW?u(b,d,c.prev):C(d.q,c.prev.prev.point,d.p)===K.CW&&m(b,d,c.prev)}function u(b,d,c){k(b,c.prev);c.prev.point!==d.p&&(C(d.q,c.prev.point,d.p)===K.CW&&C(c.point,c.prev.point,c.prev.prev.point)===K.CW)&&u(b,d,c)}function v(b,d,c,e,k){var m=e.neighborAcross(k);M(m,"FLIP failed due to missing triangle!");var p=m.oppositePoint(e,k);if(e.getConstrainedEdgeAcross(k))throw b=
e.index(k),new y("poly2tri Intersecting Constraints",[k,p,e.getPoint((b+1)%3),e.getPoint((b+2)%3)]);if(O(k,e.pointCCW(k),e.pointCW(k),p))if(l(e,k,m,p),b.mapTriangleToNodes(e),b.mapTriangleToNodes(m),k===c&&p===d)c===b.edge_event.constrained_edge.q&&d===b.edge_event.constrained_edge.p&&(e.markConstrainedEdgeByPoints(d,c),m.markConstrainedEdgeByPoints(d,c),n(b,e),n(b,m));else{var r=C(c,p,d);r===K.CCW?(p=m.edgeIndex(k,p),m.delaunay_edge[p]=!0,n(b,m),m.clearDelaunayEdges()):(p=e.edgeIndex(k,p),e.delaunay_edge[p]=
!0,n(b,e),e.clearDelaunayEdges(),e=m);v(b,d,c,e,k)}else p=L(d,c,m,p),D(b,d,c,e,m,p),f(b,d,c,e,k)}function L(b,d,c,e){var k=C(d,e,b);if(k===K.CW)return c.pointCCW(e);if(k===K.CCW)return c.pointCW(e);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[d,e,b]);}function D(b,d,c,e,k,f){var l=k.neighborAcross(f);M(l,"FLIP failed due to missing triangle");k=l.oppositePoint(k,f);O(c,e.pointCCW(c),e.pointCW(c),k)?v(b,c,k,l,k):(k=L(d,c,l,k),D(b,d,c,e,l,k))}var M=b("./assert"),
y=b("./pointerror"),Q=b("./triangle"),N=b("./advancingfront").Node;b=b("./utils");var J=b.EPSILON,K=b.Orientation,C=b.orient2d,O=b.inScanArea,P=b.isAngleObtuse;e.triangulate=function(b){b.initTriangulation();b.createAdvancingFront();var c,e=b.pointCount();for(c=1;c<e;++c){var l=b.getPoint(c),m;m=b;var p=l,t=m.locateNode(p),u;u=m;var v=p,y=t,D=new Q(v,y.point,y.next.point);D.markNeighbor(y.triangle);u.addToMap(D);v=new N(v);v.next=y.next;v.prev=y;y.next.prev=v;y.next=v;n(u,D)||u.mapTriangleToNodes(D);
u=v;p.x<=t.point.x+J&&k(m,t);p=u;for(t=p.next;t.next&&!P(t.point,t.next.point,t.prev.point);)k(m,t),t=t.next;for(t=p.prev;t.prev&&!P(t.point,t.next.point,t.prev.point);)k(m,t),t=t.prev;if(p.next&&p.next.next&&(t=p.point.x-p.next.next.point.x,y=p.point.y-p.next.next.point.y,M(0<=y,"unordered y"),0<=t||Math.abs(t)<y)){C(p.point,p.next.point,p.next.next.point)===K.CCW?m.basin.left_node=p.next.next:m.basin.left_node=p.next;for(m.basin.bottom_node=m.basin.left_node;m.basin.bottom_node.next&&m.basin.bottom_node.point.y>=
m.basin.bottom_node.next.point.y;)m.basin.bottom_node=m.basin.bottom_node.next;if(m.basin.bottom_node!==m.basin.left_node){for(m.basin.right_node=m.basin.bottom_node;m.basin.right_node.next&&m.basin.right_node.point.y<m.basin.right_node.next.point.y;)m.basin.right_node=m.basin.right_node.next;m.basin.right_node!==m.basin.bottom_node&&(m.basin.width=m.basin.right_node.point.x-m.basin.left_node.point.x,m.basin.left_highest=m.basin.left_node.point.y>m.basin.right_node.point.y,q(m,m.basin.bottom_node))}}m=
u;l=l._p2t_edge_list;for(p=0;l&&p<l.length;++p)if(t=b,u=l[p],y=m,t.edge_event.constrained_edge=u,t.edge_event.right=u.p.x>u.q.x,!d(y.triangle,u.p,u.q)){var D=t,v=u,L=y;if(D.edge_event.right)for(;L.next.point.x<v.p.x;)C(v.q,L.next.point,v.p)===K.CCW?s(D,v,L):L=L.next;else for(;L.prev.point.x>v.p.x;)C(v.q,L.prev.point,v.p)===K.CW?r(D,v,L):L=L.prev;f(t,u.p,u.q,y.triangle,u.q)}}c=b.front().head().next.triangle;for(e=b.front().head().next.point;!c.getConstrainedEdgeCW(e);)c=c.neighborCCW(e);b.meshClean(c)}},
{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(b,c,e){var f=b("./pointerror"),d=b("./point"),k=b("./triangle"),n=b("./sweep"),l=b("./advancingfront"),q=l.Node,s=function(b,d){this.p=b;this.q=d;if(b.y>d.y)this.q=b,this.p=d;else if(b.y===d.y)if(b.x>d.x)this.q=b,this.p=d;else if(b.x===d.x)throw new f("poly2tri Invalid Edge constructor: repeated points!",[b]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)},t=function(){this.right_node=
this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};t.prototype.clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};var p=function(){this.constrained_edge=null;this.right=!1};b=function(b,d){d=d||{};this.triangles_=[];this.map_=[];this.points_=d.cloneArrays?b.slice(0):b;this.edge_list=[];this.af_tail_=this.af_middle_=this.af_head_=this.tail_=this.head_=this.front_=this.pmin_=this.pmax_=null;this.basin=new t;this.edge_event=new p;
this.initEdges(this.points_)};b.prototype.addHole=function(b){this.initEdges(b);var d,c=b.length;for(d=0;d<c;d++)this.points_.push(b[d]);return this};b.prototype.AddHole=b.prototype.addHole;b.prototype.addHoles=function(b){var d,c=b.length;for(d=0;d<c;d++)this.initEdges(b[d]);this.points_=this.points_.concat.apply(this.points_,b);return this};b.prototype.addPoint=function(b){this.points_.push(b);return this};b.prototype.AddPoint=b.prototype.addPoint;b.prototype.addPoints=function(b){this.points_=
this.points_.concat(b);return this};b.prototype.triangulate=function(){n.triangulate(this);return this};b.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};b.prototype.getTriangles=function(){return this.triangles_};b.prototype.GetTriangles=b.prototype.getTriangles;b.prototype.front=function(){return this.front_};b.prototype.pointCount=function(){return this.points_.length};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=
function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.getMap=function(){return this.map_};b.prototype.initTriangulation=function(){var b=this.points_[0].x,c=this.points_[0].x,e=this.points_[0].y,k=this.points_[0].y,f,l=this.points_.length;for(f=1;f<l;f++){var n=this.points_[f];n.x>b&&(b=n.x);n.x<c&&(c=n.x);n.y>e&&(e=n.y);n.y<k&&(k=n.y)}this.pmin_=new d(c,k);this.pmax_=new d(b,e);f=0.3*(b-c);e=0.3*(e-k);this.head_=new d(b+f,k-e);this.tail_=new d(c-f,k-e);this.points_.sort(d.compare)};
b.prototype.initEdges=function(b){var d,c=b.length;for(d=0;d<c;++d)this.edge_list.push(new s(b[d],b[(d+1)%c]))};b.prototype.getPoint=function(b){return this.points_[b]};b.prototype.addToMap=function(b){this.map_.push(b)};b.prototype.locateNode=function(b){return this.front_.locateNode(b.x)};b.prototype.createAdvancingFront=function(){var b,d,c;c=new k(this.points_[0],this.tail_,this.head_);this.map_.push(c);b=new q(c.getPoint(1),c);d=new q(c.getPoint(0),c);c=new q(c.getPoint(2));this.front_=new l(b,
c);b.next=d;d.next=c;d.prev=b;c.prev=d};b.prototype.removeNode=function(b){};b.prototype.mapTriangleToNodes=function(b){for(var d=0;3>d;++d)if(!b.getNeighbor(d)){var c=this.front_.locatePoint(b.pointCW(b.getPoint(d)));c&&(c.triangle=b)}};b.prototype.removeFromMap=function(b){var d,c=this.map_,e=c.length;for(d=0;d<e;d++)if(c[d]===b){c.splice(d,1);break}};b.prototype.meshClean=function(b){b=[b];for(var d,c;d=b.pop();)if(!d.isInterior())for(d.setInterior(!0),this.triangles_.push(d),c=0;3>c;c++)d.constrained_edge[c]||
b.push(d.getNeighbor(c))};c.exports=b},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(b,c,e){e=function(b,c,e){this.points_=[b,c,e];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]};var f=b("./xy").toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"};e.prototype.getPoint=function(b){return this.points_[b]};e.prototype.GetPoint=e.prototype.getPoint;
e.prototype.getPoints=function(){return this.points_};e.prototype.getNeighbor=function(b){return this.neighbors_[b]};e.prototype.containsPoint=function(b){var c=this.points_;return b===c[0]||b===c[1]||b===c[2]};e.prototype.containsEdge=function(b){return this.containsPoint(b.p)&&this.containsPoint(b.q)};e.prototype.containsPoints=function(b,c){return this.containsPoint(b)&&this.containsPoint(c)};e.prototype.isInterior=function(){return this.interior_};e.prototype.setInterior=function(b){this.interior_=
b;return this};e.prototype.markNeighborPointers=function(b,c,e){var f=this.points_;if(b===f[2]&&c===f[1]||b===f[1]&&c===f[2])this.neighbors_[0]=e;else if(b===f[0]&&c===f[2]||b===f[2]&&c===f[0])this.neighbors_[1]=e;else if(b===f[0]&&c===f[1]||b===f[1]&&c===f[0])this.neighbors_[2]=e;else throw Error("poly2tri Invalid Triangle.markNeighborPointers() call");};e.prototype.markNeighbor=function(b){var c=this.points_;b.containsPoints(c[1],c[2])?(this.neighbors_[0]=b,b.markNeighborPointers(c[1],c[2],this)):
b.containsPoints(c[0],c[2])?(this.neighbors_[1]=b,b.markNeighborPointers(c[0],c[2],this)):b.containsPoints(c[0],c[1])&&(this.neighbors_[2]=b,b.markNeighborPointers(c[0],c[1],this))};e.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};e.prototype.pointCW=function(b){var c=this.points_;return b===c[0]?c[2]:b===c[1]?c[0]:b===
c[2]?c[1]:null};e.prototype.pointCCW=function(b){var c=this.points_;return b===c[0]?c[1]:b===c[1]?c[2]:b===c[2]?c[0]:null};e.prototype.neighborCW=function(b){return b===this.points_[0]?this.neighbors_[1]:b===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};e.prototype.neighborCCW=function(b){return b===this.points_[0]?this.neighbors_[2]:b===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};e.prototype.getConstrainedEdgeCW=function(b){return b===this.points_[0]?this.constrained_edge[1]:
b===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};e.prototype.getConstrainedEdgeCCW=function(b){return b===this.points_[0]?this.constrained_edge[2]:b===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};e.prototype.getConstrainedEdgeAcross=function(b){return b===this.points_[0]?this.constrained_edge[0]:b===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};e.prototype.setConstrainedEdgeCW=function(b,c){b===this.points_[0]?this.constrained_edge[1]=
c:b===this.points_[1]?this.constrained_edge[2]=c:this.constrained_edge[0]=c};e.prototype.setConstrainedEdgeCCW=function(b,c){b===this.points_[0]?this.constrained_edge[2]=c:b===this.points_[1]?this.constrained_edge[0]=c:this.constrained_edge[1]=c};e.prototype.getDelaunayEdgeCW=function(b){return b===this.points_[0]?this.delaunay_edge[1]:b===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};e.prototype.getDelaunayEdgeCCW=function(b){return b===this.points_[0]?this.delaunay_edge[2]:b===this.points_[1]?
this.delaunay_edge[0]:this.delaunay_edge[1]};e.prototype.setDelaunayEdgeCW=function(b,c){b===this.points_[0]?this.delaunay_edge[1]=c:b===this.points_[1]?this.delaunay_edge[2]=c:this.delaunay_edge[0]=c};e.prototype.setDelaunayEdgeCCW=function(b,c){b===this.points_[0]?this.delaunay_edge[2]=c:b===this.points_[1]?this.delaunay_edge[0]=c:this.delaunay_edge[1]=c};e.prototype.neighborAcross=function(b){return b===this.points_[0]?this.neighbors_[0]:b===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};
e.prototype.oppositePoint=function(b,c){var e=b.pointCW(c);return this.pointCW(e)};e.prototype.legalize=function(b,c){var e=this.points_;if(b===e[0])e[1]=e[0],e[0]=e[2],e[2]=c;else if(b===e[1])e[2]=e[1],e[1]=e[0],e[0]=c;else if(b===e[2])e[0]=e[2],e[2]=e[1],e[1]=c;else throw Error("poly2tri Invalid Triangle.legalize() call");};e.prototype.index=function(b){var c=this.points_;if(b===c[0])return 0;if(b===c[1])return 1;if(b===c[2])return 2;throw Error("poly2tri Invalid Triangle.index() call");};e.prototype.edgeIndex=
function(b,c){var e=this.points_;if(b===e[0]){if(c===e[1])return 2;if(c===e[2])return 1}else if(b===e[1]){if(c===e[2])return 0;if(c===e[0])return 2}else if(b===e[2]){if(c===e[0])return 1;if(c===e[1])return 0}return-1};e.prototype.markConstrainedEdgeByIndex=function(b){this.constrained_edge[b]=!0};e.prototype.markConstrainedEdgeByEdge=function(b){this.markConstrainedEdgeByPoints(b.p,b.q)};e.prototype.markConstrainedEdgeByPoints=function(b,c){var e=this.points_;if(c===e[0]&&b===e[1]||c===e[1]&&b===
e[0])this.constrained_edge[2]=!0;else if(c===e[0]&&b===e[2]||c===e[2]&&b===e[0])this.constrained_edge[1]=!0;else if(c===e[1]&&b===e[2]||c===e[2]&&b===e[1])this.constrained_edge[0]=!0};c.exports=e},{"./xy":11}],10:[function(b,c,e){e.EPSILON=1E-12;var f={CW:1,CCW:-1,COLLINEAR:0};e.Orientation=f;e.orient2d=function(b,c,e){b=(b.x-e.x)*(c.y-e.y)-(b.y-e.y)*(c.x-e.x);return-1E-12<b&&1E-12>b?f.COLLINEAR:0<b?f.CCW:f.CW};e.inScanArea=function(b,c,e,f){return-1E-12<=(b.x-c.x)*(f.y-c.y)-(f.x-c.x)*(b.y-c.y)||
1E-12>=(b.x-e.x)*(f.y-e.y)-(f.x-e.x)*(b.y-e.y)?!1:!0};e.isAngleObtuse=function(b,c,e){return 0>(c.x-b.x)*(e.x-b.x)+(c.y-b.y)*(e.y-b.y)}},{}],11:[function(b,c,e){function f(b){return"("+b.x+";"+b.y+")"}c.exports={toString:function(b){var c=b.toString();return"[object Object]"===c?f(b):c},toStringBase:f,compare:function(b,c){return b.y===c.y?b.x-c.x:b.y-c.y},equals:function(b,c){return b.x===c.x&&b.y===c.y}}},{}]},{},[6])(6)});
G.GLShaderUtil={compile:function(a,b,c){if(a)return b=a.createShader(b),a.shaderSource(b,c),a.compileShader(b),!1===a.getShaderParameter(b,a.COMPILE_STATUS)&&console.error("Compile shader error:\n",c),b;console.error("No WebGL context!")},genProgram:function(a,b,c){if(a){var e=a.createProgram();a.attachShader(e,b);a.attachShader(e,c);a.linkProgram(e);a.getProgramParameter(e,a.LINK_STATUS)||(console.error("Link WebGL program error"),a.deleteProgram(e),a.deleteShader(b),a.deleteShader(c));return e}console.error("No WebGL context!")},
TILE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"}(),
TILE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float u_alpha;\nuniform sampler2D u_sampler;\nvarying vec2 v_texcoord;\nvoid main(){\nvec4 v_color = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(v_color.rgb, v_color.a * u_alpha);\n}"}(),PT_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform vec4 u_color;\nuniform vec2 u_shape_size;\nuniform vec2 u_offset;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh + u_offset.y;\n}\nx += u_offset.x;\ny += u_offset.y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\ngl_PointSize = u_shape_size.x;\nv_color = u_color;\n}"}(),
PT_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),LINE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform vec4 u_color;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\n}"}(),
LINE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),FILL_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nattribute vec2 a_pt;\nuniform float u_fill_image;\nuniform vec2 u_image_size;\nuniform float u_alpha;\nuniform vec4 u_color;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\nv_alpha = u_alpha;\nv_fill_image = u_fill_image;\nif( v_fill_image!=0.0 ){\nfloat imageWidth = u_image_size.x;\nfloat imageHeight = u_image_size.y;\nfloat texcoordX = x/imageWidth;\nfloat texcoordY = y/imageHeight;\nv_texcoord = vec2(texcoordX, texcoordY);\n}\n}"}(),
FILL_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nif( v_fill_image!=0.0 ){\nvec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(tex.rgb, tex.a * v_alpha);\n}else{\ngl_FragColor = v_color;\n}\n}"}(),SHAPE_FILL_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nconst float PI_2 = 2.0*3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform int u_shape;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nattribute vec3 a_pt;\nuniform float u_fill_image;\nuniform vec2 u_image_size;\nuniform float u_alpha;\nuniform vec4 u_color;\nuniform vec4 u_color_center;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x/2.0;\nfloat hh_shape = u_size_y/2.0;\nif(u_shape==1){\nif(z!=-1.0){\nfloat theta = PI_2*z;\nx += hw_shape * sin(theta);\ny += hw_shape * cos(theta);\n}\n}else if(u_shape==2){\nif(z==1.0){\nx -= hw_shape;\ny -= hh_shape;\n}else if(z==2.0){\nx += hw_shape;\ny -= hh_shape;\n}else if(z==3.0){\nx += hw_shape;\ny += hh_shape;\n}else if(z==4.0){\nx -= hw_shape;\ny += hh_shape;\n}\n}\nx += u_offset_x;\ny += u_offset_y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nif(u_shape==1){\nif(z!=-1.0){\nv_color = u_color;\n} else {\nv_color = u_color_center;\n}\n}else if(u_shape==2){\nif(z!=0.0){\nv_color = u_color;\n} else {\nv_color = u_color_center;\n}\n}\nv_alpha = u_alpha;\nv_fill_image = u_fill_image;\nif( v_fill_image!=0.0 ){\nfloat imageWidth = u_image_size.x;\nfloat imageHeight = u_image_size.y;\nfloat texcoordX = x/imageWidth;\nfloat texcoordY = y/imageHeight;\nv_texcoord = vec2(texcoordX, texcoordY);\n}\n}"}(),
SHAPE_FILL_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying float v_fill_image;\nvarying vec2 v_texcoord;\nvarying float v_alpha;\nvarying vec4 v_color;\nvoid main(){\nif( v_fill_image!=0.0 ){\nvec4 tex = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\ngl_FragColor = vec4(tex.rgb, tex.a * v_alpha);\n}else{\ngl_FragColor = v_color;\n}\n}"}(),SHAPE_LINE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nconst float PI_2 = 2.0*3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform int u_shape;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nattribute vec3 a_pt;\nuniform vec4 u_color;\nvarying vec4 v_color;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x) /u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y) /u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x / 2.0;\nfloat hh_shape = u_size_y / 2.0;\nif(u_shape==1){\nif(z!=-1.0){\nfloat theta = PI_2*z;\nx += hw_shape * sin(theta);\ny += hw_shape * cos(theta);\n}\n}else if(u_shape==2){\nif(z==1.0){\nx -= hw_shape;\ny -= hh_shape;\n}else if(z==2.0){\nx += hw_shape;\ny -= hh_shape;\n}else if(z==3.0){\nx += hw_shape;\ny += hh_shape;\n}else if(z==4.0){\nx -= hw_shape;\ny += hh_shape;\n}\n}\nx += u_offset_x;\ny += u_offset_y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\nv_color = u_color;\n}"}(),
SHAPE_LINE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 v_color;\nvoid main(){\ngl_FragColor = v_color;\n}"}(),SHAPE_IMAGE_VS:function(){return"const float DEGREE_PER_RADIAN = 180.0/3.14159265358979323846264;\nvoid rotate(in vec2 v, in float theta, out vec2 result) {\nfloat c = cos(theta);\nfloat s = sin(theta);\nresult = vec2(c*v.x - s*v.y, s*v.x + c*v.y);\n}\nuniform mat4 u_mv, u_p;\nuniform vec2 u_canvas_offset;\nuniform vec2 u_canvas_scale;\nuniform vec2 u_graphic_offset;\nuniform vec2 u_zoom_around;\nuniform float u_zoom_scale;\nuniform int u_ignore_rotate;\nuniform float u_res;\nuniform vec2 u_center;\nuniform vec2 u_size;\nuniform float u_rotate;\nuniform float u_size_x;\nuniform float u_size_y;\nuniform float u_offset_x;\nuniform float u_offset_y;\nuniform float u_image_rotate;\nuniform float u_texture_size;\nattribute vec3 a_pt;\nvarying vec2 v_texcoord;\nvoid main(){\nfloat hw = u_size.x/2.0;\nfloat hh = u_size.y/2.0;\nfloat x = hw + (a_pt.x + u_graphic_offset.x - u_center.x)/u_res;\nfloat y = hh - (a_pt.y + u_graphic_offset.y - u_center.y)/u_res;\nfloat z = a_pt.z;\nif( (u_zoom_scale>0.0) && (u_zoom_scale!=1.0) ) {\nfloat zoom_delta = 1.0/u_zoom_scale - 1.0;\nx += (x - u_zoom_around.x)*zoom_delta;\ny += (y - u_zoom_around.y)*zoom_delta;\n}\nfloat dx = x - hw;\nfloat dy = y - hh;\nif( (u_rotate!=0.0) && (dx!=0.0) && (dy!=0.0) && (u_ignore_rotate!=0) ) {\nfloat theta = u_rotate/DEGREE_PER_RADIAN;\nvec2 v;\nrotate(vec2(dx, dy), theta, v);\nx = v.x + hw;\ny = v.y + hh;\n}\nfloat hw_shape = u_size_x/2.0;\nfloat hh_shape = u_size_y/2.0;\nfloat texcoordX = 0.0;\nfloat texcoordY = 0.0;\nfloat vx = u_offset_x;\nfloat vy = u_offset_y;\nif(z==0.0){\nvx += hw_shape;\nvy += hh_shape;\ntexcoordX = hw_shape/u_texture_size;\ntexcoordY = (u_texture_size - hh_shape)/u_texture_size;\n}else if(z==1.0){\ntexcoordY = 1.0;\n}else if(z==2.0){\nvx += u_size_x;\ntexcoordX = u_size_x/u_texture_size;\ntexcoordY = 1.0;\n}else if(z==3.0){\nvx += u_size_x;\nvy += u_size_y;\ntexcoordX = u_size_x/u_texture_size;\ntexcoordY = (u_texture_size - u_size_y)/u_texture_size;\n}else if(z==4.0){\nvy += u_size_y;\ntexcoordY = (u_texture_size - u_size_y)/u_texture_size;\n}\nv_texcoord = vec2(texcoordX, texcoordY);\nfloat ra = u_image_rotate/DEGREE_PER_RADIAN;\nvec2 rv;\nrotate(vec2(vx, vy), ra, rv);\nx += rv.x;\ny += rv.y;\nx += u_canvas_offset.x;\ny += u_canvas_offset.y;\ngl_Position = u_p * u_mv * vec4(x, -y, 0.0, 1.0);\n}"}(),
SHAPE_IMAGE_FS:function(){return"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_sampler;\nvarying vec2 v_texcoord;\nvoid main(){\ngl_FragColor = texture2D(u_sampler, vec2(v_texcoord.s, v_texcoord.t));\n}"}()};
G.GLCamera=G.Class.extend({init:function(){this._pos=vec3.create();this._target=vec3.create();this._up=vec3.fromValues(0,1,0);this._mvMatrix=mat4.create();this._pMatrix=mat4.create()},moveTo:function(a,b,c){vec3.set(this._pos,a,b,c);mat4.lookAt(this._mvMatrix,this._pos,this._target,this._up);return this},lookAt:function(a,b,c){vec3.set(this._target,a,b,c);mat4.lookAt(this._mvMatrix,this._pos,this._target,this._up);return this}});
G.GLOrthoCamera=G.GLCamera.extend({init:function(a,b,c,e,f,d){G.GLCamera.prototype.init.call(this);this.left=a;this.right=b;this.bottom=c;this.top=e;this.near=void 0===f?1:f;this.far=void 0===d?2E8:d;this._updatePMatrix()},_updatePMatrix:function(){mat4.ortho(this._pMatrix,this.left,this.right,this.bottom,this.top,this.near,this.far);return this}});
G.GLDrawUtil={_tileIndices:new Uint16Array([0,1,2,0,2,3]),_tileTextureCoords:new Float32Array([0,1,1,1,1,0,0,0]),_bufferFloat32Array:function(a,b,c,e,f){a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);a.enableVertexAttribArray(e);a.vertexAttribPointer(e,f,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,null)},drawTile:function(a,b,c,e){var f=a._map;if(f){var d=f._gl,k=f._camera,n=f._canvasOffset,l=f.getCenter(),q=f.getSize(),s=a._zoomScale||a._scale,t=a._aroundScreen||[];if(b._loaded&&
(b._gl_t||(a=b._gl_t=d.createTexture(),d.bindTexture(d.TEXTURE_2D,a),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.generateMipmap(d.TEXTURE_2D),d.bindTexture(d.TEXTURE_2D,null)),a=b._gl_t)){var p=d.tileProgram;d.useProgram(p);var r=b._gl_u_mv=
b._gl_u_mv||d.getUniformLocation(p,"u_mv"),m=b._gl_u_p=b._gl_u_p||d.getUniformLocation(p,"u_p"),u=b._gl_u_canvas_offset=b._gl_u_canvas_offset||d.getUniformLocation(p,"u_canvas_offset"),v=b._gl_u_zoom_around=b._gl_u_zoom_around||d.getUniformLocation(p,"u_zoom_around"),L=b._gl_u_zoom_scale=b._gl_u_zoom_scale||d.getUniformLocation(p,"u_zoom_scale"),D=b._gl_u_ignore_rotate=b._gl_u_ignore_rotate||d.getUniformLocation(p,"u_ignore_rotate"),M=b._gl_u_res=b._gl_u_res||d.getUniformLocation(p,"u_res"),y=b._gl_u_center=
b._gl_u_center||d.getUniformLocation(p,"u_center"),Q=b._gl_u_size=b._gl_u_size||d.getUniformLocation(p,"u_size"),N=b._gl_u_rotate=b._gl_u_rotate||d.getUniformLocation(p,"u_rotate"),J=b._gl_a_pt=b._gl_a_pt||d.getAttribLocation(p,"a_pt"),K=b._gl_u_sampler=b._gl_u_sampler||d.getUniformLocation(p,"u_sampler"),C=b._gl_a_texcoord=b._gl_a_texcoord||d.getAttribLocation(p,"a_texcoord"),p=b._gl_u_alpha=b._gl_u_alpha||d.getUniformLocation(p,"u_alpha");d.uniformMatrix4fv(r,!1,k._mvMatrix);d.uniformMatrix4fv(m,
!1,k._pMatrix);d.uniform2f(u,n[0],n[1]);d.uniform2f(v,t[0]||0,t[1]||0);d.uniform1f(L,s||1);d.uniform1i(D,1);d.uniform1f(M,f._res);d.uniform2f(y,l[0],l[1]);d.uniform2f(Q,q[0],q[1]);d.uniform1f(N,f._rotate);d.uniform1f(p,e||1);e=b._gl_vb=b._gl_vb||d.createBuffer();f=b._gl_ib=b._gl_ib||d.createBuffer();b=b._gl_tcb=b._gl_tcb||d.createBuffer();this._bufferFloat32Array(d,e,new Float32Array(c),J,2);this._bufferFloat32Array(d,b,this._tileTextureCoords,C,2);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,
a);d.uniform1i(K,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,f);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this._tileIndices,d.STATIC_DRAW);d.drawElements(d.TRIANGLES,this._tileIndices.length,d.UNSIGNED_SHORT,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);d.bindTexture(d.TEXTURE_2D,null)}}},drawLine:function(a,b,c,e,f,d,k,n){var l=a._layer;k=l._map;if(!(2>a._gl_line_vcount)){d=k._gl;n=k._camera;var q=k._canvasOffset,s=k.getCenter(),t=k.getSize(),p=l._zoomScale||l._scale,r=l._aroundScreen||[],m=d.lineProgram;d.useProgram(m);
var u=a._gl_l_u_mv=a._gl_l_u_mv||d.getUniformLocation(m,"u_mv"),v=a._gl_l_u_p=a._gl_l_u_p||d.getUniformLocation(m,"u_p"),L=a._gl_l_u_canvas_offset=a._gl_l_u_canvas_offset||d.getUniformLocation(m,"u_canvas_offset"),D=a._gl_l_u_graphic_offset=a._gl_l_u_graphic_offset||d.getUniformLocation(m,"u_graphic_offset"),M=a._gl_l_u_zoom_around=a._gl_l_u_zoom_around||d.getUniformLocation(m,"u_zoom_around"),y=a._gl_l_u_zoom_scale=a._gl_l_u_zoom_scale||d.getUniformLocation(m,"u_zoom_scale"),Q=a._gl_l_u_ignore_rotate=
a._gl_l_u_ignore_rotate||d.getUniformLocation(m,"u_ignore_rotate"),N=a._gl_l_u_res=a._gl_l_u_res||d.getUniformLocation(m,"u_res"),J=a._gl_l_u_center=a._gl_l_u_center||d.getUniformLocation(m,"u_center"),K=a._gl_l_u_size=a._gl_l_u_size||d.getUniformLocation(m,"u_size"),C=a._gl_l_u_rotate=a._gl_l_u_rotate||d.getUniformLocation(m,"u_rotate"),l=a._gl_l_a_pt=a._gl_l_a_pt||d.getAttribLocation(m,"a_pt"),m=a._gl_l_u_color=a._gl_l_u_color||d.getUniformLocation(m,"u_color");d.uniformMatrix4fv(u,!1,n._mvMatrix);
d.uniformMatrix4fv(v,!1,n._pMatrix);d.uniform2f(L,q[0],q[1]);d.uniform2f(D,b[0]||0,b[1]||0);d.uniform2f(M,r[0]||0,r[1]||0);d.uniform1f(y,p||1);d.uniform1i(Q,1);d.uniform1f(N,k._res);d.uniform2f(J,s[0],s[1]);d.uniform2f(K,t[0],t[1]);d.uniform1f(C,k._rotate);d.uniform4f(m,c[0]/255,c[1]/255,c[2]/255,e);d.lineWidth(f);b=a._gl_line_vb=a._gl_line_vb||d.createBuffer();this._bufferFloat32Array(d,b,a._gl_line_vs,l,2);d.bindBuffer(d.ARRAY_BUFFER,b);e=b=0;for(f=a._gl_line_vcounts.length;e<f;e++)c=a._gl_line_vcounts[e],
1<c&&d.drawArrays(d.LINE_STRIP,b,c),b+=c;d.bindBuffer(d.ARRAY_BUFFER,null)}},drawFill:function(a,b,c,e,f,d){var k=a._layer,n=k._map;if(!(3>a._gl_fill_vcount)){var l=n._gl,q=n._camera,s=n._canvasOffset,t=n.getCenter(),p=n.getSize(),r=k._zoomScale||k._scale,m=k._aroundScreen||[],u=l.fillProgram;l.useProgram(u);var v=a._gl_f_u_mv=a._gl_f_u_mv||l.getUniformLocation(u,"u_mv"),L=a._gl_f_u_p=a._gl_f_u_p||l.getUniformLocation(u,"u_p"),D=a._gl_f_u_canvas_offset=a._gl_f_u_canvas_offset||l.getUniformLocation(u,
"u_canvas_offset"),M=a._gl_f_u_graphic_offset=a._gl_f_u_graphic_offset||l.getUniformLocation(u,"u_graphic_offset"),y=a._gl_f_u_zoom_around=a._gl_f_u_zoom_around||l.getUniformLocation(u,"u_zoom_around"),Q=a._gl_f_u_zoom_scale=a._gl_f_u_zoom_scale||l.getUniformLocation(u,"u_zoom_scale"),N=a._gl_f_u_ignore_rotate=a._gl_f_u_ignore_rotate||l.getUniformLocation(u,"u_ignore_rotate"),J=a._gl_f_u_res=a._gl_f_u_res||l.getUniformLocation(u,"u_res"),K=a._gl_f_u_center=a._gl_f_u_center||l.getUniformLocation(u,
"u_center"),C=a._gl_f_u_size=a._gl_f_u_size||l.getUniformLocation(u,"u_size"),O=a._gl_f_u_rotate=a._gl_f_u_rotate||l.getUniformLocation(u,"u_rotate"),P=a._gl_f_a_pt=a._gl_f_a_pt||l.getAttribLocation(u,"a_pt"),x=a._gl_f_u_fill_image=a._gl_f_u_fill_image||l.getUniformLocation(u,"u_fill_image"),k=a._gl_f_u_image_size=a._gl_f_u_image_size||l.getUniformLocation(u,"u_image_size"),z=a._gl_f_u_sampler=a._gl_f_u_sampler||l.getUniformLocation(u,"u_sampler");a._gl_f_a_texcoord=a._gl_f_a_texcoord||l.getAttribLocation(u,
"a_texcoord");var A=a._gl_f_u_alpha=a._gl_f_u_alpha||l.getUniformLocation(u,"u_alpha"),u=a._gl_f_u_color=a._gl_f_u_color||l.getUniformLocation(u,"u_color");l.uniformMatrix4fv(v,!1,q._mvMatrix);l.uniformMatrix4fv(L,!1,q._pMatrix);l.uniform2f(D,s[0],s[1]);l.uniform2f(M,b[0]||0,b[1]||0);l.uniform2f(y,m[0]||0,m[1]||0);l.uniform1f(Q,r||1);l.uniform1i(N,1);l.uniform1f(J,n._res);l.uniform2f(K,t[0],t[1]);l.uniform2f(C,p[0],p[1]);l.uniform1f(O,n._rotate);l.uniform1f(x,e?1:0);l.uniform1f(A,d);b=a._gl_fill_vb=
a._gl_fill_vb||l.createBuffer();this._bufferFloat32Array(l,b,a._gl_fill_vs,P,2);if(e)if(l.uniform2f(k,f[0],f[1]),this._ensureImageTexture(e,f,n._textureCtx,l.REPEAT),c=e._gl_t)l.uniform2f(k,f[0],f[1]),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c),l.uniform1i(z,0);else return;else l.uniform4f(u,c[0]/255,c[1]/255,c[2]/255,d);l.bindBuffer(l.ARRAY_BUFFER,b);l.drawArrays(l.TRIANGLES,0,a._gl_fill_vcount);l.bindBuffer(l.ARRAY_BUFFER,null);l.bindTexture(l.TEXTURE_2D,null)}},drawShapeFill:function(a,
b,c,e,f,d,k,n,l,q){var s=a._layer,t=s._map;if(!(3>a._gl_fill_vcount)){var p=t._gl,r=t._camera,m=t._canvasOffset,u=t._canvasScale,v=t.getCenter(),L=t.getSize(),D=s._zoomScale||s._scale,M=s._aroundScreen||[],y=p.shapeFillProgram;p.useProgram(y);var Q=a._gl_sf_u_mv=a._gl_sf_u_mv||p.getUniformLocation(y,"u_mv"),N=a._gl_sf_u_p=a._gl_sf_u_p||p.getUniformLocation(y,"u_p"),J=a._gl_sf_u_canvas_offset=a._gl_sf_u_canvas_offset||p.getUniformLocation(y,"u_canvas_offset"),K=a._gl_sf_u_canvas_scale=a._gl_sf_u_canvas_scale||
p.getUniformLocation(y,"u_canvas_scale"),C=a._gl_sf_u_graphic_offset=a._gl_sf_u_graphic_offset||p.getUniformLocation(y,"u_graphic_offset"),O=a._gl_sf_u_zoom_around=a._gl_sf_u_zoom_around||p.getUniformLocation(y,"u_zoom_around"),P=a._gl_sf_u_zoom_scale=a._gl_sf_u_zoom_scale||p.getUniformLocation(y,"u_zoom_scale"),x=a._gl_sf_u_ignore_rotate=a._gl_sf_u_ignore_rotate||p.getUniformLocation(y,"u_ignore_rotate"),z=a._gl_sf_u_res=a._gl_sf_u_res||p.getUniformLocation(y,"u_res"),A=a._gl_sf_u_center=a._gl_sf_u_center||
p.getUniformLocation(y,"u_center"),B=a._gl_sf_u_size=a._gl_sf_u_size||p.getUniformLocation(y,"u_size"),E=a._gl_sf_u_rotate=a._gl_sf_u_rotate||p.getUniformLocation(y,"u_rotate"),H=a._gl_sf_u_shape=a._gl_sf_u_shape||p.getUniformLocation(y,"u_shape"),F=a._gl_sf_u_size_x=a._gl_sf_u_size_x||p.getUniformLocation(y,"u_size_x"),I=a._gl_sf_u_size_y=a._gl_sf_u_size_y||p.getUniformLocation(y,"u_size_y"),R=a._gl_sf_u_offset_x=a._gl_sf_u_offset_x||p.getUniformLocation(y,"u_offset_x"),T=a._gl_sf_u_offset_y=a._gl_sf_u_offset_y||
p.getUniformLocation(y,"u_offset_y"),U=a._gl_sf_a_pt=a._gl_sf_a_pt||p.getAttribLocation(y,"a_pt"),V=a._gl_sf_u_fill_image=a._gl_sf_u_fill_image||p.getUniformLocation(y,"u_fill_image"),s=a._gl_sf_u_image_size=a._gl_sf_u_image_size||p.getUniformLocation(y,"u_image_size"),W=a._gl_sf_u_sampler=a._gl_sf_u_sampler||p.getUniformLocation(y,"u_sampler");a._gl_sf_a_texcoord=a._gl_sf_a_texcoord||p.getAttribLocation(y,"a_texcoord");var X=a._gl_sf_u_alpha=a._gl_sf_u_alpha||p.getUniformLocation(y,"u_alpha"),Y=
a._gl_sf_u_color=a._gl_sf_u_color||p.getUniformLocation(y,"u_color"),y=a._gl_sf_u_color_center=a._gl_sf_u_color_center||p.getUniformLocation(y,"u_color_center");p.uniformMatrix4fv(Q,!1,r._mvMatrix);p.uniformMatrix4fv(N,!1,r._pMatrix);p.uniform2f(J,m[0],m[1]);p.uniform2f(K,u[0],u[1]);p.uniform2f(C,b[0]||0,b[1]||0);p.uniform2f(O,M[0]||0,M[1]||0);p.uniform1f(P,D||1);p.uniform1i(x,1);p.uniform1f(z,t._res);p.uniform2f(A,v[0],v[1]);p.uniform2f(B,L[0],L[1]);p.uniform1f(E,t._rotate);"circle"==c?p.uniform1i(H,
1):"rect"==c&&p.uniform1i(H,2);p.uniform1f(F,e[0]||0);p.uniform1f(I,e[1]||0);p.uniform1f(R,f[0]||0);p.uniform1f(T,f[1]||0);p.uniform1f(V,k?1:0);p.uniform1f(X,l);b=a._gl_fill_vb=a._gl_fill_vb||p.createBuffer();this._bufferFloat32Array(p,b,a._gl_fill_vs,U,3);if(k)if(this._ensureImageTexture(k,n,t._textureCtx,p.REPEAT),d=k._gl_t)p.uniform2f(s,n[0],n[1]),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,d),p.uniform1i(W,0);else return;else p.uniform4f(Y,d[0]/255,d[1]/255,d[2]/255,l),p.uniform4f(y,
d[0]/255,d[1]/255,d[2]/255,q?1:l);p.bindBuffer(p.ARRAY_BUFFER,b);p.drawArrays(p.TRIANGLES,0,a._gl_fill_vcount);p.bindBuffer(p.ARRAY_BUFFER,null);p.bindTexture(p.TEXTURE_2D,null)}},drawShapeLine:function(a,b,c,e,f,d,k,n,l,q,s){var t=a._layer;q=t._map;if(a._gl_line_vcounts){l=q._gl;s=q._camera;var p=q._canvasOffset,r=q._canvasScale,m=q.getCenter(),u=q.getSize(),v=t._zoomScale||t._scale,L=t._aroundScreen||[],D=l.shapeLineProgram;l.useProgram(D);var M=a._gl_sl_u_mv=a._gl_sl_u_mv||l.getUniformLocation(D,
"u_mv"),y=a._gl_sl_u_p=a._gl_sl_u_p||l.getUniformLocation(D,"u_p"),Q=a._gl_sl_u_canvas_offset=a._gl_sl_u_canvas_offset||l.getUniformLocation(D,"u_canvas_offset"),N=a._gl_sl_u_canvas_scale=a._gl_sl_u_canvas_scale||l.getUniformLocation(D,"u_canvas_scale"),J=a._gl_sl_u_graphic_offset=a._gl_sl_u_graphic_offset||l.getUniformLocation(D,"u_graphic_offset"),K=a._gl_sl_u_zoom_around=a._gl_sl_u_zoom_around||l.getUniformLocation(D,"u_zoom_around"),C=a._gl_sl_u_zoom_scale=a._gl_sl_u_zoom_scale||l.getUniformLocation(D,
"u_zoom_scale"),O=a._gl_sl_u_ignore_rotate=a._gl_sl_u_ignore_rotate||l.getUniformLocation(D,"u_ignore_rotate"),P=a._gl_sl_u_res=a._gl_sl_u_res||l.getUniformLocation(D,"u_res"),x=a._gl_sl_u_center=a._gl_sl_u_center||l.getUniformLocation(D,"u_center"),z=a._gl_sl_u_size=a._gl_sl_u_size||l.getUniformLocation(D,"u_size"),A=a._gl_sl_u_rotate=a._gl_sl_u_rotate||l.getUniformLocation(D,"u_rotate"),B=a._gl_sl_u_shape=a._gl_sl_u_shape||l.getUniformLocation(D,"u_shape"),E=a._gl_sl_u_size_x=a._gl_sl_u_size_x||
l.getUniformLocation(D,"u_size_x"),H=a._gl_sl_u_size_y=a._gl_sl_u_size_y||l.getUniformLocation(D,"u_size_y"),F=a._gl_sl_u_offset_x=a._gl_sl_u_offset_x||l.getUniformLocation(D,"u_offset_x"),I=a._gl_sl_u_offset_y=a._gl_sl_u_offset_y||l.getUniformLocation(D,"u_offset_y"),t=a._gl_sl_a_pt=a._gl_sl_a_pt||l.getAttribLocation(D,"a_pt"),D=a._gl_sl_u_color=a._gl_sl_u_color||l.getUniformLocation(D,"u_color");l.uniformMatrix4fv(M,!1,s._mvMatrix);l.uniformMatrix4fv(y,!1,s._pMatrix);l.uniform2f(Q,p[0],p[1]);l.uniform2f(N,
r[0],r[1]);l.uniform2f(J,b[0]||0,b[1]||0);l.uniform2f(K,L[0]||0,L[1]||0);l.uniform1f(C,v||1);l.uniform1i(O,1);l.uniform1f(P,q._res);l.uniform2f(x,m[0],m[1]);l.uniform2f(z,u[0],u[1]);l.uniform1f(A,q._rotate);"circle"==c?l.uniform1i(B,1):"rect"==c&&l.uniform1i(B,2);l.uniform1f(E,e[0]||0);l.uniform1f(H,e[1]||0);l.uniform1f(F,f[0]||0);l.uniform1f(I,f[1]||0);l.uniform4f(D,d[0]/255,d[1]/255,d[2]/255,k);b=a._gl_line_vb=a._gl_line_vb||l.createBuffer();this._bufferFloat32Array(l,b,a._gl_line_vs,t,3);l.bindBuffer(l.ARRAY_BUFFER,
b);l.lineWidth(n);c=n=0;for(e=a._gl_line_vcounts.length;c<e;c++)b=a._gl_line_vcounts[c],1<b&&l.drawArrays(l.LINE_STRIP,n,b),n+=b;l.bindBuffer(l.ARRAY_BUFFER,null)}},drawShapeImage:function(a,b,c,e,f,d){var k=a._layer,n=k._map;if(12==a._gl_fill_vcount&&c){var l=n._gl,q=n._camera,s=n._canvasOffset,t=n._canvasScale,p=n.getCenter(),r=n.getSize(),m=k._zoomScale||k._scale,k=k._aroundScreen||[],u;if(c._loaded&&(this._ensureImageTexture(c,e,n._textureCtx,l.CLAMP_TO_EDGE),u=c._gl_t)&&(c=c._gl_image_size)){var v=
l.shapeImageProgram;l.useProgram(v);var L=a._gl_si_u_mv=a._gl_si_u_mv||l.getUniformLocation(v,"u_mv"),D=a._gl_si_u_p=a._gl_si_u_p||l.getUniformLocation(v,"u_p"),M=a._gl_si_u_canvas_offset=a._gl_si_u_canvas_offset||l.getUniformLocation(v,"u_canvas_offset"),y=a._gl_si_u_canvas_scale=a._gl_si_u_canvas_scale||l.getUniformLocation(v,"u_canvas_scale"),Q=a._gl_si_u_graphic_offset=a._gl_si_u_graphic_offset||l.getUniformLocation(v,"u_graphic_offset"),N=a._gl_si_u_zoom_around=a._gl_si_u_zoom_around||l.getUniformLocation(v,
"u_zoom_around"),J=a._gl_si_u_zoom_scale=a._gl_si_u_zoom_scale||l.getUniformLocation(v,"u_zoom_scale"),K=a._gl_si_u_ignore_rotate=a._gl_si_u_ignore_rotate||l.getUniformLocation(v,"u_ignore_rotate"),C=a._gl_si_u_res=a._gl_si_u_res||l.getUniformLocation(v,"u_res"),O=a._gl_si_u_center=a._gl_si_u_center||l.getUniformLocation(v,"u_center"),P=a._gl_si_u_size=a._gl_si_u_size||l.getUniformLocation(v,"u_size"),x=a._gl_si_u_rotate=a._gl_si_u_rotate||l.getUniformLocation(v,"u_rotate"),z=a._gl_si_u_size_x=a._gl_si_u_size_x||
l.getUniformLocation(v,"u_size_x"),A=a._gl_si_u_size_y=a._gl_si_u_size_y||l.getUniformLocation(v,"u_size_y"),B=a._gl_si_u_offset_x=a._gl_si_u_offset_x||l.getUniformLocation(v,"u_offset_x"),E=a._gl_si_u_offset_y=a._gl_si_u_offset_y||l.getUniformLocation(v,"u_offset_y"),H=a._gl_si_u_image_rotate=a._gl_si_u_image_rotate||l.getUniformLocation(v,"u_image_rotate"),F=a._gl_si_u_texture_size=a._gl_si_u_texture_size||l.getUniformLocation(v,"u_texture_size"),I=a._gl_si_a_pt=a._gl_si_a_pt||l.getAttribLocation(v,
"a_pt"),R=a._gl_si_u_sampler=a._gl_si_u_sampler||l.getUniformLocation(v,"u_sampler");a._gl_si_a_texcoord=a._gl_si_a_texcoord||l.getAttribLocation(v,"a_texcoord");v=a._gl_fill_vb=a._gl_fill_vb||l.createBuffer();this._bufferFloat32Array(l,v,a._gl_fill_vs,I,3);l.uniformMatrix4fv(L,!1,q._mvMatrix);l.uniformMatrix4fv(D,!1,q._pMatrix);l.uniform2f(M,s[0],s[1]);l.uniform2f(y,t[0],t[1]);l.uniform2f(Q,b[0]||0,b[1]||0);l.uniform2f(N,k[0]||0,k[1]||0);l.uniform1f(J,m||1);l.uniform1i(K,1);l.uniform1f(C,n._res);
l.uniform2f(O,p[0],p[1]);l.uniform2f(P,r[0],r[1]);l.uniform1f(x,n._rotate);l.uniform1f(z,e[0]);l.uniform1f(A,e[1]);l.uniform1f(B,f[0]||0);l.uniform1f(E,f[1]||0);l.uniform1f(H,d||0);l.uniform1f(F,c);l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,u);l.uniform1i(R,0);l.bindBuffer(l.ARRAY_BUFFER,v);l.drawArrays(l.TRIANGLES,0,a._gl_fill_vcount);l.bindBuffer(l.ARRAY_BUFFER,null);l.bindTexture(l.TEXTURE_2D,null)}}},drawShapeText:function(a,b,c,e,f,d,k,n,l,q){var s=a._layer,t=s._map;if(12==a._gl_fill_vcount&&
void 0!=c){var p=t._gl,r=t._camera,m=t._canvasOffset,u=t._canvasScale,v=t.getCenter(),L=t.getSize(),D=s._zoomScale||s._scale,s=s._aroundScreen||[],M,y,Q=e[0],N;e=a._textMeasure;if(!a._gl_image_data||c&&e!=c)M=t._textureCtx,M.save(),M.font=l+" "+Q+"px "+n,M.textBaseline="bottom",e=M.measureText(c),a._textMeasureWidth=e.width,a._textMeasure=c,N=a._textSize=[e.width,Q+2],e=this._calcTextureSize(N[0],N[1]),y=M.canvas,y.width=e,y.height=e,M.fillStyle=d,M.globalAlpha=k,M.font=l+" "+Q+"px "+n,M.textBaseline=
"bottom",M.fillText(c,0,N[1]-1),a._gl_image_data=M.getImageData(0,0,e,e),a._gl_image_size=e,M.restore();!a._gl_t&&a._gl_image_data&&(c=a._gl_t=p.createTexture(),p.bindTexture(p.TEXTURE_2D,c),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,a._gl_image_data),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),
p.generateMipmap(p.TEXTURE_2D),p.bindTexture(p.TEXTURE_2D,null));if(c=a._gl_t)if(e=a._gl_image_size){var J=p.shapeImageProgram;p.useProgram(J);N=a._gl_st_u_mv=a._gl_st_u_mv||p.getUniformLocation(J,"u_mv");var K=a._gl_st_u_p=a._gl_st_u_p||p.getUniformLocation(J,"u_p"),C=a._gl_st_u_canvas_offset=a._gl_st_u_canvas_offset||p.getUniformLocation(J,"u_canvas_offset"),O=a._gl_st_u_canvas_scale=a._gl_st_u_canvas_scale||p.getUniformLocation(J,"u_canvas_scale"),P=a._gl_st_u_graphic_offset=a._gl_st_u_graphic_offset||
p.getUniformLocation(J,"u_graphic_offset"),x=a._gl_st_u_zoom_around=a._gl_st_u_zoom_around||p.getUniformLocation(J,"u_zoom_around"),z=a._gl_st_u_zoom_scale=a._gl_st_u_zoom_scale||p.getUniformLocation(J,"u_zoom_scale"),A=a._gl_st_u_ignore_rotate=a._gl_st_u_ignore_rotate||p.getUniformLocation(J,"u_ignore_rotate"),B=a._gl_st_u_res=a._gl_st_u_res||p.getUniformLocation(J,"u_res"),E=a._gl_st_u_center=a._gl_st_u_center||p.getUniformLocation(J,"u_center"),H=a._gl_st_u_size=a._gl_st_u_size||p.getUniformLocation(J,
"u_size"),F=a._gl_st_u_rotate=a._gl_st_u_rotate||p.getUniformLocation(J,"u_rotate");d=a._gl_st_u_size_x=a._gl_st_u_size_x||p.getUniformLocation(J,"u_size_x");k=a._gl_st_u_size_y=a._gl_st_u_size_y||p.getUniformLocation(J,"u_size_y");n=a._gl_st_u_offset_x=a._gl_st_u_offset_x||p.getUniformLocation(J,"u_offset_x");l=a._gl_st_u_offset_y=a._gl_st_u_offset_y||p.getUniformLocation(J,"u_offset_y");Q=a._gl_st_u_image_rotate=a._gl_st_u_image_rotate||p.getUniformLocation(J,"u_image_rotate");M=a._gl_st_u_texture_size=
a._gl_st_u_texture_size||p.getUniformLocation(J,"u_texture_size");var I=a._gl_st_a_pt=a._gl_st_a_pt||p.getAttribLocation(J,"a_pt");y=a._gl_st_u_sampler=a._gl_st_u_sampler||p.getUniformLocation(J,"u_sampler");a._gl_st_a_texcoord=a._gl_st_a_texcoord||p.getAttribLocation(J,"a_texcoord");J=a._gl_fill_vb=a._gl_fill_vb||p.createBuffer();this._bufferFloat32Array(p,J,a._gl_fill_vs,I,3);p.uniformMatrix4fv(N,!1,r._mvMatrix);p.uniformMatrix4fv(K,!1,r._pMatrix);p.uniform2f(C,m[0],m[1]);p.uniform2f(O,u[0],u[1]);
p.uniform2f(P,b[0],b[1]);p.uniform2f(x,s[0]||0,s[1]||0);p.uniform1f(z,D||1);p.uniform1i(A,1);p.uniform1f(B,t._res);p.uniform2f(E,v[0],v[1]);p.uniform2f(H,L[0],L[1]);p.uniform1f(F,t._rotate);N=a._textSize;p.uniform1f(d,N[0]);p.uniform1f(k,N[1]);"left"==q?p.uniform1f(n,f[0]||0):"right"==q?p.uniform1f(n,(f[0]||0)-N[0]):p.uniform1f(n,(f[0]||0)-N[0]/2);p.uniform1f(l,(f[1]||0)-N[1]/2);p.uniform1f(Q,0);p.uniform1f(M,e);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,c);p.uniform1i(y,0);p.bindBuffer(p.ARRAY_BUFFER,
J);p.drawArrays(p.TRIANGLES,0,a._gl_fill_vcount);p.bindBuffer(p.ARRAY_BUFFER,null);p.bindTexture(p.TEXTURE_2D,null)}}},_calcTextureSize:function(a,b){var c=Math.max(a,b||a),e,f;for(e=2;8>=e;e++){f=Math.pow(2,e);if(f>=c){c=f;break}8==e&&(c=f)}return c},_ensureImageTexture:function(a,b,c,e){var f,d;a&&a._loaded&&(a._gl_image_data||(d=this._calcTextureSize(b[0],b[1]),c.save(),f=c.canvas,f.width=d,f.height=d,c.clearRect(0,0,d,d),c.drawImage(a,0,0,b[0],b[1]),a._gl_image_data=c.getImageData(0,0,d,d),a._gl_image_size=
d,c.restore()),!a._gl_t&&a._gl_image_data&&(b=a._gl_t=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,b),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a._gl_image_data),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,e),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,e),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)))}};
G.Layer.Tile=G.Layer.Tile.extend({_initContainer:function(){var a=this._map;this.addListener("tileSuccess",a._requestRedraw,a);this.addListener("allLoaded",a._requestRedraw,a)},_destroyContainer:function(){var a=this._map;this.removeListener("tileSuccess",a._requestRedraw,a);this.removeListener("allLoaded",a._requestRedraw,a)},_update:function(){var a=this._map;if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=this._calcVisTileInfos(!0);a.getSize();var e=a.getCenter(),f=this.options,
d=f.zoomReses[b],k=f.tileSize,n=a.getDrawSize(),l=1+2*a.options.canvasExpandFactor,q=n[0]*l,n=n[1]*l,d=[e[0]-q*d/2,e[1]-n*d/2,e[0]+q*d/2,e[1]+n*d/2],a=a.options.maxExtent,s,t;this._redrawExtent=d;var d=G.ExtentUtil.intersect(d,a),p;for(p in this._tiles)l=this._tiles[p],a=l._info,s=a[0],q=a[1],t=a[2],n=f.zoomReses[t],t!==b&&(this._stopLoadingTile(l),(!f.keepResample||1>f.opacity)&&this._removeTile(p)),l=f.originX+s*k*n,s=f.originX+(s+1)*k*n,t=f.originY-(q+1)*k*n,q=f.originY-q*k*n,(q=G.ExtentUtil.overlaps([l,
t,s,q],d))||this._tileInfoExist(a,c)||this._removeTile(p);b=this._calcTileIndex(e[0],e[1],b);this._sortTileInfos(c,b[0],b[1]);this._addTiles(c);this._draw()}},_draw:function(){var a=this.options,b,c,e,f,d=this._zoom,k;for(k in this._tiles)b=this._tiles[k],c=b._info,f=parseInt(c[2]),!b._loaded||(f===d||!a.keepResample||1>a.opacity)||(e=parseInt(c[0]),c=parseInt(c[1]),this._placeTile(b,e,c,f));for(k in this._tiles)b=this._tiles[k],c=b._info,f=parseInt(c[2]),b._loaded&&f===d&&(e=parseInt(c[0]),c=parseInt(c[1]),
this._placeTile(b,e,c,f))},_placeTile:function(a,b,c,e){if(a._loaded){G.Browser.getPxRatio();var f=this._map,d=f._rotate,k=f._res,n=this.options,f=f.options,l=n.tileSize,q=l*n.zoomReses[e],d=n.tileEnlarge&&(!!(d%90)||G.Browser.gecko||G.Browser.safari);e=Math.ceil(q/k)+(d?2:0);b=n.originX+b*q;c=n.originY-c*q;(q=this._zoomScale||this._scale)&&1!==q&&(e/=q);if(!(e>4*(l+2)||e<l/8)&&(l=e*k,e*=k,f.wrap)){var s=q=0,f=f.maxExtent,t=this._redrawExtent;if(t&&f)var p=f[2]-f[0],s=Math.floor((t[0]-n.minX)/p)-
1,q=Math.ceil((t[2]-n.maxX)/p)+1;for(f=s;f<=q;f++)s=b+f*p,t=c,d&&(s-=k,t+=k),G.GLDrawUtil.drawTile(this,a,[s,t,s+l,t,s+l,t-e,s,t-e],n.opacity)}}},_addTiles:function(a){if(0!==a.length){this._numLoad=a.length;this._numLoadError=this._numLoadSuccess=0;for(var b=this.options,c,e,f,d,k,n=this.options.errorTileUrl||G.Layer.Tile.EMPTY_TILE,l=0,q=a.length;l<q;l++)c=a[l],e=c[0],f=c[1],d=c[2],k=this._getTileName(e,f,d),(c=this._tiles[k])?c.src==n?+new Date-c._responseTime>b.tileLiveMs&&this._loadTile(c,e,
f,d):this._numLoadSuccess++:(c=this._getIdleTile(),this._tiles[k]=c,this._loadTile(c,e,f,d));this._checkAllHandled()}},_clearBgBuffer:function(){var a,b;for(b in this._tiles)a=this._tiles[b],a=a._info,a=a[2],a!==this._zoom&&this._removeTile(b)},_onTileRemoved:function(a){var b=this._map._gl;b.deleteBuffer(a._gl_vb);b.deleteBuffer(a._gl_ib);b.deleteBuffer(a._gl_tcb);b.deleteTexture(a._gl_t);a._gl_vb=null;a._gl_ib=null;a._gl_tcb=null;a._gl_t=null}});
G.Layer.Graphic=G.Layer.Graphic.extend({_update:function(){this._draw()},_draw:function(){var a=this._map.getRedrawExtent(),b=this._tree.search(a).sort(this._sortIndex),c,e,f;for(f in b)c=b[f],e=c.bbox,c._draw&&(c._layer&&G.ExtentUtil.overlaps(e,a)&&!c._isVertex)&&c._draw();for(f in b)c=b[f],e=c.bbox,c._draw&&(c._layer&&G.ExtentUtil.overlaps(e,a)&&c._isVertex)&&c._draw()}});
G.Layer.Label=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{icons:"",cluster:[],crossOrigin:"*"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._lts={};this._gx=this._gy=10},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
if(a._isLoaded()){var b=this._zoom=this._calcNearestZoom(!0),c=a.getCenter();this._clearGrids();a=a._zoomAnim;a&&a._playing||(a=this._calcVisTileInfos(),b=this._calcTileIndex(c[0],c[1],b),this._sortTileInfos(a,b[0],b[1]),this._setLts(a))}},_setLts:function(a){if(a.length){for(var b=[],c,e,f,d,k,n=0,l=a.length;n<l;n++)c=a[n],f=c[0],d=c[1],k=c[2],c=this._getTileName(f,d,k),b.push(c),c in this._lts?(e=this._lts[c],e.loading||e.data||e.ri||this._loadLtI(f,d,k)):this._loadLtI(f,d,k),this._placeLt(c);this._dirtyTileKeys=
this._dirtyTileKeys||[];for(c in this._lts)-1<b.indexOf(c)||(this._stopLoadingLt(c),this._dirtyTileKeys.push(c))}},_checkDirtyTiles:function(){var a=this._dirtyTileKeys,b;if(a&&0<a.length)for(var c=0,e=a.length;c<e;c++)b=a[c],this._removeLt(b);this._dirtyTileKeys=[]},_placeLt:function(a){if((a=this._lts[a])&&a._info&&a.data){var b=a.data.l,c,e,f,d,k,n,l,q,s,t,p,r;for(c in b)for(p in e=b[c],f=Number(e[0]),d=Number(e[1]),e=e[6],f=[f,d],d="imgs"+c,t=a[d],t)d=t[p],k=d[0],n=d[1],l=d[2],q=d[3],s=d[4],r=
d[5],r||(d[5]=r=new G.Graphic.Point(f,null,{shape:"image",size:[n,l],offset:[q,s],image:k,imageGravity:!!e}),r.addTo(this))}},_removeLt:function(a){var b=this._lts[a];if(b&&b._info&&b.data){this._stopLoadingLt(a);var c=b.data.l,e,f,d;for(e in c)for(d in c="imgs"+e,f=b[c],f)c=f[d],(g=c[5])&&g.remove();delete this._lts[a]}},_loadLtI:function(a,b,c){var e=this,f=e._getTileName(a,b,c),d=e._lts[f]=e._lts[f]||{};d._info=[a,b,c];""!==d.data&&(d.loading=!0,a=e._getTileUrl(a,b,c,{d:"i",i:G.Browser.retina?
"@2x":""}),b={},e.options.crossOrigin&&(b.crossOrigin=e.options.crossOrigin),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",header:b,success:function(a,b){d.data=b;e._processLt(f)},error:function(a){404==a.status&&(d.data="")},complete:function(){delete d.ri;d.loading=!1}},e.options.crossOrigin&&(b.responseType="JSON"),a=G.Util.ajax(a,b),d.ri=a)},_processLt:function(a){var b=this._lts[a],c=b.data;if(c){var e=c.l,f=c.b,d=c.i,c=c.bb,k=this.options.icons||"",n,l,q,s,t,p,r,m,u;for(n in e){if(f&&
n in f)for(r=f[n],m=0,u=r.length;m<u;m++)p=r[m],e=p[0],l=p[1],q=p[2],s=p[3],t=p[4],p=p[5],0!=p&&c&&(t=c.slice(t,t+p),t="data:image/png;base64,"+t,p="b"+m,b["imgs"+n]=b["imgs"+n]||{},b["imgs"+n][p]=[t,e,l,q,s]);if(d&&n in d)for(r=d[n],m=0,u=r.length;m<u;m++)t=r[m],e=t[0],l=t[1],q=t[2],s=t[3],t=t[4],t=k+t,p="i"+m,b["imgs"+n]=b["imgs"+n]||{},b["imgs"+n][p]=[t,e,l,q,s]}this._checkDirtyTiles();this._placeLt(a)}},_stopLoadingLt:function(a){a=this._lts[a];var b=G.Util.ajaxCancel;a&&(b(a.ri),a.loading=!1)},
_onIconLoad:function(){this._dirtyIcons=!0},_clearGrids:function(){this._g={}},_hitGrids:function(a,b,c,e){for(var f=a;f<=c;f++)for(var d=b;d<=e;d++)if(a=f+","+d,this._g[a])return!0;return!1},_markGrids:function(a,b,c,e){for(var f=a;f<=c;f++)for(var d=b;d<=e;d++)a=f+","+d,this._g[a]=!0}});
G.Layer.Html=G.Layer.Html.extend({_placeHtml:function(a){G.Browser.getPxRatio();var b=G.DomUtil,c=this._map.toScreen(a.geom,this._aroundScreen,this._zoomScale||this._scale),e=c[0],c=c[1];this._hidden?b.hide(a):b.show(a);b.markPosTransform(a,e,c);b.updateTransform(a)},_onZoom:function(){this._zooming&&(this._tempScale==this._latestTempScale?this._erase():this._latestTempScale=this._tempScale)},_onRotate:function(){this._draw()},_onPinch:function(){this._draw()}});
G.Layer.VectorCache=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{cluster:[]},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a;this.options=G.Util.merge({},this.options,b);this._vts={};this._visVtKeys=[];this._vIds={}},_initContainer:function(){G.Layer.Graphic.prototype._initContainer.call(this)},_onAdded:function(){this._container||this._initContainer()},_onRemoved:function(){this._container&&this._destroyContainer()},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);
a._isLoaded()&&(a=this._calcVisTileInfos(),this._addVts(a))},_addVts:function(a){if(0!==a.length){var b,c,e=[],f,d,k,n;b=0;for(c=a.length;b<c;b++)f=a[b],d=f[0],k=f[1],n=f[2],f=this._getTileName(d,k,n),e.push(f),f in this._vts?(d=this._vts[f],d.data&&this._processVt(f)):this._loadVt(d,k,n);b=0;for(c=this._visVtKeys.length;b<c;b++)f=this._visVtKeys[b],0>e.indexOf(f)&&this._removeVt(f);this._visVtKeys=e}},_removeVt:function(a){this._vts[a]&&this._stopLoadingVt(a)},_loadVt:function(a,b,c){var e=this,
f=e._getTileName(a,b,c),d=e._vts[f]=e._vts[f]||{};d._info=[a,b,c];""!==d.data&&(d.loading=!0,a=e._getTileUrl(a,b,c,{d:"f"}),b={responseType:"http"===a.slice(0,4).toLowerCase()?"JSONP":"JSON",success:function(a,b){d.data=b;e._processVt(f)},error:function(a){404==a.status&&(d.data="")},complete:function(){delete d.req;d.loading=!1}},a=G.Util.ajax(a,b),d.req=a)},_processVt:function(a){for(var b=this._map,c=this._vts[a].data,e=c.v,c=c.s,f,d,k,n,l,q=G.Util.colorHex,s=0,t=e.length;s<t;s++)f=e[s],d=f.id,
k=f.g,n=f.gt,f=f.st,f=c[f],(l=this._vIds[d])?l._updateGeom(k):"pt"===n?l=new G.Graphic.Point(k):"pl"===n?l=new G.Graphic.Polyline(k):"pg"===n&&(l=new G.Graphic.Polygon(k)),l&&(k=l.options,"pt"!==n&&"pl"===n&&(n=f.line_color,k.lineWidth=f.line_width,k.lineColor=q(n[0],n[1],n[2])),l&&(l.addTo(this),l._vtKeys=l._vtKeys||{},l._vtKeys[a]=!0,this._vIds[d]=l));b._requestRedraw()},_stopLoadingVt:function(a){a=this._vts[a];var b=G.Util.ajaxCancel;a&&(b(a.req),a.loading=!1)}});
G.Layer.FeatureService=G.Layer.Graphic.extend({mixins:[G.Layer.LOD],options:{mode:"all",vacuumCount:1E3},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={}},onSuccess:function(a){"tile"==this.options.mode?this.fireEvent("loadTileSuccess",{extent:a}):this.fireEvent("loadAllSuccess")},onError:function(a){"tile"==this.options.mode?this.fireEvent("loadTileError",{extent:a}):this.fireEvent("loadAllError")},onComplete:function(a){if("tile"==
this.options.mode){var b=a.join(",");delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{extent:a})}else this.fireEvent("loadAllComplete")},_update:function(){var a=this._map;G.Layer.Graphic.prototype._update.call(this);a._isLoaded()&&("tile"==this.options.mode?(this.count()>this.options.vacuumCount&&this._vacuum(),a=this._calcVisTileInfos(),this._addFts(a)):this._loadAll())},_addFts:function(a){if(0!==a.length){var b,c,e,f,d,k=this._loadingKeys,n={};b=0;for(c=a.length;b<c;b++)f=a[b],e=
f[0],d=f[1],f=f[2],d=this._calcTileExtent(e,d,f),e=d.join(","),n[e]=d;for(e in k)n[e]||(a=k[e],G.Util.ajaxCancel(a),delete k[e]);for(e in n)d=n[e],this._loadFt(d)}},_loadFt:function(a){var b=a.join(","),c=this._reqFunc;b in this._loadingKeys||!c||(c=c.call(this,a),this._loadingKeys[b]=c,this.fireEvent("loadTileStart",{extent:a}))},_loadAll:function(){var a=this._reqFunc;"all"in this._loadingKeys||!a||(a=a.call(this),this._loadingKeys.all=a,this.fireEvent("loadAllStart"))}});
G.Layer.GeoHeyFeature=G.Layer.FeatureService.extend({options:{apiKey:"",where:"1=1",outFields:"",limit:1E3},init:function(a,b){var c=this;G.Layer.FeatureService.prototype.init.call(c,function(b){var f=a+"/query",d=c.options,k={ak:d.apiKey,where:d.where,outFields:d.outFields,limit:d.limit};b&&(k.geometry=JSON.stringify(b));k={responseType:"http"===f.slice(0,4).toLowerCase()?"JSONP":"JSON",data:k,success:function(a,f){var k=f.data,s=k.geometryType;if(k=k.features){var t;t=k.length-1;for(var p=Math.max(0,
t-d.limit),r,m,u,v=[],L;t>=p;t--)for(L in r=k[t],m=r.id,u=r.geom,r=r.attrs||{},"Point"==s?v.push(new G.Graphic.Point(u,r)):"Polyline"==s?v.push(new G.Graphic.Polyline(u,r)):"Polygon"==s?v.push(new G.Graphic.Polygon(u,r)):"MultiPoint"==s?v.push(new G.Graphic.MultiPoint(u,r)):"MultiPolyline"==s?v.push(new G.Graphic.MultiPolyline(u,r)):"MultiPolygon"==s&&v.push(new G.Graphic.MultiPolygon(u,r)),v)if(r=v[L])u=m+"_"+L,c.get(u)||r.addTo(c,u)}c.onSuccess(b)},error:function(){c.onError(b)},complete:function(){c.onComplete(b)}};
G.Util.ajax(f,k)},b)}});
G.Layer.GeoHeyProgressiveFeature=G.Layer.Graphic.extend({options:{stepFactor:4,stepCount:4,tolerance:8,outFields:"[]"},init:function(a,b){G.Layer.Graphic.prototype.init.call(this,b);this.url=a},onSuccess:function(a){this.fireEvent("extentSuccess",{extent:a})},onError:function(a){this.fireEvent("extentError",{extent:a})},onComplete:function(a){this.fireEvent("extentComplete",{extent:a})},_update:function(){var a=this._map,b=this._loadRes=a._res,c=this._loadExtent=a.getExtent(),e=this._loadedStatus;
if(!e||b!=e[0]||!G.ExtentUtil.equals(c,e[1]))if(G.Layer.Graphic.prototype._update.call(this),a._isLoaded()){(a=this._req)&&G.Util.ajaxCancel(a);var f,b=this._graphics;for(f in b)a=b[f],a._dirty=!0;this._loadStep(1)}},_loadStep:function(a){var b=this,c=b.options,e=b._loadRes,f=b._loadExtent,d=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),k=b.url+"/filter",c={responseType:"JSON",data:{extent:JSON.stringify(f),excludeExtents:JSON.stringify([]),res:e,cellPixel:d,outFields:c.outFields},success:function(c,
d){b._processResult(a,d)},complete:function(){b._req=null}};b._req=G.Util.ajax(k,c)},_processResult:function(a,b){var c=this.options,e=this._loadRes,f=this._loadExtent,d=c.tolerance*Math.pow(c.stepFactor,c.stepCount-a),d=e*d,k=b.geometryType,n=b.features;if(n){var l,q,s,t,p,r;for(l=n.length-1;0<=l;l--)if(q=n[l],s=q.id,t=q.geom,q=q.attrs||{},"Point"==k)r=new G.Graphic.Point(t,q),this._updateGraphic(d,s,0,r);else if("Polyline"==k)r=new G.Graphic.Polyline(t,q),this._updateGraphic(d,s,0,r);else if("Polygon"==
k)r=new G.Graphic.Polygon(t,q),this._updateGraphic(d,s,0,r);else if("MultiPoint"==k)for(p in t.multi)r=t.multi[p],r=new G.Graphic.Point(r,q),this._updateGraphic(d,s,p,r);else if("MultiPolyline"==k)for(p in t.multi)r=t.multi[p],r=new G.Graphic.Polyline(r,q),this._updateGraphic(d,s,p,r);else if("MultiPolygon"==k)for(p in t.multi)r=t.multi[p],r=new G.Graphic.Polygon(r,q),this._updateGraphic(d,s,p,r);a<c.stepCount?this._loadStep(a+1):(this._clearDirty(),this._loadedStatus=[e,f],this.onSuccess(f),this.onComplete(f))}else this.onError(f),
this.onComplete(f)},_updateGraphic:function(a,b,c,e){b+=c?"_"+c:"";(c=this.get(b))?(a<c._res&&(c.updateGeom(e.geom,!0),c._res=a),c._dirty=!1):(e._res=a,e.addTo(this,b))},_clearDirty:function(){var a=this._graphics,b,c;for(c in a)b=a[c],b._dirty&&b.remove()}});
G.Layer.TiledService=G.Layer.extend({mixins:[G.Layer.LOD],init:function(a,b){this.options=G.Util.merge({},this.options,b);this._reqFunc=a;this._loadingKeys={};this._loadedKeys={}},onSuccess:function(a,b){this._numLoadSuccess++;var c=parseInt(a[0]),e=parseInt(a[1]),f=parseInt(a[2]),c=this._getTileName(c,e,f);this._loadedKeys[c]=a;this.fireEvent("loadTileSuccess",{tileInfo:a,data:b})},onError:function(a){this._numLoadError++;this.fireEvent("loadTileError",{tileInfo:a})},onComplete:function(a){var b=
parseInt(a[0]),c=parseInt(a[1]),e=parseInt(a[2]),b=this._getTileName(b,c,e);delete this._loadingKeys[b];this.fireEvent("loadTileComplete",{tileInfo:a});this._checkAllHandled()},_update:function(){if(this._map._isLoaded()){var a,b,c,e,f,d,k=this._calcVisTileInfos(),n={};a=0;for(b=k.length;a<b;a++)e=k[a],c=e[0],f=e[1],d=e[2],c=this._getTileName(c,f,d),n[c]=e;this._addTiles(n);for(c in this._loadedKeys)n[c]||(e=this._loadedKeys[c],delete this._loadedKeys[c],this.fireEvent("unusedTile",{tileInfo:e}));
this._onUpdated()}},_addTiles:function(a){var b,c,e=this._loadingKeys;for(b in e)a[b]||(c=e[b],G.Util.ajaxCancel(c),delete e[b]);this._numLoad=Object.keys(a).length;this._numLoadError=this._numLoadSuccess=0;for(b in a)c=a[b],this._loadTile(c);this._checkAllHandled()},_loadTile:function(a){var b=this._reqFunc,c=parseInt(a[0]),e=parseInt(a[1]),f=parseInt(a[2]),d=this._getTileName(c,e,f);d in this._loadingKeys||!b||(d in this._loadedKeys?this._numLoadSuccess++:(b=b.call(this,c,e,f),this._loadingKeys[d]=
b,this.fireEvent("loadTileStart",{tileInfo:a})))},_stopLoadingByKey:function(a){var b=this._loadingKeys,c=b[a];c&&(G.Util.ajaxCancel(c),delete b[a])},_checkAllHandled:function(){this._numLoad==this._numLoadSuccess+this._numLoadError&&this.fireEvent("allLoaded")},_onUpdated:function(){}});
G.Graphic.Point=G.Graphic.Point.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;b.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.options.shape,b=this.geom;if(b){var c=b[0],b=b[1],e=[],f=[];if("rect"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,
c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,1),this._pushVertex(f,c,b,1),this._pushVertex(f,c,b,2),this._pushVertex(f,c,b,3),this._pushVertex(f,c,b,4),this._pushVertex(f,c,b,1);else if("image"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,
c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,1);else if("text"==a)this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,1),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,2),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,0),this._pushVertex(e,c,b,3),this._pushVertex(e,c,b,4),this._pushVertex(e,c,b,0),this._pushVertex(e,
c,b,4),this._pushVertex(e,c,b,1);else{for(a=0;48>a;a++)this._pushVertex(e,c,b,-1),this._pushVertex(e,c,b,a/48),this._pushVertex(e,c,b,(a+1)/48),this._pushVertex(f,c,b,a/48);this._pushVertex(f,c,b,0)}this._gl_fill_vs=new Float32Array(e);this._gl_fill_vcount=e.length/3;this._gl_line_vs=new Float32Array(f);this._gl_line_vcounts=[f.length/3]}},_pushVertex:function(a,b,c,e){a.push(b);a.push(c);a.push(e)},_draw:function(){for(var a=this.options,b=this._layer._map,c=a.shape,e=a.size,f=a.offset,d=a.fillColor,
k=a.fillOpacity,n=a.gradual,l=b._calcWrapPointRange(this.geom)||[0,0],q=b.options.maxExtent,q=q[2]-q[0],s=l[0];s<=l[1];s++){var t=[s*q,0];if(a.fill)if("rect"==c)G.GLDrawUtil.drawShapeFill(this,t,"rect",e,f,G.Util.colorRgb(d),null,null,k,n);else if("image"==c){var p=G.Browser.getImageSrc(a.image),p=G.DomUtil.getImgElement(p,function(){b._requestRedraw()});if(p._loaded){var r=a.imageRotate;a.imageGravity||(r+=b._rotate);G.GLDrawUtil.drawShapeImage(this,t,p,e,f,r)}}else"text"==c?G.GLDrawUtil.drawShapeText(this,
t,a.text,e,f,d,k,a.textFont,a.textStyle,a.textAlign):G.GLDrawUtil.drawShapeFill(this,t,"circle",e,f,G.Util.colorRgb(d),null,null,k,n);if(a.outline||this._mouseOver||this._editing){var p=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,r=this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth,m=a.outlineOpacity,u=a.outlineDashArray;"rect"==c?G.GLDrawUtil.drawShapeLine(this,t,"rect",e,f,G.Util.colorRgb(p),m,r,null,null,u):"image"!=c&&"text"!=c&&G.GLDrawUtil.drawShapeLine(this,
t,"circle",e,f,G.Util.colorRgb(p),m,r,null,null,u)}}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.addListener(b.DOWN[c],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.removeListener(b.DOWN[c],this._onVertexDragStart,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;a._requestRedraw();this._isVertex?b.addClass(a._layersFrame,
"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;a._requestRedraw();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.Polyline=G.Graphic.Polyline.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map;a._gl.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a&&!(2>a.length)){var b=[],c,e,f;c=0;for(e=a.length;c<e;c++)f=a[c],b.push(f[0]),b.push(f[1]);this._gl_line_vs=new Float32Array(b);this._gl_line_vcounts=[a.length]}},
_draw:function(){for(var a=this.options,b=this._layer._map,c=G.Util.colorRgb(this._editing?a.lineHighlightColor:a.lineColor),e=a.lineOpacity,f=this._mouseOver?a.lineWidth+a.lineHighlightWiden:a.lineWidth,d=a.lineCap,k=a.lineJoin,a=a.lineDashArray,n=this.bbox,n=b._calcWrapPointRange([(n[0]+n[2])/2,(n[1]+n[3])/2])||[0,0],b=b.options.maxExtent,b=b[2]-b[0],l=n[0];l<=n[1];l++)G.GLDrawUtil.drawLine(this,[l*b,0],c,e,f,d,k,a)},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],
this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},
_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Polygon=G.Graphic.Polygon.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;var c=this._fakeLineGraphics||[],e,f,d;e=0;for(f=c.length;e<f;e++)d=c[e],b.deleteBuffer(d._gl_line_vb),d._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a){var b,c,e,f,d,k,n,l;d=a[0];b=[];n=
null;e=0;for(f=d.length;e<f;e++)if(k=d[e],!n||n[0]!=k[0]||n[1]!=k[1])if(e!=f-1||k[0]!=d[0][0]||k[1]!=d[0][1])b.push(new poly2tri.Point(k[0],k[1])),n=k;var q=new poly2tri.SweepContext(b);b=1;for(c=a.length;b<c;b++){d=a[b];l=[];n=null;e=0;for(f=d.length;e<f;e++)if(k=d[e],!n||n[0]!=k[0]||n[1]!=k[1])if(e!=f-1||k[0]!=d[0][0]||k[1]!=d[0][1])l.push(new poly2tri.Point(k[0],k[1])),n=k;q.addHole(l)}try{q.triangulate()}catch(s){}f=q.getTriangles();d=[];b=0;for(c=f.length;b<c;b++)for(k=f[b],e=0;3>e;e++)n=k.getPoint(e),
d.push(n.x),d.push(n.y);this._gl_fill_vs=new Float32Array(d);this._gl_fill_vcount=d.length/2;n=this._fakeLineGraphics=[];b=0;for(c=a.length;b<c;b++){d=a[b];l={};q=[];e=0;for(f=d.length;e<f;e++)k=d[e],q.push(k[0]),q.push(k[1]);k=d[0];q.push(k[0]);q.push(k[1]);l._gl_line_vs=new Float32Array(q);l._gl_line_vcounts=[q.length/2];n.push(l)}}},_draw:function(){for(var a=this.options,b=this._layer,c=b._map,e=this.bbox,e=c._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],f=c.options.maxExtent,f=f[2]-
f[0],d=e[0];d<=e[1];d++){var k=[d*f,0];if(a.fill)if(a.fillImage){var n=G.Browser.getImageSrc(a.fillImage),n=G.DomUtil.getImgElement(n,function(){c._requestRedraw()},null,"*");n._loaded&&G.GLDrawUtil.drawFill(this,k,null,n,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawFill(this,k,G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity);if(a.outline||this._mouseOver||this._editing){var n=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,l=a.outlineCap,q=a.outlineJoin,s=(a.outline?
a.outlineWidth:0)+(this._mouseOver?a.lineHighlightWiden:0),t=a.outlineOpacity,p=a.outlineDashArray,r=this._fakeLineGraphics,m,u,v;m=0;for(u=r.length;m<u;m++)v=r[m],v._layer=b,G.GLDrawUtil.drawLine(v,k,G.Util.colorRgb(n),t,s,l,q,p)}}},_drawMask:function(){var a=this._map,b=a._maskCtx,c=this.geom,e,f,d,k=a._canvasOffset,n=this.bbox,n=a._calcWrapPointRange([(n[0]+n[2])/2,(n[1]+n[3])/2])||[0,0];e=a.options.maxExtent;for(var l=e[2]-e[0],q=n[0];q<=n[1];q++){var s=[q*l,0];b.beginPath();for(var t=0,p=c.length;t<
p;t++){f=c[t];for(var r=0,m=f.length;r<m;r++)d=f[r],d=a.toScreen([d[0]+s[0],d[1]]),e=0===r?"moveTo":"lineTo",b[e](d[0]+k[0],d[1]+k[1]);d=f[0];d=a.toScreen([d[0]+s[0],d[1]]);b.lineTo(d[0]+k[0],d[1]+k[1])}b.fill()}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,
this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.MultiPoint=G.Graphic.MultiPoint.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;b.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.options.shape,b=this.geom;if(b&&b.m){var b=b.m,c,e,f,d=[],k=[],n=0;this._gl_line_vcounts=this._gl_line_vcounts||
[];for(var l=0,q=b.length;l<q;l++){c=b[l];e=c[0];c=c[1];if("rect"==a)this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,1),this._pushVertex(d,e,c,2),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,2),this._pushVertex(d,e,c,3),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,3),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,1),this._pushVertex(k,e,c,1),this._pushVertex(k,e,c,2),this._pushVertex(k,e,c,3),this._pushVertex(k,e,c,4),this._pushVertex(k,
e,c,1);else if("image"==a)this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,1),this._pushVertex(d,e,c,2),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,2),this._pushVertex(d,e,c,3),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,3),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,1);else if("text"==a)this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,1),this._pushVertex(d,e,c,2),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,2),this._pushVertex(d,
e,c,3),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,3),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,0),this._pushVertex(d,e,c,4),this._pushVertex(d,e,c,1);else{for(f=0;48>f;f++)this._pushVertex(d,e,c,-1),this._pushVertex(d,e,c,f/48),this._pushVertex(d,e,c,(f+1)/48),this._pushVertex(k,e,c,f/48);this._pushVertex(k,e,c,0)}this._gl_line_vcounts[l]=k.length/3-n;n=k.length/3}this._gl_fill_vs=new Float32Array(d);this._gl_fill_vcount=d.length/3;this._gl_line_vs=new Float32Array(k)}},_pushVertex:function(a,
b,c,e){a.push(b);a.push(c);a.push(e)},_draw:function(){for(var a=this.options,b=this._layer._map,c=a.shape,e=a.size,f=a.offset,d=a.fillColor,k=a.fillOpacity,n=a.gradual,l=this.bbox,l=b._calcWrapPointRange([(l[0]+l[2])/2,(l[1]+l[3])/2])||[0,0],q=b.options.maxExtent,q=q[2]-q[0],s=l[0];s<=l[1];s++){var t=[s*q,0];if(a.fill)if("rect"==c)G.GLDrawUtil.drawShapeFill(this,t,"rect",e,f,G.Util.colorRgb(d),null,null,k,n);else if("image"==c){var p=G.Browser.getImageSrc(a.image),p=G.DomUtil.getImgElement(p,function(){b._requestRedraw()});
if(p._loaded){var r=a.imageRotate;a.imageGravity||(r+=b._rotate);G.GLDrawUtil.drawShapeImage(this,t,p,e,f,r)}}else"text"==c?G.GLDrawUtil.drawShapeText(this,t,a.text,e,f,d,k,a.textFont,a.textStyle,a.textAlign):G.GLDrawUtil.drawShapeFill(this,t,"circle",e,f,G.Util.colorRgb(d),null,null,k,n);if(a.outline||this._mouseOver||this._editing){var p=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,r=this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth,m=a.outlineOpacity,
u=a.outlineDashArray;"rect"==c?G.GLDrawUtil.drawShapeLine(this,t,"rect",e,f,G.Util.colorRgb(p),m,r,null,null,u):"image"!=c&&"text"!=c&&G.GLDrawUtil.drawShapeLine(this,t,"circle",e,f,G.Util.colorRgb(p),m,r,null,null,u)}}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.addListener(b.DOWN[c],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.removeListener(b.DOWN[c],this._onVertexDragStart,
this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;a._requestRedraw();this._isVertex?b.addClass(a._layersFrame,"g-edit"):b.addClass(a._layersFrame,"g-clickable")}},_onMouseOut:function(){var a=this._layer;if(a){var a=a._map,b=G.DomUtil;a._requestRedraw();this._isVertex?b.removeClass(a._layersFrame,"g-edit"):b.removeClass(a._layersFrame,"g-clickable")}}});
G.Graphic.MultiPolyline=G.Graphic.MultiPolyline.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map;a._gl.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a&&a.m){var a=a.m,b,c,e=[];this._gl_line_vcounts=this._gl_line_vcounts||[];for(var f=0,d=a.length;f<d;f++){b=a[f];for(var k=0,n=b.length;k<n;k++)c=b[k],
e.push(c[0]),e.push(c[1]);this._gl_line_vcounts[f]=b.length}this._gl_line_vs=new Float32Array(e)}},_draw:function(){for(var a=this.options,b=this._layer._map,c=G.Util.colorRgb(this._editing?a.lineHighlightColor:a.lineColor),e=a.lineOpacity,f=this._mouseOver?a.lineWidth+a.lineHighlightWiden:a.lineWidth,d=a.lineCap,k=a.lineJoin,a=a.lineDashArray,n=this.bbox,n=b._calcWrapPointRange([(n[0]+n[2])/2,(n[1]+n[3])/2])||[0,0],b=b.options.maxExtent,b=b[2]-b[0],l=n[0];l<=n[1];l++)G.GLDrawUtil.drawLine(this,[l*
b,0],c,e,f,d,k,a)},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");
a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.MultiPolygon=G.Graphic.MultiPolygon.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;var c=this._fakeLineGraphics||[],e,f,d;e=0;for(f=c.length;e<f;e++)d=c[e],b.deleteBuffer(d._gl_line_vb),d._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a&&a.m){for(var b,c,e,f,d,k,
n,l=a.m,q,s=[],t=this._fakeLineGraphics=[],p=0,r=l.length;p<r;p++){q=l[p];f=q[0];b=[];k=null;a=0;for(e=f.length;a<e;a++)if(d=f[a],!k||k[0]!=d[0]||k[1]!=d[1])if(a!=e-1||d[0]!=f[0][0]||d[1]!=f[0][1])b.push(new poly2tri.Point(d[0],d[1])),k=d;var m=new poly2tri.SweepContext(b);b=1;for(c=q.length;b<c;b++){f=q[b];n=[];k=null;a=0;for(e=f.length;a<e;a++)if(d=f[a],!k||k[0]!=d[0]||k[1]!=d[1])if(a!=e-1||d[0]!=f[0][0]||d[1]!=f[0][1])n.push(new poly2tri.Point(d[0],d[1])),k=d;m.addHole(n)}try{m.triangulate()}catch(u){}e=
m.getTriangles();b=0;for(c=e.length;b<c;b++)for(f=e[b],a=0;3>a;a++)d=f.getPoint(a),s.push(d.x),s.push(d.y);b=0;for(c=q.length;b<c;b++){f=q[b];k={};n=[];a=0;for(e=f.length;a<e;a++)d=f[a],n.push(d[0]),n.push(d[1]);d=f[0];n.push(d[0]);n.push(d[1]);k._gl_line_vs=new Float32Array(n);k._gl_line_vcounts=[n.length/2];t.push(k)}}this._gl_fill_vs=new Float32Array(s);this._gl_fill_vcount=s.length/2}},_draw:function(){for(var a=this.options,b=this._layer,c=b._map,e=this.bbox,e=c._calcWrapPointRange([(e[0]+e[2])/
2,(e[1]+e[3])/2])||[0,0],f=c.options.maxExtent,f=f[2]-f[0],d=e[0];d<=e[1];d++){var k=[d*f,0];if(a.fill)if(a.fillImage){var n=G.Browser.getImageSrc(a.fillImage),n=G.DomUtil.getImgElement(n,function(){c._requestRedraw()},null,"*");n._loaded&&G.GLDrawUtil.drawFill(this,k,null,n,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawFill(this,k,G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity);if(a.outline||this._mouseOver||this._editing){var n=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:
a.fillColor,l=a.outlineCap,q=a.outlineJoin,s=(a.outline?a.outlineWidth:0)+(this._mouseOver?a.lineHighlightWiden:0),t=a.outlineOpacity,p=a.outlineDashArray,r=this._fakeLineGraphics,m,u,v;m=0;for(u=r.length;m<u;m++)v=r[m],v._layer=b,G.GLDrawUtil.drawLine(v,k,G.Util.colorRgb(n),t,s,l,q,p)}}},_drawMask:function(){var a=this._map,b=a._maskCtx,c=this.geom.m,e,f,d,k,n=a._canvasOffset,l=this.bbox,l=a._calcWrapPointRange([(l[0]+l[2])/2,(l[1]+l[3])/2])||[0,0];e=a.options.maxExtent;var q=e[2]-e[0];b.beginPath();
for(var s=l[0];s<=l[1];s++)for(var t=0,p=c.length;t<p;t++){e=c[t];for(var r=0,m=e.length;r<m;r++){d=e[r];for(var u=0,v=d.length;u<v;u++)k=d[u],k=a.toScreen([k[0]+s*q,k[1]]),f=0===u?"moveTo":"lineTo",b[f](k[0]+n[0],k[1]+n[1]);k=d[0];k=a.toScreen([k[0]+s*q,k[1]]);b.lineTo(k[0]+n[0],k[1]+n[1])}}b.fill()},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,
b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,
"g-clickable")}});
G.Graphic.Circle=G.Graphic.Circle.extend({_onAdded:function(){var a=this._layer._map;this._ensureGl();a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;b.deleteBuffer(this._gl_line_vb);this._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._ensureGl()},_ensureGl:function(){var a=this.geom;if(a){var b=a[0],a=a[1],c=[],e=[],f;for(f=0;48>f;f++)c.push(b),c.push(a),c.push(-1),c.push(b),c.push(a),c.push(f/
48),c.push(b),c.push(a),c.push((f+1)/48),e.push(b),e.push(a),e.push(f/48);e.push(b);e.push(a);e.push(0);this._gl_fill_vs=new Float32Array(c);this._gl_fill_vcount=c.length/3;this._gl_line_vs=new Float32Array(e);this._gl_line_vcounts=[e.length/3]}},_draw:function(){var a=this.options,b=this._layer._map,c=2*(this.geom[2]/b._res);if(c)for(var e=b._calcWrapPointRange(this.geom)||[0,0],f=b.options.maxExtent,f=f[2]-f[0],d=e[0];d<=e[1];d++){var k=[d*f,0];if(a.fill)if(a.fillImage){var n=G.Browser.getImageSrc(a.fillImage),
n=G.DomUtil.getImgElement(n,function(){b._requestRedraw()},null,"*");n._loaded&&G.GLDrawUtil.drawShapeFill(this,k,"circle",[c,0],[0,0],null,n,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawShapeFill(this,k,"circle",[c,0],[0,0],G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity,a.gradual);if(a.outline||this._mouseOver){var n=this._mouseOver?a.outlineWidth+a.lineHighlightWiden:a.outlineWidth,l=a.outlineOpacity,q=a.outlineDashArray;G.GLDrawUtil.drawShapeLine(this,k,"circle",[c,0],[0,0],G.Util.colorRgb(this._editing?
a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor),l,n,null,null,q)}}},_drawMask:function(){for(var a=this._map,b=a._maskCtx,c=this.geom,e=c[0],f=c[1],d=c[2]/a._res,k=a._canvasOffset,c=a._calcWrapPointRange(c)||[0,0],n=a.options.maxExtent,n=n[2]-n[0],l=c[0];l<=c[1];l++){var q=a.toScreen([e+l*n,f]);q[0]+=k[0];q[1]+=k[1];b.beginPath();b.arc(q[0],q[1],d,0,2*Math.PI,!1);b.fill()}},_onStartEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.addListener(b.DOWN[c],this._onVertexDragStart,
this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c;for(c in b.DOWN)a.removeListener(b.DOWN[c],this._onVertexDragStart,this);this._removeVertexes()},_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Graphic.Arrow=G.Graphic.Arrow.extend({_onAdded:function(){var a=this._layer._map;this._resGl=null;a&&a._requestRedraw()},_onRemoved:function(){var a=this._layer._map,b=a._gl;b.deleteBuffer(this._gl_fill_vb);this._gl_fill_vb=null;var c=this._fakeLineGraphics||[],e,f,d;e=0;for(f=c.length;e<f;e++)d=c[e],b.deleteBuffer(d._gl_line_vb),d._gl_line_vb=null;a&&a._requestRedraw()},_onGeomUpdated:function(){this._resGl=this._resDraw=null;var a=this._layer;a&&(a=a._map)&&(this._updateGeomDraw(a._res),this._ensureGl())},
_ensureGl:function(){var a=this._layer;if(a&&(a=a._map)&&this._resGl!=a._res){var b=this._geomDraw;if(b){var c,e,f,d,k,n,l,q;k=b[0];c=[];l=null;f=0;for(d=k.length;f<d;f++)if(n=k[f],!l||l[0]!=n[0]||l[1]!=n[1])if(f!=d-1||n[0]!=k[0][0]||n[1]!=k[0][1])c.push(new poly2tri.Point(n[0],n[1])),l=n;var s=new poly2tri.SweepContext(c);c=1;for(e=b.length;c<e;c++){k=b[c];q=[];l=null;f=0;for(d=k.length;f<d;f++)if(n=k[f],!l||l[0]!=n[0]||l[1]!=n[1])if(f!=d-1||n[0]!=k[0][0]||n[1]!=k[0][1])q.push(new poly2tri.Point(n[0],
n[1])),l=n;s.addHole(q)}try{s.triangulate()}catch(t){}d=s.getTriangles();k=[];c=0;for(e=d.length;c<e;c++)for(n=d[c],f=0;3>f;f++)l=n.getPoint(f),k.push(l.x),k.push(l.y);this._gl_fill_vs=new Float32Array(k);this._gl_fill_vcount=k.length/2;l=this._fakeLineGraphics=[];c=0;for(e=b.length;c<e;c++){k=b[c];q={};s=[];f=0;for(d=k.length;f<d;f++)n=k[f],s.push(n[0]),s.push(n[1]);n=k[0];s.push(n[0]);s.push(n[1]);q._gl_line_vs=new Float32Array(s);q._gl_line_vcounts=[s.length/2];l.push(q)}this._resGl=a._res}}},
_draw:function(){var a=this.options,b=this._layer,c=b._map;this._updateGeomDraw(c._res);this._ensureGl();if(this._geomDraw&&this._fakeLineGraphics)for(var e=this.bbox,e=c._calcWrapPointRange([(e[0]+e[2])/2,(e[1]+e[3])/2])||[0,0],f=c.options.maxExtent,f=f[2]-f[0],d=e[0];d<=e[1];d++){var k=[d*f,0];if(a.fill)if(a.fillImage){var n=G.Browser.getImageSrc(a.fillImage),n=G.DomUtil.getImgElement(n,function(){c._requestRedraw()},null,"*");n._loaded&&G.GLDrawUtil.drawFill(this,k,null,n,a.fillImageSize,a.fillOpacity)}else G.GLDrawUtil.drawFill(this,
k,G.Util.colorRgb(a.fillColor),null,null,a.fillOpacity);if(a.outline||this._mouseOver||this._editing){var n=this._editing?a.lineHighlightColor:a.outline?a.outlineColor:a.fillColor,l=a.outlineCap,q=a.outlineJoin,s=(a.outline?a.outlineWidth:0)+(this._mouseOver?a.lineHighlightWiden:0),t=a.outlineOpacity,p=a.outlineDashArray,r=this._fakeLineGraphics,m,u,v;m=0;for(u=r.length;m<u;m++)v=r[m],v._layer=b,G.GLDrawUtil.drawLine(v,k,G.Util.colorRgb(n),t,s,l,q,p)}}},_drawMask:function(){var a=this._map,b=a._maskCtx;
this._updateGeomDraw(a._res);var c=this._geomDraw,e,f,d,k=a._canvasOffset,n=this.bbox,n=a._calcWrapPointRange([(n[0]+n[2])/2,(n[1]+n[3])/2])||[0,0];e=a.options.maxExtent;for(var l=e[2]-e[0],q=n[0];q<=n[1];q++){var s=[q*l,0];b.beginPath();for(var t=0,p=c.length;t<p;t++){f=c[t];for(var r=0,m=f.length;r<m;r++)d=f[r],d=a.toScreen([d[0]+s[0],d[1]]),e=0===r?"moveTo":"lineTo",b[e](d[0]+k[0],d[1]+k[1]);d=f[0];d=a.toScreen([d[0]+s[0],d[1]]);b.lineTo(d[0]+k[0],d[1]+k[1])}b.fill()}},_onStartEdit:function(){var a=
this._layer._map,b=this.virtualMouse;for(i in b.DOWN)a.addListener(b.DOWN[i],this._onVertexDragStart,this);this._refreshVertexes()},_onEndEdit:function(){var a=this._layer._map,b=this.virtualMouse,c,e;for(c in b.DOWN)e=b.DOWN[c],a.removeListener(e,this._onVertexDragStart,this),a.removeListener(b.MOVE[e],this._onVertexDrag,this),a.removeListener(b.UP[e],this._onVertexDragEnd,this);this._removeVertexes();G.DomUtil.removeClass(a._layersFrame,"g-edit");a._requestRedraw()},_onMouseOver:function(){var a=
this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});G.Graphic.Group=G.Graphic.Group.extend({_onMouseOver:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.addClass(a._layersFrame,"g-clickable")},_onMouseOut:function(){var a=this._layer._map;a._requestRedraw();G.DomUtil.removeClass(a._layersFrame,"g-clickable")}});
G.Map=G.Map.extend({print:function(a,b){var c=G.DomUtil,e=G.Browser.getCanvasRatio(),f=this.getSize(),d=f[0],k=f[1],f=a||d,n=b||k,d=Math.max(f/d,n/k),k=this._gl.canvas,l=k.width/e[0],e=k.height/e[1],c=c.create("canvas");c.width=f;c.height=n;c.getContext("2d").drawImage(k,(f-l*d)/2,(n-e*d)/2,l*d,e*d);return c.toDataURL()},_initAddition:function(){var a=G.DomUtil,b=["webgl","experimental-webgl"],c,e;c=0;for(e=b.length;c<e&&!this._gl;c++)gl=this._gl=a.create("canvas").getContext(b[c],{alpha:!1,preserveDrawingBuffer:!0});
this._textureCtx=a.create("canvas").getContext("2d");this._initGL();this._onScreenCtx=a.create("canvas","g-layer",this._layersFrame).getContext("2d");this._snapshotCtx=a.create("canvas").getContext("2d");this._maskCtx=a.create("canvas").getContext("2d");this._mode="webgl"},_initGL:function(){var a=this._gl;if(a){var b=G.GLShaderUtil,c=b.compile(a,a.VERTEX_SHADER,b.TILE_VS),e=b.compile(a,a.FRAGMENT_SHADER,b.TILE_FS);a.tileProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.PT_VS);e=b.compile(a,
a.FRAGMENT_SHADER,b.PT_FS);a.ptProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.LINE_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.LINE_FS);a.lineProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.FILL_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.FILL_FS);a.fillProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_FILL_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.SHAPE_FILL_FS);a.shapeFillProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_LINE_VS);e=b.compile(a,a.FRAGMENT_SHADER,
b.SHAPE_LINE_FS);a.shapeLineProgram=b.genProgram(a,c,e);c=b.compile(a,a.VERTEX_SHADER,b.SHAPE_IMAGE_VS);e=b.compile(a,a.FRAGMENT_SHADER,b.SHAPE_IMAGE_FS);a.shapeImageProgram=b.genProgram(a,c,e);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.flush()}},_redrawSnapshot:function(a,b,c){var e=G.Browser.getCanvasRatio(),f=this._onScreenCtx.canvas,d=f.width/(e[0]||1),e=f.height/(e[1]||1),f=G.Browser.getPxRatio(),k=f[0],n=
f[1],l=this._center,q=this._rotate,s=this._res,f=q-b,t=s/c,p=this._onScreenCtx,r,m;r=-d/2;m=-e/2;b&&(b=G.MathUtil.rotateVector([r,m],-b),r=b[0],m=b[1]);b=r*c*k+a[0];a=-m*c*n+a[1];r=(b-l[0])/s/k;m=-(a-l[1])/s/n;q&&(b=G.MathUtil.rotateVector([r,m],q),r=b[0],m=b[1]);a=d/2+r;c=e/2+m;this._clearCanvas(p);p.save();p.translate(a,c);p.rotate(f/G.MathUtil.DEGREE_PER_RADIAN);p.drawImage(this._snapshotCtx.canvas,0,0,d/t,e/t);p.restore()},_redraw:function(){var a=this._gl;if(a){var b=this._zoomAnim,c=this._rotateAnim,
e=this._handlers.Pinch;if(!this.options.canvasAnimRedraw&&b&&b._playing)this._redrawSnapshot(b._startCenter,this._rotate,b._startRes);else if(!this.options.canvasAnimRedraw&&c&&c._playing)this._redrawSnapshot(this._center,c._startRotate,this._res);else if(!this.options.canvasAnimRedraw&&e&&e._pinching)this._redrawSnapshot(e._startCenter,e._startRotate,e._startRes);else{this._clearGlCanvas();for(var f in this._layerOrder)b=this._layerOrder[f],b=this._layers[b],b.isVisible()&&b._draw();a.flush();a=
G.Browser.getCanvasRatio();f=this._onScreenCtx.canvas;w=f.width/(a[0]||1);h=f.height/(a[1]||1);try{this._clearCanvas(this._onScreenCtx),this._onScreenCtx.drawImage(this._gl.canvas,0,0,w,h)}catch(d){}try{this._onScreenCtx.drawImage(this._maskCtx.canvas,0,0)}catch(k){}this._drawMask();this.fireEvent("redraw")}}},_update:function(){var a=this._gl;if(a){this._clearGlCanvas();var b,c;for(c in this._layers)b=this._layers[c],b.isVisible()&&b._update();a.flush();a=G.Browser.getCanvasRatio();b=this._onScreenCtx.canvas;
w=b.width/(a[0]||1);h=b.height/(a[1]||1);try{this._clearCanvas(this._onScreenCtx),this._onScreenCtx.drawImage(this._gl.canvas,0,0,w,h)}catch(e){}this._drawMask();try{this._onScreenCtx.drawImage(this._maskCtx.canvas,0,0)}catch(f){}this.fireEvent("update")}},_drawMask:function(){var a=this._maskCtx,b=this.options,c,e=this._masks;if(e){var f=e.length;if(b.mask&&(this._clearCanvas(this._maskCtx),0!=f)){a.save();a.globalCompositeOperation="source-over";a.fillStyle=b.maskColor;a.globalAlpha=b.maskOpacity;
a.fillRect(0,0,a.canvas.width,a.canvas.height);a.globalCompositeOperation="destination-out";a.globalAlpha=1;for(b=0;b<f;b++)c=e[b],c._drawMask&&c._drawMask();a.restore()}}},_onResize:function(){this._resizeCanvases();this._updateDrawSize();this._requestUpdate()},_clearCanvas:function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height)},_clearGlCanvas:function(){var a=this._gl,b=G.Util.colorRgb(this.options.glColor);a.clearColor(b[0]/255,b[1]/255,b[2]/255,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},
_resizeCanvas:function(a,b,c,e){var f=a.canvas,d=e?e[0]||1:1;e=e?e[1]||1:1;var k=this.options.canvasExpandFactor,n=b*k,k=c*k;b+=2*n;c+=2*k;G.DomUtil.setPosition(f,-n,-k);1==d&&1==e?(f.width=b,f.height=c,f.style.width="",f.style.height="",a.scale(1,1)):(f.width=b*d,f.height=c*e,f.style.width=b+"px",f.style.height=c+"px",a.scale(d,e))},_resizeGlCanvas:function(){var a=this._gl,b=a.canvas,c=G.Browser.getCanvasRatio(),e=c?c[0]||1:1,c=c?c[1]||1:1,f=this.getSize(),d=f[0],k=f[1],f=d/2,n=k/2,l=this.options.canvasExpandFactor,
q=d*l,l=k*l,d=d+2*q,k=k+2*l;G.DomUtil.setPosition(b,-q,-l);this._canvasOffset=[q,l];var s=this._camera,s=this._camera=new G.GLOrthoCamera(-f-q,f+q,-n-l,n+l,s?s.near:void 0,s?s.far:void 0);s.moveTo(f+q,-n-l,s.far/2);s.lookAt(f+q,-n-l,0);1==e&&1==c?(b.width=d,b.height=k,b.style.width="",b.style.height="",this._canvasScale=[1,1]):(b.width=d*e,b.height=k*c,b.style.width=d+"px",b.style.height=k+"px",this._canvasScale=[e,c]);d=b.width;k=b.height;a.viewport(0,0,d,k)},_resizeCanvases:function(){var a=this.getSize(),
b=a[0],a=a[1],c=G.Browser.getCanvasRatio(),e=this.options.canvasExpandFactor;this._canvasOffset=[b*e,a*e];this._resizeCanvas(this._onScreenCtx,b,a,c);this._resizeCanvas(this._snapshotCtx,b,a,c);this._resizeCanvas(this._maskCtx,b,a,[1,1]);this._resizeGlCanvas()},_onZoomStart:function(a){this._snapshotCanvas()},_onRotateStart:function(a){this._snapshotCanvas()},_onPinchStart:function(a){this._snapshotCanvas()},_snapshotCanvas:function(){if(!this.options.canvasAnimRedraw){var a=this._onScreenCtx.canvas,
b=G.Browser.getCanvasRatio(),c=a.width/(b[0]||1),b=a.height/(b[1]||1);this._clearCanvas(this._snapshotCtx);this._snapshotCtx.drawImage(a,0,0,c,b)}},_calcCanvasOffset:function(){var a=this.getSize(),b=this.getDrawSize();return[(a[0]-b[0])/2,(a[1]-b[1])/2]},_beforeMergeFramePos:function(){var a=G.DomUtil.getPosition(this._mapFrame),b=a[0],a=a[1];try{this._onScreenCtx.drawImage(this._onScreenCtx.canvas,b,a)}catch(c){}}});
