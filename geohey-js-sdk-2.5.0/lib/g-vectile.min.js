G.Buffer=G.Class.extend({init:function(a){var b;a&&a.length&&(b=a,a=b.length);a=new Uint8Array(a||0);b&&a.set(b);this._buf=a},size:function(){var a=this._buf;return a?a.length:0},readUInt32LE:function(a){var b=this._buf;return(b[a]|b[a+1]<<8|b[a+2]<<16)+16777216*b[a+3]},readInt32LE:function(a){var b=this._buf;return(b[a]|b[a+1]<<8|b[a+2]<<16)+(b[a+3]<<24)},readFloatLE:function(a){return this._readLE(this._buf,a,!0,23,4)},readDoubleLE:function(a){return this._readLE(this._buf,a,!0,52,8)},toString:function(a,
b,c){a=this._buf;var e="",d="";b=b||0;for(c=Math.min(a.length,c||a.length);b<c;b++){var f=a[b];127>=f?(e+=decodeURIComponent(d)+String.fromCharCode(f),d=""):d+="%"+f.toString(16)}return e+=decodeURIComponent(d)},slice:function(a,b){return this._buf.subarray(a,b)},_readLE:function(a,b,c,e,d){var f;f=8*d-e-1;var l=(1<<f)-1,m=l>>1,g=-7;d=c?d-1:0;var k=c?-1:1,h=a[b+d];d+=k;c=h&(1<<-g)-1;h>>=-g;for(g+=f;0<g;c=256*c+a[b+d],d+=k,g-=8);f=c&(1<<-g)-1;c>>=-g;for(g+=e;0<g;f=256*f+a[b+d],d+=k,g-=8);if(0===c)c=
1-m;else{if(c===l)return f?NaN:Infinity*(h?-1:1);f+=Math.pow(2,e);c-=m}return(h?-1:1)*f*Math.pow(2,c-e)}});
G.Pbf=G.Class.extend({statics:{Varint:0,Fixed64:1,Bytes:2,Fixed32:5,ShiftLeft32:4294967296,ShiftRight32:1/4294967296,TwoPow63:Math.pow(2,63)},init:function(a){this._buffer=new G.Buffer(a||0);this._pos=0;this._len=this._buffer.size()},readFields:function(a,b,c){for(c=c||this._len;this._pos<c;){var e=this.readVarint(),d=this._pos;a(e>>3,b,this);this._pos===d&&this.skip(e)}return b},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this._pos)},readFixed32:function(){var a=this._buffer.readUInt32LE(this._pos);
this._pos+=4;return a},readSFixed32:function(){var a=this._buffer.readInt32LE(this._pos);this._pos+=4;return a},readFixed64:function(){var a=this._buffer,a=a.readUInt32LE(this._pos)+a.readUInt32LE(this._pos+4)*G.Pbf.ShiftLeft32;this._pos+=8;return a},readSFixed64:function(){var a=this._buffer,a=a.readUInt32LE(this._pos)+a.readInt32LE(this._pos+4)*G.Pbf.ShiftLeft32;this._pos+=8;return a},readFloat:function(){var a=this._buffer.readFloatLE(this._pos);this._pos+=4;return a},readDouble:function(){var a=
this._buffer.readDoubleLE(this._pos);this._pos+=8;return a},readVarint:function(){var a=this._buffer._buf,b,c,e,d,f;b=a[this._pos++];if(128>b)return b;b&=127;e=a[this._pos++];if(128>e)return b|e<<7;e=(e&127)<<7;d=a[this._pos++];if(128>d)return b|e|d<<14;d=(d&127)<<14;f=a[this._pos++];if(128>f)return b|e|d|f<<21;c=a[this._pos++];b=(b|e|d|(f&127)<<21)+268435456*(c&127);if(128>c)return b;c=a[this._pos++];b+=34359738368*(c&127);if(128>c)return b;c=a[this._pos++];b+=4398046511104*(c&127);if(128>c)return b;
c=a[this._pos++];b+=562949953421312*(c&127);if(128>c)return b;c=a[this._pos++];b+=72057594037927936*(c&127);if(128>c)return b;c=a[this._pos++];b+=0x7ffffffffffffc00*(c&127);if(128>c)return b},readVarint64:function(){var a=this._buffer._buf,b=this._pos,c=this.readVarint();if(c<G.Pbf.TwoPow63)return c;for(var e=this._pos-2;255===a[e];)e--;e<b&&(e=b);for(var d=c=0;d<e-b+1;d++)var f=~a[b+d]&127,c=c+(4>d?f<<7*d:f*Math.pow(2,7*d));return-c-1},readSVarint:function(){var a=this.readVarint();return 1===a%
2?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this._pos,b=this._buffer.toString("utf8",this._pos,a);this._pos=a;return b},readBytes:function(){var a=this.readVarint()+this._pos,b=this._buffer.slice(this._pos,a);this._pos=a;return b},readPackedVarint:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readVarint());return b},readPackedSVarint:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<
a;)b.push(this.readSVarint());return b},readPackedBoolean:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readBoolean());return b},readPackedFloat:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readFloat());return b},readPackedDouble:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readDouble());return b},readPackedFixed32:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readFixed32());
return b},readPackedSFixed32:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readSFixed32());return b},readPackedFixed64:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readFixed64());return b},readPackedSFixed64:function(){for(var a=this.readVarint()+this._pos,b=[];this._pos<a;)b.push(this.readSFixed64());return b},skip:function(a){a&=7;if(a===G.Pbf.Varint)for(;127<this._buffer[this._pos++];);else if(a===G.Pbf.Bytes)this._pos=this.readVarint()+
this._pos;else if(a===G.Pbf.Fixed32)this._pos+=4;else if(a===G.Pbf.Fixed64)this._pos+=8;else throw Error("Unimplemented type: "+a);}});
